<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Sessão 1: Introdução à Virtualização</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_sessão_1_introdução_à_virtualização">Sessão 1: Introdução à Virtualização</a>
<ul class="sectlevel2">
<li><a href="#_1_instalando_o_virtualbox">1) Instalando o VirtualBox</a></li>
<li><a href="#_2_criando_máquinas_virtuais">2) Criando máquinas virtuais</a></li>
<li><a href="#_3_alterando_a_configuração_de_uma_máquina_virtual">3) Alterando a configuração de uma máquina virtual</a></li>
<li><a href="#_4_adicionando_uma_máquina_virtual">4) Adicionando uma máquina virtual</a></li>
<li><a href="#_5_utilizando_snapshots">5) Utilizando snapshots</a></li>
<li><a href="#_6_removendo_uma_máquina_virtual">6) Removendo uma máquina virtual</a></li>
<li><a href="#_7_criando_máquinas_virtuais_no_vmware_workstation">7) Criando máquinas virtuais no VMware Workstation</a></li>
<li><a href="#_8_iniciando_a_máquina_virtual">8) Iniciando a máquina virtual</a></li>
<li><a href="#_9_alterando_a_configuração_de_uma_mv">9) Alterando a configuração de uma MV</a></li>
<li><a href="#_10_adicionando_uma_máquina_virtual">10) Adicionando uma máquina virtual</a></li>
<li><a href="#_11_utilizando_snapshots">11) Utilizando snapshots</a></li>
<li><a href="#_12_removendo_máquinas_virtuais">12) Removendo máquinas virtuais</a></li>
<li><a href="#_13_captura_de_máquina_física_para_virtual_p2v">13) Captura de máquina física para virtual (P2V)</a></li>
</ul>
</li>
<li><a href="#_sessão_2_configuração_de_storage">Sessão 2: Configuração de Storage</a>
<ul class="sectlevel2">
<li><a href="#_1_instalação_do_freenas">1) Instalação do FreeNAS</a></li>
<li><a href="#_2_configuração_do_freenas">2) Configuração do FreeNAS</a></li>
</ul>
</li>
<li><a href="#_sessão_3_introdução_ao_xcp_ng">Sessão 3: Introdução ao XCP-ng</a>
<ul class="sectlevel2">
<li><a href="#_1_instalação_do_xcp_ng">1) Instalação do XCP-ng</a></li>
<li><a href="#_2_conhecendo_alguns_comandos_básicos">2) Conhecendo alguns comandos básicos</a></li>
<li><a href="#_3_instalação_do_xcp_ng_center">3) Instalação do XCP-ng Center</a></li>
<li><a href="#_4_conhecendo_o_xcp_ng_center">4) Conhecendo o XCP-ng Center</a></li>
<li><a href="#_5_configuração_do_repositório_compartilhado_de_isos">5) Configuração do repositório compartilhado de ISOs</a></li>
<li><a href="#_6_criação_de_máquinas_virtuais">6) Criação de máquinas virtuais</a></li>
<li><a href="#_7_instalação_dos_adicionais_de_convidado">7) Instalação dos adicionais de convidado</a></li>
<li><a href="#_8_acesso_ao_hypervisor_via_ssh">8) Acesso ao hypervisor via SSH</a></li>
<li><a href="#_9_armazenamento_de_dados_das_máquinas_virtuais">9) Armazenamento de dados das máquinas virtuais</a></li>
<li><a href="#_10_snapshots_de_máquinas_virtuais">10) Snapshots de máquinas virtuais</a></li>
</ul>
</li>
<li><a href="#_sessão_4_xcp_ng_avançado">Sessão 4: XCP-ng avançado</a>
<ul class="sectlevel2">
<li><a href="#_1_criação_de_pools">1) Criação de pools</a></li>
<li><a href="#_2_dispositivo_de_armazenamento_remoto">2) Dispositivo de armazenamento remoto</a></li>
<li><a href="#_3_movendo_máquinas_virtuais_para_o_storage_compartilhado">3) Movendo máquinas virtuais para o Storage compartilhado</a></li>
<li><a href="#_4_migração_manual_de_máquinas_virtuais_no_pool">4) Migração manual de máquinas virtuais no pool</a></li>
<li><a href="#_5_ativando_a_alta_disponibilidade_ha">5) Ativando a Alta Disponibilidade - HA</a></li>
<li><a href="#_6_indisponibilização_do_pool_master">6) Indisponibilização do pool master</a></li>
</ul>
</li>
<li><a href="#_sessão_5_introdução_ao_hyper_v">Sessão 5: Introdução ao Hyper-V</a>
<ul class="sectlevel2">
<li><a href="#_1_instalação_do_hyper_v">1) Instalação do Hyper-V</a></li>
<li><a href="#_2_gerenciamento_do_hyper_v">2) Gerenciamento do Hyper-V</a></li>
<li><a href="#_3_acesso_ao_servidor_de_isos">3) Acesso ao servidor de ISOs</a></li>
<li><a href="#_4_criação_de_máquinas_virtuais">4)  Criação de máquinas virtuais</a></li>
<li><a href="#_5_configuração_padrão_das_máquinas_virtuais">5) Configuração padrão das máquinas virtuais</a></li>
<li><a href="#_6_replicação_de_vm_entre_hyper_v">6) Replicação de VM entre Hyper-V</a></li>
</ul>
</li>
<li><a href="#_sessão_6_hyper_v_avançado">Sessão 6: Hyper-V avançado</a>
<ul class="sectlevel2">
<li><a href="#_1_configuração_de_cluster">1) Configuração de Cluster</a></li>
<li><a href="#_2_configuração_de_storage_compartilhado">2) Configuração de storage compartilhado</a></li>
<li><a href="#_3_migração_de_máquinas_virtuais">3) Migração de máquinas virtuais</a></li>
<li><a href="#_4_alta_disponibilidade">4) Alta Disponibilidade</a></li>
</ul>
</li>
<li><a href="#_sessão_7_introdução_ao_vsphere">Sessão 7: Introdução ao VSphere</a>
<ul class="sectlevel2">
<li><a href="#_1_instalação_do_vmware_esxi">1) Instalação do VMware ESXi</a></li>
<li><a href="#_2_conhecendo_o_vmware_esxi">2) Conhecendo o VMware ESXi</a></li>
<li><a href="#_3_acessando_a_interface_web_de_configuração">3) Acessando a interface web de configuração</a></li>
<li><a href="#_4_adicionando_repositório_de_arquivos_iso">4) Adicionando repositório de arquivos ISO</a></li>
<li><a href="#_5_criação_de_máquinas_virtuais">5) Criação de máquinas virtuais</a></li>
<li><a href="#_6_criação_de_snapshots">6) Criação de snapshots</a></li>
</ul>
</li>
<li><a href="#_sessão_8_vsphere_avançado">Sessão 8: VSphere avançado</a>
<ul class="sectlevel2">
<li><a href="#_1_instalando_o_vcenter">1) Instalando o vCenter</a></li>
<li><a href="#_2_gerenciando_um_datacenter_com_o_vcenter">2) Gerenciando um datacenter com o vCenter</a></li>
<li><a href="#_3_configurando_acesso_ao_storage">3) Configurando Acesso ao Storage</a></li>
<li><a href="#_4_migração_de_máquinas_virtuais">4) Migração de máquinas virtuais</a></li>
<li><a href="#_5_ativando_alta_disponibilidade_e_tolerância_a_falhas">5) Ativando alta disponibilidade e tolerância a falhas</a></li>
</ul>
</li>
<li><a href="#_sessão_9_clouds_privadas_com_o_openstack">Sessão 9: Clouds privadas com o OpenStack</a></li>
<li><a href="#_sessão_10">Sessão 10:</a></li>
</ul>
</div>
</div>
<div id="content">
<link rel="stylesheet"  href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
<div class="sect1">
<h2 id="_sessão_1_introdução_à_virtualização">Sessão 1: Introdução à Virtualização</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_instalando_o_virtualbox">1) Instalando o VirtualBox</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute o arquivo de instalação <code>VirtualBox-&lt;version&gt;-Win.exe</code>.  Todos os arquivos necessários estão disponíveis no diretório <code>Aluno</code>, em seu <em>Desktop</em>. A instalação do VirtualBox é bem simples, por este motivo não é necessário um passo a passo.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_criando_máquinas_virtuais">2) Criando máquinas virtuais</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inicie o VirtualBox e localize no canto superior esquerdo o botão <em>Novo</em>.</p>
<div class="paragraph">
<p>Selecione Nome e Sistema Operacional, Tamanho da memória e Disco rígido, Tipo de arquivo de disco rígido, avance e conclua.</p>
</div>
</li>
<li>
<p>Verifique se as informações apresentadas estão corretas e clique em <em>Finalizar</em>.</p>
<div class="paragraph">
<p>Inicie a máquina virtual que você acaba de criar. Observe a mensagem de erro: <code>FATAL: No bootable medium found! System halted.</code></p>
</div>
<div class="paragraph">
<p>Você saberia informar o motivo?</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_alterando_a_configuração_de_uma_máquina_virtual">3) Alterando a configuração de uma máquina virtual</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>O VirtualBox permite a edição de máquinas virtuais após sua criação. Podemos modificar o nome da VM, adicionar ou alterar o disco rígido virtual, memória que a máquina alocará para o seu uso, adicionar mais interfaces de rede, dentre outras opções. Nesta atividade, iremos visualizar as opções de edição da máquina virtual.</p>
<div class="paragraph">
<p>Para editar uma máquina virtual, será necessário uma já criada. Na lista de máquinas do seu inventário, selecione a máquina criada na Atividade 1. Observe que, ao lado aparecerá a lista dos hardwares da máquina virtual selecionada. Clique no menu Máquina e em seguida em Configurações.</p>
</div>
<div id="img-vbox1" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox1.png" alt="vbox1">
</div>
<div class="title">Figure 1. Configurando máquinas virtuais</div>
</div>
<div class="paragraph">
<p>Suponha que tenha sido realizado um upgrade de mais 16 GB de memória e mais um disco rígido de 1TB na máquina hospedeira, com o objetivo de acrescentar mais recursos às suas máquinas virtuais.</p>
</div>
</li>
<li>
<p>Na guia Sistema, acesse a aba Placa-Mãe, vá a Memória base e adicione mais 1024 MB de memória RAM à máquina virtual.</p>
<div class="paragraph">
<p>O tamanho da nova quantidade de memória deve ser múltiplo de 4. É preciso deixar disponível para o sistema operacional nativo uma quantidade recomendada para um funcionamento estável.</p>
</div>
<div id="img-vbox2" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox2.png" alt="vbox2">
</div>
<div class="title">Figure 2. Configurando memória RAM</div>
</div>
<div class="paragraph">
<p>Observe que na aba Processador há a opção de aumentar a quantidade de processadores virtuais. Por medida de segurança, mantenha a quantidade padrão de processadores.</p>
</div>
<div class="paragraph">
<p>Cuidado, pois a troca do número de processadores virtuais depois que a máquina virtual for instalada poderá causar instabilidade.</p>
</div>
<div id="img-vbox3" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox3.png" alt="vbox3">
</div>
<div class="title">Figure 3. Configurando processadores</div>
</div>
<div class="paragraph">
<p>Na guia Rede selecione a interface de rede chamada Adaptador 1 e altere o seu modo de conexão para Bridge. Faça também a alteração do endereço MAC da máquina virtual, clicando primeiro em Avançado e depois no botão que foi habilitado, fazendo com que o VirtualBox gere um novo endereço MAC para a máquina em questão.</p>
</div>
<div id="img-vbox4" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox4.png" alt="vbox4">
</div>
<div class="title">Figure 4. Configurando rede</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_adicionando_uma_máquina_virtual">4) Adicionando uma máquina virtual</h3>
<div class="paragraph">
<p>Para adicionar máquinas virtuais pré-existentes ao VirtualBox, precisaremos executar o Assistente de Importação de Appliance. O VirtualBox atualmente suporta a importação de máquinas virtuais gravadas no Formato Aberto de Virtualização (Open Virtualization Format - OVF/OVA). Para isso siga as instruções:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clique no menu Arquivo e em seguida clique em Importar Appliance&#8230;&#8203; para que seja exibida a tela do assistente de importação de appliance. Clique em Escolher.</p>
</li>
<li>
<p>Outra janela será apresentada solicitando a seleção de um appliance para importar. Selecione em Desktop\Aluno\VMs_PRONTAS\VM o arquivo LAB_W7_VM-ADS5.OVA e clique em Abrir.</p>
</li>
<li>
<p>As configurações de importação da máquina virtual serão apresentadas em forma de sumário. Clique em Finalizar para iniciar a importação da máquina virtual.</p>
<div id="img-vbox5" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox5.png" alt="vbox5">
</div>
<div class="title">Figure 5. Importando VM</div>
</div>
<div class="paragraph">
<p>Uma barra de progresso será exibida mostrando o avanço da importação da máquina virtual.</p>
</div>
<div id="img-vbox6" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox6.png" alt="vbox6">
</div>
<div class="title">Figure 6. Importando VM, progresso</div>
</div>
<div class="paragraph">
<p>Você poderá visualizar a máquina virtual importada na lista de máquinas virtuais do VirtualBox.</p>
</div>
<div id="img-vbox7" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox7.png" alt="vbox7">
</div>
<div class="title">Figure 7. VM importada com sucesso</div>
</div>
</li>
<li>
<p>Inicie a máquina virtual e verifique se houve algum problema no processo.</p>
<div class="paragraph">
<p>Para evitar conflito de IP na rede, edite o endereço MAC da máquina virtual em Configurações/Rede/Avançado.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_utilizando_snapshots">5) Utilizando snapshots</h3>
<div class="paragraph">
<p>Snapshots são pontos de restauração das máquinas virtuais que podem ser usados para retornar a uma situação anterior de uma máquina virtual.</p>
</div>
<div class="paragraph">
<p>O recurso do snapshot é útil quando se quer fazer uma alteração no sistema operacional, com a segurança de poder recuperar o seu estado inicial caso algo dê errado durante a alteração. Você pode então criar um snapshot da máquina virtual antes de alterar o seu sistema, e se a alteração não for do seu agrado, é possível retornar ao estado anterior com o snapshot criado. O disco voltará ao mesmo ponto em que foi criado o snapshot, assim como a memória, se o mesmo for criado com esta opção.</p>
</div>
<div class="paragraph">
<p>Para criar um snapshot de uma máquina virtual, precisaremos de uma já criada. Para isto, na lista de máquinas virtuais do seu inventário, selecione a máquina VM-ADS5 que importamos na atividade anterior.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Localize no VirtualBox a aba Snapshots, clique no ícone Criar Snapshot, digite um nome e a descrição do snapshot tirado e clique em Ok.</p>
<div id="img-vbox8" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox8.png" alt="vbox8">
</div>
<div class="title">Figure 8. Criando snapshots</div>
</div>
</li>
<li>
<p>Inicie a máquina virtual VM-ADS5 e faça alterações no sistema. O login da máquina virtual é aluno e a senha é rnpesr.</p>
<div class="paragraph">
<p>Exemplo: crie diretórios, arquivos de texto, edite arquivos de configuração, apague arquivos existentes e instale programas.</p>
</div>
</li>
<li>
<p>Após alterar o sistema, desligue-o.</p>
</li>
<li>
<p>Volte à aba Snapshots e selecione o mesmo snapshot criado anteriormente. Depois clique no ícone Restaurar . Aparecerá uma janela para confirmação. Clique em Restaurar e aguarde a restauração da máquina virtual.</p>
</li>
<li>
<p>Inicie novamente a máquina virtual e perceba que ela retorna ao estado anterior, descartando todas as alterações realizadas.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_removendo_uma_máquina_virtual">6) Removendo uma máquina virtual</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selecione a VM que deseja excluir, clique com o botão direito e em seguida em Remover.</p>
</li>
<li>
<p>Será apresentada uma frase indicando que existem duas formas de excluir uma VM.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Apagar todos os arquivos: Apaga os arquivos de configuração da máquina virtual e também o seu disco rígido virtual.</p>
</li>
<li>
<p>Remover apenas: Apenas remove a máquina virtual do VirtualBox, mantendo os seus arquivos armazenados no disco rígido da máquina hospedeira.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_7_criando_máquinas_virtuais_no_vmware_workstation">7) Criando máquinas virtuais no VMware Workstation</h3>
<div class="paragraph">
<p>Os passos para a instalação do VMware Workstation são muito semelhantes aos do VirtualBox. Ao final da instalação selecione a opção de uso para 30 dias. Para aproveitar todos os seus recursos é necessário a compra de uma licença.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inicie o VMware Workstation e clique no botão Create New Virtual Machine ou acesse o menu File&gt; New&gt; Virtual Machine.</p>
<div id="img-vbox9" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox9.png" alt="vbox9">
</div>
<div class="title">Figure 9. Tela inicial do VMWare</div>
</div>
<div class="paragraph">
<p>Em boas-vindas, você deverá optar entre criar uma máquina virtual típica (typical) ou personalizada (custom). Escolha a opção Custom para criar uma máquina virtual com configuração otimizada dos seus recursos. Clique em Next.</p>
</div>
<div id="img-vbox10" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox10.png" alt="vbox10">
</div>
<div class="title">Figure 10. Criação de VMs</div>
</div>
<div class="paragraph">
<p>Nesta etapa, defina a versão do VMware Workstation com a qual você deseja que a sua máquina virtual seja compatível (com as versões mais novas ou mais antigas). Escolha a versão atual do Workstation (14.x) e clique em Next.</p>
</div>
<div id="img-vbox11" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox11.png" alt="vbox11">
</div>
<div class="title">Figure 11. Compatibilidade de hardware</div>
</div>
<div class="paragraph">
<p>Selecione a forma de instalação do sistema operacional: Instalar o SO a partir de uma mídia física de CD/DVD, de uma imagem ISO, arquivada no servidor de ISOs , ou instalar o sistema operacional depois. Escolha a última opção I wil install the operating system later, para instalar o sistema operacional depois e avance.</p>
</div>
<div id="img-vbox12" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox12.png" alt="vbox12">
</div>
<div class="title">Figure 12. Escolha da mídia</div>
</div>
<div class="paragraph">
<p>Selecione o SO e sua versão para instalação na máquina virtual (Guest Operating System). Clique em Next.</p>
</div>
</li>
<li>
<p>Em Virtual machine name informe como será identificada a máquina virtual. Este nome será identificado em todos os componentes do VMware Workstation. Utilize o nome VM-ADS5Ws.</p>
</li>
<li>
<p>Em Location, informe o diretório onde os arquivos da VM será salvos. Clique em Next.</p>
</li>
<li>
<p>Em Number of processors, configure o número de processadores da máquina hospedeira que a máquina virtual utilizará para o valor 1.</p>
<div class="paragraph">
<p>Em Number of cores per processor, configure o número de núcleos por processador da máquina física que a máquina virtual utilizará para o valor 1.</p>
</div>
<div id="img-vbox13" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox13.png" alt="vbox13">
</div>
<div class="title">Figure 13. Escolha do processador</div>
</div>
</li>
<li>
<p>Selecione a quantidade de memória RAM em megabytes a ser alocada para uso da máquina virtual. Mantenha a opção padrão e clique em Next.</p>
<div id="img-vbox14" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox14.png" alt="vbox14">
</div>
<div class="title">Figure 14. Escolha da memória</div>
</div>
</li>
<li>
<p>O VMware Workstation possui três opções de configuração de rede: Bridged, NAT e Host-only. Escolha a opção Bridged para que a máquina virtual tenha acesso direto à rede externa.</p>
<div id="img-vbox15" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox15.png" alt="vbox15">
</div>
<div class="title">Figure 15. Escolha da memória</div>
</div>
</li>
<li>
<p>Defina o tipo de controladora SCSI que você pretende utilizar. Deixe a opção padrão selecionada (LSI Logic SAS) e clique em Next.</p>
<div id="img-vbox16" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox16.png" alt="vbox16">
</div>
<div class="title">Figure 16. Tipo de controladora de disco</div>
</div>
<div class="paragraph">
<p>Defina o tipo do disco entre as opções SCSI ou IDE. Selecione SCSI e clique em Next.</p>
</div>
<div id="img-vbox17" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox17.png" alt="vbox17">
</div>
<div class="title">Figure 17. Tipo de disco</div>
</div>
<div class="paragraph">
<p>Em Disco, você pode escolher entre criar um novo disco virtual, utilizar um disco virtual existente ou utilizar um disco físico. Selecione a opção Create a new virtual disk para que seja criado um novo disco virtual. Clique em Next.</p>
</div>
<div id="img-vbox18" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox18.png" alt="vbox18">
</div>
<div class="title">Figure 18. Criar novo disco</div>
</div>
<div class="paragraph">
<p>Em capacidade do disco é possível configurar:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>O tamanho do disco rígido da máquina virtual;</p>
</li>
<li>
<p>A alocação de todo o espaço configurado para o momento da criação da máquina virtual (ou não);</p>
</li>
<li>
<p>Se os dados do disco estarão armazenados em um único arquivo ou serão divididos em mais arquivos.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Selecione 60GB como tamanho máximo do disco, marque a opção Store virtual disk as single file para que todo o conteúdo do disco rígido virtual seja armazenado em apenas um arquivo. Clique em Next para avançar.</p>
</div>
<div id="img-vbox19" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox19.png" alt="vbox19">
</div>
<div class="title">Figure 19. Capacidade do disco</div>
</div>
<div class="paragraph">
<p>Identifique e escolha onde o HD virtual será salvo e clique em Next.</p>
</div>
<div id="img-vbox20" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox20.png" alt="vbox20">
</div>
<div class="title">Figure 20. Nome do disco</div>
</div>
</li>
<li>
<p>Aparecerá a tela do sumário, ou seja, o resumo de toda a configuração da máquina virtual a ser criada. Neste momento, o VMware Workstation estará pronto para criar a sua máquina virtual.</p>
<div id="img-vbox21" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox21.png" alt="vbox21">
</div>
<div class="title">Figure 21. Confirmação das escolhas</div>
</div>
<div class="paragraph">
<p>Clique em Finish para finalizar a criação.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_8_iniciando_a_máquina_virtual">8) Iniciando a máquina virtual</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As máquinas virtuais disponíveis serão exibidas na janela principal do VMware Workstation. Selecione a máquina virtual criada (VM-ADS5) e  inicie clicando em Power on this virtual machine.</p>
<div id="img-vbox22" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox22.png" alt="vbox22">
</div>
<div class="title">Figure 22. Iniciar VM</div>
</div>
<div class="paragraph">
<p>Como nenhum SO foi instalado, ao iniciá-la será apresentada uma tela parecida com os dizeres abaixo, informando que não foi encontrado nenhum sistema operacional.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Network boot from AMD Am79C970A
Copyright (C) 2003-2005VMware, Inc.
Copyright (C) 1997-2000Intel Corporation
CLIENT MAC ADDR: 00 0C 29 45 E3 90 GUID: 564D95A9-506D-AA78-21B0-26E3F545E390
PXE-E51: No DHCP or proxyDHCP offers were received.
PXE-M0F: Exiting Intel PXE ROM.
Operating System not found</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_9_alterando_a_configuração_de_uma_mv">9) Alterando a configuração de uma MV</h3>
<div class="paragraph">
<p>É possível editar a máquina virtual (MV) criada no VMware Workstation. Dentre outras opções, é possível alterar o nome da máquina virtual, adicionar outro disco rígido virtual, aumentar o tamanho de memória que a máquina alocará para o seu uso e adicionar mais interfaces de rede. Nesta atividade, iremos visualizar as opções de edição de máquinas virtuais do VMware Workstation.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para editar uma máquina virtual, você precisará de uma já criada. Para isto, na lista de máquinas do seu inventário, selecione a máquina. Depois de selecionada, ao lado será aberto um sumário da máquina em questão. Clique no botão Edit virtual machine settings.</p>
<div class="paragraph">
<p>Suponha que tenha sido realizado um upgrade de mais 4 GB de memória e mais um disco rígido de 1 TB na máquina hospedeira, com o objetivo de acrescentar mais recursos às suas máquinas virtuais.</p>
</div>
<div class="paragraph">
<p>Em Memory há a opção de editar o tamanho da memória que a máquina virtual alocará para o seu uso. Altere o tamanho em Memory for this virtual machine para 1024 MB.</p>
</div>
<div class="paragraph">
<p>O tamanho da nova quantidade de memória deve ser múltiplo de 4. Lembrando que temos que deixar disponível para o sistema operacional nativo uma quantidade recomendada para que possa funcionar de forma estável.</p>
</div>
</li>
<li>
<p>Em Processors há a opção de editar o número de processadores (Number of processors) e o número de núcleos por processadores (Number of cores per processor) que a nossa máquina virtual utilizará. Não faça alterações nesta etapa, deixando as configurações de acordo com o que definimos na criação da máquina virtual.</p>
</li>
<li>
<p>Em Hard Disk é possível visualizar o caminho no qual está arquivado o disco rígido da máquina virtual (Disk file), analisar a sua capacidade atual (Capacity), informações de alocação e a forma como o disco rígido virtual foi armazenado (Disk information). Em Utilities são mostradas outras ferramentas para alteração e manutenção do disco rígido:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Map: utilizado para mapear o disco rígido virtual na máquina hospedeira Windows;</p>
</li>
<li>
<p>Defragment: semelhante ao Desfragmentador de disco do Windows, onde a ferramenta efetua operações no disco rígido para procurar e solucionar problemas de fragmentação;</p>
</li>
<li>
<p>Expand: utilizado para aumentar o tamanho do disco rígido da máquina virtual;</p>
</li>
<li>
<p>Compact: utilizado para compactar automaticamente o disco rígido da máquina virtual.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Em CD/DVD há a opção de ativar o drive de CD/DVD assim que a máquina virtual for ligada (Connect at power on), de fazer com que a máquina virtual use um drive físico (Use physical drive) ou fazer com que a máquina virtual use uma imagem ISO armazenada (Use ISO image file). Para esta atividade, utilizaremos a configuração da tela seguinte.</p>
</div>
</li>
<li>
<p>Em Network Adapter há também a opção de ativar a placa de rede da máquina virtual assim que ela for ligada (Connect at power on) e escolher o tipo de conexão de rede que utilizaremos:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Bridged: habilita a máquina virtual a ter acesso direto à rede;</p>
</li>
<li>
<p>Replicate physical network connection state: replica o estado da conexão da rede física;</p>
</li>
<li>
<p>NAT: opção que compartilha o endereço IP do host.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Também podemos editar o controlador USB da máquina virtual, ativando o suporte à alta velocidade para dispositivos com USB 2.0 e automaticamente conectar novos dispositivos USB. Mantenha as opções conforme a tela seguinte.</p>
</li>
<li>
<p>Podemos editar as propriedades de som da máquina virtual para decidir se ela utilizará a placa de som padrão do host, ou especificar a placa de som do host que a máquina virtual utilizará. Mantenha as opções conforme a tela seguinte.</p>
</li>
<li>
<p>É possível conectar uma impressora à máquina virtual, mas para isso ela precisa ter o VMware Tools instalado - suíte de utilitários que melhora o desempenho da máquina virtual. Mantenha as opções conforme a tela seguinte.</p>
</li>
<li>
<p>Por último, é possível editar as propriedades de vídeo da máquina virtual. Podemos ativar a aceleração 3D dos gráficos, usar as configurações de vídeo da máquina hospedeira ou especificar as configurações informando o número de monitores e a resolução máxima de cada monitor.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_10_adicionando_uma_máquina_virtual">10) Adicionando uma máquina virtual</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Na tela inicial do VMware Workstation clique em Open a Virtual Machine e selecione a VM já existente no caminho Desktop\Aluno\VMs_PRONTAS/VM da máquina hospedeira. Ao concluir o processo inicie a VM.</p>
<div id="img-vbox23" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox23.png" alt="vbox23">
</div>
<div class="title">Figure 23. Adicionar VM pronta</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_11_utilizando_snapshots">11) Utilizando snapshots</h3>
<div class="paragraph">
<p>Como foi visto anteriormente no VirtualBox , o snapshots são pontos de restauração das máquinas virtuais que podem ser usados para retornar a uma situação anterior de uma VM.</p>
</div>
<div class="paragraph">
<p>Exemplo: você deseja fazer alguma alteração no sistema operacional, mas quer ter a segurança de recuperar o seu estado inicial caso algo dê errado durante a alteração. Você pode então criar um snapshot da máquina virtual antes de alterar o seu sistema, e se a alteração não for do seu agrado, será possível retornar ao estado anterior do sistema através do snapshot criado. O disco voltará ao mesmo ponto em que foi criado o snapshot, assim como a memória, se o mesmo for criado com esta opção.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Na lista Favorites selecione a máquina W7_VM-ADS5 que adicionamos na atividade anterior. Click com o botão direito do mouse em cima da VM e selecione Snapshot/ Take Snapshot&#8230;&#8203;</p>
</li>
<li>
<p>Digite uma descrição para o snapshot a ser tirado, para que possamos identificá-lo posteriormente.</p>
</li>
<li>
<p>Inicie a máquina virtual recentemente adicionada e faça alterações no sistema. O login da máquina virtual é aluno e a senha é rnpesr.</p>
<div class="paragraph">
<p>Crie diretórios e arquivos de texto, edite arquivos de configuração, apague arquivos existentes, instale ou instale programas. Após as modificação, desligue a VM e volte ao menu Snapshot, mas desta vez acesse Snapshot Manager. Note que poderá voltar ao estado anterior ao Snapshot sem a necessidade de desligar a máquina.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_12_removendo_máquinas_virtuais">12) Removendo máquinas virtuais</h3>
<div class="paragraph">
<p>No VMware Workstation existem duas opções de remoção das máquinas virtuais: removê-las da lista de máquinas favoritas ou removê-las do disco rígido da máquina hospedeira. Para remover máquinas virtuais, abra o Workstation e certifique-se de que a máquina desejada está desligada, para que possa ser removida. Siga as instruções para a remoção.</p>
</div>
<div class="paragraph">
<p>No VMware Workstation, selecione a máquina virtual que você deseja excluir, vá ao menu VM&gt; Manage e clique em Delete from Disk.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ao clicar na função, é apresentada uma janela informando que essa ação é irreversível e que a mesma fará com que a máquina virtual seja excluída permanentemente. Caso você clique em Yes, a máquina virtual será excluída do gerenciamento do VMware Workstation e do disco rígido da máquina hospedeira. Para a atividade, clique em No para cancelar a exclusão.</p>
<div id="img-vbox24" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox24.png" alt="vbox24">
</div>
<div class="title">Figure 24. Removendo VM definitivamente</div>
</div>
</li>
<li>
<p>Caso queira remove-la apenas do inventário, clique sobre a máquina e selecione Remove. Aparecerá uma janela informando que a máquina será removida apenas do inventário.</p>
<div id="img-vbox25" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox25.png" alt="vbox25">
</div>
<div class="title">Figure 25. Removendo VM do inventário</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_13_captura_de_máquina_física_para_virtual_p2v">13) Captura de máquina física para virtual (P2V)</h3>
<div class="paragraph">
<p>Physical-to-Virtual (P2V) é o processo que consiste em converter uma máquina física com os seus aplicativos e dados para uma máquina virtual, podendo hospedá-la em uma plataforma virtualizada.</p>
</div>
<div class="paragraph">
<p>Nesta atividade, o aluno terá que fazer a conversão da estação física do colega do lado para uma máquina virtual, utilizando como base a ferramenta de conversão do VMware Converter.</p>
</div>
<div class="paragraph">
<p>O instalador do VMWare converter está disponível na pasta \Desktop\Aluno\SESSÃO 1_2. A instalação é simples porém é necessário prestar atenção em algumas etapas: em "Setup Type", você deverá marcar a opção "Client-Server installation (advanced)" e em "HTTPS Service Port" altere a porta para 444 , clique em "next" e nesta tela, desmarque a opção "Join the VMware&#8217;s Custumer&#8230;&#8203;", avance e clique em "install".</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Antes de converter a máquina física, faça alguns procedimentos para que posteriormente possam identificar que realmente houve a conversão. Sugestões: trocar a cor do seu papel de parede, criar arquivos ".txt” no desktop etc.</p>
</li>
<li>
<p>Inicie o VMware Workstation Pro, e em "File" selecione "Virtualize a Physical Machine" e e clique em Next.</p>
</li>
<li>
<p>Nesta tela, você deverá adicionar o IP, usuário e senha  da máquina a qual deseja converter.</p>
<div id="img-vbox26" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox26.png" alt="vbox26">
</div>
<div class="title">Figure 26. Conversão de máquina física para virtual, parte 1</div>
</div>
</li>
<li>
<p>Adicione um nome a VM e e escolha o diretório para armazenar a máquina virtual.</p>
<div id="img-vbox27" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox27.png" alt="vbox27">
</div>
<div class="title">Figure 27. Conversão de máquina física para virtual, parte 2</div>
</div>
</li>
<li>
<p>Nesta tela, autentique com usuário e senha da máquina física. Esta é a máquina onde o VMware Workstation está instalado. Avance e aguarde o final do processo.</p>
<div id="img-vbox28" class="imageblock text-center">
<div class="content">
<img src="./img/1_Virtualbox/vbox28.png" alt="vbox28">
</div>
<div class="title">Figure 28. Conversão de máquina física para virtual, parte 3</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Obs.: Caso ocorra algum erro relacionado a espaço em disco, acesse o gerenciador do Windows 7 e aumente o espaço da partição "Reservado pelo Sistema" para no mínimo 100 megas.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_2_configuração_de_storage">Sessão 2: Configuração de Storage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_instalação_do_freenas">1) Instalação do FreeNAS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crie uma nova máquina virtual, na qual instalaremos o FreeNAS, do tipo BSD 64-bit.</p>
<div id="img-freenas1" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas1.png" alt="freenas1">
</div>
<div class="title">Figure 29. Nome e tipo de VM</div>
</div>
</li>
<li>
<p>Para a memória RAM, define 2GB.</p>
<div id="img-freenas2" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas2.png" alt="freenas2">
</div>
<div class="title">Figure 30. RAM da VM</div>
</div>
</li>
<li>
<p>Iremos adicionar um novo disco rígido:</p>
<div id="img-freenas3" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas3.png" alt="freenas3">
</div>
<div class="title">Figure 31. Adicionar novo disco</div>
</div>
<div class="paragraph">
<p>O tipo do disco será VDI, o formato nativo do Virtualbox.</p>
</div>
<div id="img-freenas4" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas4.png" alt="freenas4">
</div>
<div class="title">Figure 32. Tipo do disco</div>
</div>
<div class="paragraph">
<p>Iremos usar alocação dinâmica, quando o disco cresce à medida que é utilizado.</p>
</div>
<div id="img-freenas5" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas5.png" alt="freenas5">
</div>
<div class="title">Figure 33. Tipo de alocação</div>
</div>
<div class="paragraph">
<p>Finalmente, escolha o nome e o tamanho do disco (4 GB).</p>
</div>
<div id="img-freenas6" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas6.png" alt="freenas6">
</div>
<div class="title">Figure 34. Nome e tamanho do disco</div>
</div>
</li>
<li>
<p>Criada a VM, acesse o menu <em>Configurações</em>. Vamos adicionar dois novos discos à máquina, onde serão armazenados os dados do <em>storage</em>. Em <em>Armazenamento</em> &gt; <em>Controladora SCSI</em>, clique no ícone <em>Adicionar novo disco</em>.</p>
<div id="img-freenas7" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas7.png" alt="freenas7">
</div>
<div class="title">Figure 35. Configurações de disco</div>
</div>
<div class="paragraph">
<p>Selecione <em>Criar novo disco</em>.</p>
</div>
<div id="img-freenas8" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas8.png" alt="freenas8">
</div>
<div class="title">Figure 36. Criar novo disco</div>
</div>
<div class="paragraph">
<p>Selecione o nome do disco, e tamanho de 80 GB.</p>
</div>
<div id="img-freenas9" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas9.png" alt="freenas9">
</div>
<div class="title">Figure 37. Nome e tamanho do disco 2</div>
</div>
<div class="paragraph">
<p>Repita o procedimento, adicionando um terceiro disco à VM, também de 80 GB.</p>
</div>
<div id="img-freenas10" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas10.png" alt="freenas10">
</div>
<div class="title">Figure 38. Nome e tamanho do disco 3</div>
</div>
<div class="paragraph">
<p>Finalmente, marque a opção <em>Utilizar cache de I/O do hospedeiro</em> para aumentar a performance no uso da VM.</p>
</div>
<div id="img-freenas11" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas11.png" alt="freenas11">
</div>
<div class="title">Figure 39. Uso de cache de disco</div>
</div>
</li>
<li>
<p>Ainda no menu <em>Armazenamento</em>, em <em>Controladora IDE</em>, adicione a imagem ISO de instalação do FreeNAS ao <em>drive</em> de CD virtual da VM.</p>
<div id="img-freenas12" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas12.png" alt="freenas12">
</div>
<div class="title">Figure 40. Adicionando ISO de instalação</div>
</div>
</li>
<li>
<p>Em <em>Áudio</em>, desabilite o áudio da VM. Como será um servidor, não fará falta.</p>
<div id="img-freenas13" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas13.png" alt="freenas13">
</div>
<div class="title">Figure 41. Configurações de áudio</div>
</div>
</li>
<li>
<p>Em <em>Rede</em>, altere o tipo de conexão do <em>Adaptador 1</em> para <em>Placa em modo Bridge</em>, para conectar a VM diretamente com a rede externa.</p>
<div id="img-freenas14" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas14.png" alt="freenas14">
</div>
<div class="title">Figure 42. Configurações de rede</div>
</div>
</li>
<li>
<p>Em <em>USB</em>, marque a <em>Controladora USB 1.1 (OHCI)</em>, para maior compatibilidade caso as extensões do Virtualbox não estejam instaladas.</p>
<div id="img-freenas15" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas15.png" alt="freenas15">
</div>
<div class="title">Figure 43. Configurações USB</div>
</div>
</li>
<li>
<p>Ligue a VM, e selecione a opção <em>FreeNAS Installer</em> na tela de <em>boot</em>.</p>
<div id="img-freenas16" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas16.png" alt="freenas16">
</div>
<div class="title">Figure 44. Boot do instalador</div>
</div>
<div class="paragraph">
<p>A seguir, selecione <em>Install/Upgrade</em>.</p>
</div>
<div id="img-freenas17" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas17.png" alt="freenas17">
</div>
<div class="title">Figure 45. Instalação, parte 1</div>
</div>
<div class="paragraph">
<p>Você receberá um aviso que o computador possui menos de 8 GB de RAM. Clique em <em>Yes</em> para prosseguir.</p>
</div>
<div id="img-freenas18" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas18.png" alt="freenas18">
</div>
<div class="title">Figure 46. Instalação, parte 2</div>
</div>
<div class="paragraph">
<p>Para a instalação do FreeNAS, selecione o disco <code>ada0</code>, de 4 GB. Iremos inicializar os demais posteriormente.</p>
</div>
<div id="img-freenas19" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas19.png" alt="freenas19">
</div>
<div class="title">Figure 47. Instalação, parte 3</div>
</div>
<div class="paragraph">
<p>Confirme a formatação selecionando <em>Yes</em>.</p>
</div>
<div id="img-freenas20" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas20.png" alt="freenas20">
</div>
<div class="title">Figure 48. Instalação, parte 4</div>
</div>
<div class="paragraph">
<p>Para a senha do usuário <code>root</code>, digite <code>Virt3sr</code> e confirme.</p>
</div>
<div id="img-freenas21" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas21.png" alt="freenas21">
</div>
<div class="title">Figure 49. Instalação, parte 5</div>
</div>
<div class="paragraph">
<p>No tipo de <em>boot</em> do FreeNAS, selecione <em>Boot via BIOS</em>.</p>
</div>
<div id="img-freenas22" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas22.png" alt="freenas22">
</div>
<div class="title">Figure 50. Instalação, parte 6</div>
</div>
<div class="paragraph">
<p>A instalação será iniciada, como mostrado abaixo.</p>
</div>
<div id="img-freenas23" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas23.png" alt="freenas23">
</div>
<div class="title">Figure 51. Instalação, progresso</div>
</div>
<div class="paragraph">
<p>Ao final do processo, clique em <em>OK</em> para reiniciar o sistema.</p>
</div>
<div id="img-freenas24" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas24.png" alt="freenas24">
</div>
<div class="title">Figure 52. Instalação concluída</div>
</div>
</li>
<li>
<p>Como não retiramos a ISO da VM, após o <em>boot</em> veremos o menu de instalação novamente. Selecione <em>Shutdown System</em>.</p>
<div id="img-freenas25" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas25.png" alt="freenas25">
</div>
<div class="title">Figure 53. Retirando ISO da VM, parte 1</div>
</div>
<div class="paragraph">
<p>Acesse <em>Configurações</em> &gt; <em>Armazenamento</em> e remova a ISO do <em>drive</em> IDE.</p>
</div>
<div id="img-freenas26" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas26.png" alt="freenas26">
</div>
<div class="title">Figure 54. Retirando ISO da VM, parte 2</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_configuração_do_freenas">2) Configuração do FreeNAS</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ligue a VM. Você verá a tela de <em>boot</em> abaixo.</p>
<div id="img-freenas27" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas27.png" alt="freenas27">
</div>
<div class="title">Figure 55. Boot do FreeNAS</div>
</div>
<div class="paragraph">
<p>Pressione <code>ENTER</code>, e selecione a opção <em>Normal Bootup</em>.</p>
</div>
<div id="img-freenas28" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas28.png" alt="freenas28">
</div>
<div class="title">Figure 56. Boot convencional</div>
</div>
</li>
<li>
<p>Após o processo de <em>boot</em>, você verá o menu a seguir. Anote o endereço IP da interface web de usuário, que acessaremos a seguir.</p>
<div id="img-freenas29" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas29.png" alt="freenas29">
</div>
<div class="title">Figure 57. Boot concluído</div>
</div>
</li>
<li>
<p>Em sua máquina física, abra um navegador e digite o endereço IP anotado no passo anterior. Na tela de login, informe o usuário <code>root</code> e senha <code>Virt3sr</code>, como definido anteriormente.</p>
<div id="img-freenas30" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas30.png" alt="freenas30">
</div>
<div class="title">Figure 58. Login na interface web</div>
</div>
</li>
<li>
<p>No <em>wizard</em> automático de configuração, defina linguagem, mapa de teclado e <em>timezone</em> como mostrado na figura a seguir:</p>
<div id="img-freenas31" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas31.png" alt="freenas31">
</div>
<div class="title">Figure 59. Escolha de idioma, teclado e timezone</div>
</div>
<div class="paragraph">
<p>O próximo passo é inicializar um volume de armazenamento. Digite o nome <code>vol1</code> e selecione o tipo <em>Logs</em> (equivalente a RAID 0).</p>
</div>
<div id="img-freenas32" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas32.png" alt="freenas32">
</div>
<div class="title">Figure 60. Configuração de volume</div>
</div>
<div class="paragraph">
<p>Para configurações de autenticação, mantenha tudo vazio e clique em <em>Next</em>.</p>
</div>
<div id="img-freenas33" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas33.png" alt="freenas33">
</div>
<div class="title">Figure 61. Configurações de autenticação</div>
</div>
<div class="paragraph">
<p>Em configurações de <em>share</em>, novamente mantenha vazio e clique em <em>Next</em>.</p>
</div>
<div id="img-freenas34" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas34.png" alt="freenas34">
</div>
<div class="title">Figure 62. Configurações de share</div>
</div>
<div class="paragraph">
<p>Para configurações de mensagem, ative <em>Console messages</em> e clique em <em>Next</em>.</p>
</div>
<div id="img-freenas35" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas35.png" alt="freenas35">
</div>
<div class="title">Figure 63. Configurações de mensagens</div>
</div>
<div class="paragraph">
<p>Finalmente, confirme as alterações.</p>
</div>
<div id="img-freenas36" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas36.png" alt="freenas36">
</div>
<div class="title">Figure 64. Wizard, confirmação</div>
</div>
</li>
<li>
<p>Finalizado o <em>wizard</em>, acesse <em>Storage</em> &gt; <em>Volumes</em> e clique em <em>Criar zvol</em>.</p>
<div id="img-freenas37" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas37.png" alt="freenas37">
</div>
<div class="title">Figure 65. Criação de zvol, parte 1</div>
</div>
<div class="paragraph">
<p>Defina o nome como <code>zvol1</code> e tamanho de 80 GB. Iremos tentar manter o uso do <em>pool</em> abaixo de 50% para evitar degradação de performance, como documentado em <a href="https://www.ixsystems.com/documentation/freenas/11/sharing.html#extents" class="bare">https://www.ixsystems.com/documentation/freenas/11/sharing.html#extents</a> .</p>
</div>
<div id="img-freenas39" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas39.png" alt="freenas39">
</div>
<div class="title">Figure 66. Criação de zvol, parte 2</div>
</div>
<div class="paragraph">
<p>A tela final de configuração deverá ficar como se segue:</p>
</div>
<div id="img-freenas40" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas40.png" alt="freenas40">
</div>
<div class="title">Figure 67. Criação de zvol, concluída</div>
</div>
</li>
<li>
<p>Agora, acesse <em>Sharing</em> &gt; <em>Block (iSCSI)</em> e configure um portal iSCSI em <em>Adicionar Portal</em> como mostrado a seguir:</p>
<div id="img-freenas41" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas41.png" alt="freenas41">
</div>
<div class="title">Figure 68. Configuração de iSCSI, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>Iniciadores</em>, defina um mapeamento <code>ALL:ALL</code>.</p>
</div>
<div id="img-freenas42" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas42.png" alt="freenas42">
</div>
<div class="title">Figure 69. Configuração de iSCSI, parte 2</div>
</div>
<div class="paragraph">
<p>Na configuração do <em>Acesso Autorizado</em>, defina uma conta <code>aluno</code> com senha <code>rnpesr123456</code>.</p>
</div>
<div id="img-freenas43" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas43.png" alt="freenas43">
</div>
<div class="title">Figure 70. Configuração de iSCSI, parte 3</div>
</div>
<div class="paragraph">
<p>Nos destinos iSCSI, adicione um novo destino com nome <code>lun1</code>, e apelido <code>Target1</code>.</p>
</div>
<div id="img-freenas44" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas44.png" alt="freenas44">
</div>
<div class="title">Figure 71. Configuração de iSCSI, parte 4</div>
</div>
<div class="paragraph">
<p>Na configuração de <em>Extents</em>, defina um com nome <code>Extent1</code> mapeando o dispositivo <code>zvol1</code> criado anteriormente.</p>
</div>
<div id="img-freenas45" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas45.png" alt="freenas45">
</div>
<div class="title">Figure 72. Configuração de iSCSI, parte 5</div>
</div>
<div class="paragraph">
<p>Finalmente, mapeie a <code>lun1</code> para o <code>Extent1</code>, definindo uma LUN ID de <code>1</code>.</p>
</div>
<div id="img-freenas46" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas46.png" alt="freenas46">
</div>
<div class="title">Figure 73. Configuração de iSCSI, parte 6</div>
</div>
</li>
<li>
<p>O último passo é ativar o serviço iSCSI. Acesse <em>Serviços</em> e ative <code>iSCSI</code>, ativando a opção <em>Start on boot</em>.</p>
<div id="img-freenas47" class="imageblock text-center">
<div class="content">
<img src="./img/2_FreeNAS/freenas47.png" alt="freenas47">
</div>
<div class="title">Figure 74. Ativando iSCSI</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_3_introdução_ao_xcp_ng">Sessão 3: Introdução ao XCP-ng</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_instalação_do_xcp_ng">1) Instalação do XCP-ng</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crie uma mídia bootável com o instalador do XCP-ng, conforme instruções providas pelo instrutor. Em seguida, insira a mídia na máquina destacada como hypervisor para a dupla e execute o <em>boot</em> via USB. Você verá a tela a seguir:</p>
<div id="img-xcpng1" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng1.png" alt="xcpng1">
</div>
<div class="title">Figure 75. Tela inicial do XCP-ng</div>
</div>
</li>
<li>
<p>Inicie o <em>boot</em> do sistema. A primeira tela será para a configuração do mapa de teclado: selecione <code>br-abnt2</code>.</p>
<div id="img-xcpng2" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng2.png" alt="xcpng2">
</div>
<div class="title">Figure 76. Configuração de teclado</div>
</div>
</li>
<li>
<p>Prossiga a instalação selecionando <code>Ok</code>.</p>
<div id="img-xcpng3" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng3.png" alt="xcpng3">
</div>
<div class="title">Figure 77. Confirmação de instalação</div>
</div>
<div class="paragraph">
<p>Aceite os termos de uso em <code>Accept EULA</code>.</p>
</div>
<div id="img-xcpng4" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng4.png" alt="xcpng4">
</div>
<div class="title">Figure 78. Temos de uso</div>
</div>
</li>
<li>
<p>Selecione o disco de instalação do sistema, <code>sda</code>, que deve corresponder ao disco rígido da máquina local.</p>
<div id="img-xcpng5" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng5.png" alt="xcpng5">
</div>
<div class="title">Figure 79. Seleção de disco de instalação</div>
</div>
</li>
<li>
<p>Escolha a fonte de instalação dos pacotes, <code>Local media</code>.</p>
<div id="img-xcpng6" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng6.png" alt="xcpng6">
</div>
<div class="title">Figure 80. Seleção de fonte de pacotes</div>
</div>
<div class="paragraph">
<p>Não faça a verificação da mídia, é um processo bastante demorado.</p>
</div>
<div id="img-xcpng7" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng7.png" alt="xcpng7">
</div>
<div class="title">Figure 81. Verificação de mídia</div>
</div>
</li>
<li>
<p>Defina a senha do <code>root</code> como <code>Virt3sr</code>.</p>
<div id="img-xcpng8" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng8.png" alt="xcpng8">
</div>
<div class="title">Figure 82. Definir senha do root</div>
</div>
</li>
<li>
<p>O próximo passo é configurar a rede: mantenha a configuração em DHCP.</p>
<div id="img-xcpng9" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng9.png" alt="xcpng9">
</div>
<div class="title">Figure 83. Configuração de rede, parte 1</div>
</div>
<div class="paragraph">
<p>Depois, defina o nome de máquina como <code>xcp-ng-dX-gX</code>, substituindo <code>X</code> pelo dados apropriados para seu grupo. Mantenha a configuração DNS como automática.</p>
</div>
<div id="img-xcpng10" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng10.png" alt="xcpng10">
</div>
<div class="title">Figure 84. Configuração de rede, parte 2</div>
</div>
</li>
<li>
<p>Agora, escolha o <em>timezone</em> do sistema. Primeiro, selecione a área geográfica <code>America</code>&#8230;&#8203;</p>
<div id="img-xcpng11" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng11.png" alt="xcpng11">
</div>
<div class="title">Figure 85. Timezone e hora, parte 1</div>
</div>
<div class="paragraph">
<p>E em seguida a cidade apropriada, provavemente <code>Sao_Paulo</code> ou <code>Recife</code>.</p>
</div>
<div id="img-xcpng12" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng12.png" alt="xcpng12">
</div>
<div class="title">Figure 86. Timezone e hora, parte 2</div>
</div>
<div class="paragraph">
<p>Defina a configuração de tempo via NTP.</p>
</div>
<div id="img-xcpng13" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng13.png" alt="xcpng13">
</div>
<div class="title">Figure 87. Timezone e hora, parte 3</div>
</div>
<div class="paragraph">
<p>Para o servidor de consulta, defina manualmente o endereço <code>pool.ntp.br</code>.</p>
</div>
<div id="img-xcpng14" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng14.png" alt="xcpng14">
</div>
<div class="title">Figure 88. Timezone e hora, parte 4</div>
</div>
</li>
<li>
<p>Tudo pronto para a instalação: confirme em <code>Install XCP-ng</code>.</p>
<div id="img-xcpng15" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng15.png" alt="xcpng15">
</div>
<div class="title">Figure 89. Início da instalação</div>
</div>
<div class="paragraph">
<p>Observe o progresso:</p>
</div>
<div id="img-xcpng16" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng16.png" alt="xcpng16">
</div>
<div class="title">Figure 90. Instalação em progresso</div>
</div>
<div class="paragraph">
<p>Quando perguntado se deseja instalar <em>supplemental packs</em>, selecione <em>No</em>.</p>
</div>
<div id="img-xcpng17" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng17.png" alt="xcpng17">
</div>
<div class="title">Figure 91. Instalação de pacotes adicionais</div>
</div>
<div class="paragraph">
<p>Concluído o processo, selecione <em>Ok</em>, espere o sistema reiniciar e remova a mídia de instalação.</p>
</div>
<div id="img-xcpng18" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng18.png" alt="xcpng18">
</div>
<div class="title">Figure 92. Instalação concluída</div>
</div>
</li>
<li>
<p>Após o <em>boot</em> do sistema, você verá a tela de sumário do XCP-ng, como mostrado a seguir.</p>
<div id="img-xcpng19" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng19.png" alt="xcpng19">
</div>
<div class="title">Figure 93. Tela de sumário</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_conhecendo_alguns_comandos_básicos">2) Conhecendo alguns comandos básicos</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Você pode abrir uma conexão de linha de comando local, usando a opção <em>Local Command Shell</em>. Digite a senha de <code>root</code> para obter o acesso.</p>
<div id="img-xcpng20" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng20.png" alt="xcpng20">
</div>
<div class="title">Figure 94. Acesso à CLI local</div>
</div>
</li>
<li>
<p>O XCP-ng possui uma ferramenta de gerenciamento em linha de comando chamada <code>xe</code>. Esta ferramenta permite o controle do armazenamento de dados das máquinas virtuais, interfaces de redes associadas com as VMs, ente outros.</p>
<div class="paragraph">
<p>Veja o comando <code>xe host-list</code>, por exemplo:</p>
</div>
<div id="img-xcpng21" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng21.png" alt="xcpng21">
</div>
<div class="title">Figure 95. Listando hosts</div>
</div>
</li>
<li>
<p>Durante a instalação, o XCP-ng particiona automaticamente o disco do servidor utilizado. São reservados para o sistema apenas 4 GB. O restante do disco é alocado em um volume LVM, dentro do qual podem ser armazenados os dados das máquinas virtuais. Para visualizar as informações do LVM, utilize comando <code>pvdisplay</code> no <em>shell</em> do hypervisor:</p>
<div id="img-xcpng22" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng22.png" alt="xcpng22">
</div>
<div class="title">Figure 96. Visualizando volumes físicos</div>
</div>
</li>
<li>
<p>O XCP-ng gerencia estes volumes LVM através da noção de <em>Storage Repositories</em> (SR). Um <em>Storage Repository</em> corresponde a uma área no <em>storage</em> onde são armazenados os discos virtuais de uma máquina virtual, ou as imagens ISO utilizadas para instalação de novas máquinas virtuais. Para uma listagem dos <em>Storage Repositories</em> disponíveis, utilize o comando <code>sr-list</code>:</p>
<div id="img-xcpng23" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng23.png" alt="xcpng23">
</div>
<div class="title">Figure 97. Listando SRs</div>
</div>
<div class="paragraph">
<p>Note que um dos <em>Storage Repositories</em> disponíveis é do tipo LVM no host local, cujo UUID consta no nome do <em>Volume Group</em> listado anteriormente. Durante a instanciação de novas máquinas virtuais, os discos serão automaticamente instanciados dentro deste <em>Storage Repository</em>.</p>
</div>
</li>
<li>
<p>Por padrão, o XCP-ng cria para cada interface de rede física uma <em>bridge</em>. Nesta, podem ser associadas as interfaces de rede das máquinas virtuais, permitindo aos sistemas virtualizados acessarem a rede externa de forma transparente.</p>
<div class="paragraph">
<p>As redes disponíveis para as VMs podem ser listadas com o comando <code>network-list</code>:</p>
</div>
<div id="img-xcpng24" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng24.png" alt="xcpng24">
</div>
<div class="title">Figure 98. Listando redes</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_instalação_do_xcp_ng_center">3) Instalação do XCP-ng Center</h3>
<div class="paragraph">
<p>O XCP-ng Center é uma ferramenta capaz de gerenciar múltiplos servidores e máquinas virtuais.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para iniciar a instalação do XCP-ng Center, execute o arquivo de instalação disponível em local indicado pelo instrutor. Você verá a tela a seguir:</p>
<div id="img-xcpng25" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng25.png" alt="xcpng25">
</div>
<div class="title">Figure 99. Instalação do XCP-ng Center, parte 1</div>
</div>
<div class="paragraph">
<p>O processo é bastante simples, bastando aceitar as opções padrão. Ao final do processo, clique em <em>Finish</em>.</p>
</div>
<div id="img-xcpng26" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng26.png" alt="xcpng26">
</div>
<div class="title">Figure 100. Instalação do XCP-ng Center, parte 2</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_conhecendo_o_xcp_ng_center">4) Conhecendo o XCP-ng Center</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute o XCP-ng Center. O primeiro passo é adicionar um servidor: clique em <em>Add New Server</em>.</p>
<div id="img-xcpng27" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng27.png" alt="xcpng27">
</div>
<div class="title">Figure 101. Adicionando novo servidor, parte 1</div>
</div>
<div class="paragraph">
<p>Na tela seguinte, adicione o IP do seu hypervisor&#8201;&#8212;&#8201;informe a conta do usuário <code>root</code> e senha configurada durante a instalação, <code>Virt3sr</code>.</p>
</div>
<div id="img-xcpng28" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng28.png" alt="xcpng28">
</div>
<div class="title">Figure 102. Adicionando novo servidor, parte 2</div>
</div>
<div class="paragraph">
<p>Confirme que deseja salvar as credenciais e restaurar a conexão ao reabrir o XCP-ng Center, e clique em <em>OK</em>.</p>
</div>
<div id="img-xcpng29" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng29.png" alt="xcpng29">
</div>
<div class="title">Figure 103. Adicionando novo servidor, parte 3</div>
</div>
<div class="paragraph">
<p>Quando perguntado se deseja cadastrar o servidor no serviço de <em>Health Check</em>, clique em <em>Close</em>.</p>
</div>
<div id="img-xcpng30" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng30.png" alt="xcpng30">
</div>
<div class="title">Figure 104. Adicionando novo servidor, parte 4</div>
</div>
</li>
<li>
<p>Uma vez adicionado o hypervisor, pode-se visualizar seu estado, performance e demais características diretamente a partir da ferramenta.</p>
<div id="img-xcpng31" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng31.png" alt="xcpng31">
</div>
<div class="title">Figure 105. Informações do hypervisor</div>
</div>
</li>
<li>
<p>Na aba <em>Console</em> há um terminal em modo texto para acesso ao hypervisor, de forma análoga ao que poderíamos fazer via console local, <code>ssh</code> ou PuTTY.</p>
<div id="img-xcpng32" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng32.png" alt="xcpng32">
</div>
<div class="title">Figure 106. Acesso console ao hypervisor</div>
</div>
</li>
<li>
<p>Informações sobre a utilização dos recursos do servidor podem ser obtidas na aba Performance. Note que, com a ausência de máquinas virtuais em execução, os recursos encontram-se subutilizados.</p>
<div id="img-xcpng33" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng33.png" alt="xcpng33">
</div>
<div class="title">Figure 107. Performance do hypervisor</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_configuração_do_repositório_compartilhado_de_isos">5) Configuração do repositório compartilhado de ISOs</h3>
<div class="paragraph">
<p>No XCP-ng Center, são suportados repositórios de ISOs, acessados via protocolos CIFS ou NFS. Desta forma, o XCP-ng Center exige a utilização de um servidor de arquivos para o gerenciamento das ISOs. Neste curso, iremos utilizar um servidor NFS pré-configurado, cujo endereço de acesso será disponibilizado pelo instrutor.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para criar um repositório de imagens ISO no XCP-ng, clique no botão <em>New Storage</em> na barra de ferramentas superior; em <em>ISO Library</em>, selecione a opção <em>NFS ISO</em>.</p>
<div id="img-xcpng34" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng34.png" alt="xcpng34">
</div>
<div class="title">Figure 108. Adição de repositório ISO, parte 1</div>
</div>
</li>
<li>
<p>Escolha um nome para o repositório.</p>
<div id="img-xcpng35" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng35.png" alt="xcpng35">
</div>
<div class="title">Figure 109. Adição de repositório ISO, parte 2</div>
</div>
</li>
<li>
<p>Informe o caminho completo para o repositório NFS, e a versão do protocolo.</p>
<div id="img-xcpng36" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng36.png" alt="xcpng36">
</div>
<div class="title">Figure 110. Adição de repositório ISO, parte 3</div>
</div>
</li>
<li>
<p>Ao final do processo, acesse a aba <em>Storage</em> do repositório recém-adicionado para visualizar seu conteúdo, como mostrado a seguir.</p>
<div id="img-xcpng37" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng37.png" alt="xcpng37">
</div>
<div class="title">Figure 111. Adição de repositório ISO, parte 4</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_criação_de_máquinas_virtuais">6) Criação de máquinas virtuais</h3>
<div class="paragraph">
<p>O XCP-ng permite criar máquinas virtuais paravirtualizadas a partir de <em>templates</em> pré-configurados ou máquinas virtuais em virtualização completa sem a necessidade de um <em>template</em> pré-configurado. Um <em>template</em> descreve algumas configurações da máquina virtual a ser criada (modo de virtualização, tamanho mínimo de memória, disco, etc.). A instalação pode ser tanto a partir de uma mídia ou através da rede, para alguns sistemas.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utilize a ferramenta de criação de máquinas virtuais pressionando o botão <em>New VM</em>. Selecione o template <em>Windows 10 (64-bit)</em>, como mostrado a seguir:</p>
<div id="img-xcpng38" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng38.png" alt="xcpng38">
</div>
<div class="title">Figure 112. Criação de VM nova, parte 1</div>
</div>
</li>
<li>
<p>Defina o nome da nova máquina virtual a ser criada, que contenha alguma identificação do grupo (p. ex., <code>win10-dX-gX</code>).</p>
<div id="img-xcpng39" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng39.png" alt="xcpng39">
</div>
<div class="title">Figure 113. Criação de VM nova, parte 2</div>
</div>
</li>
<li>
<p>Agora, selecione a imagem ISO de instalação do sistema disponível no repositório ISO adicionado anteriormente.</p>
<div id="img-xcpng40" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng40.png" alt="xcpng40">
</div>
<div class="title">Figure 114. Criação de VM nova, parte 3</div>
</div>
</li>
<li>
<p>Escolha o servidor-destino da VM, que será o único hypervisor disponível até aqui.</p>
<div id="img-xcpng41" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng41.png" alt="xcpng41">
</div>
<div class="title">Figure 115. Criação de VM nova, parte 4</div>
</div>
</li>
<li>
<p>Para o número de vCPUs, defina <code>2</code>, e escolha 4 GB de memória RAM total disponibilizada para a VM.</p>
<div id="img-xcpng42" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng42.png" alt="xcpng42">
</div>
<div class="title">Figure 116. Criação de VM nova, parte 5</div>
</div>
</li>
<li>
<p>Na escolha de GPUs dedicadas, simplemente clique em <em>Next</em> para passar ao próximo passo.</p>
<div id="img-xcpng43" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng43.png" alt="xcpng43">
</div>
<div class="title">Figure 117. Criação de VM nova, parte 6</div>
</div>
</li>
<li>
<p>Na configuração de <em>storage</em> da VM, cliqueno botão <em>Edit</em>.</p>
<div id="img-xcpng44" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng44.png" alt="xcpng44">
</div>
<div class="title">Figure 118. Criação de VM nova, parte 7</div>
</div>
<div class="paragraph">
<p>Aumente o tamanho do disco para 40 GB, como mostrado a seguir.</p>
</div>
<div id="img-xcpng45" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng45.png" alt="xcpng45">
</div>
<div class="title">Figure 119. Criação de VM nova, parte 8</div>
</div>
<div class="paragraph">
<p>Confirme que o tamanho do disco está corretamente especificado e clique em <em>Next</em>.</p>
</div>
<div id="img-xcpng46" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng46.png" alt="xcpng46">
</div>
<div class="title">Figure 120. Criação de VM nova, parte 9</div>
</div>
</li>
<li>
<p>Para a configuração de rede, aceite a opção-padrão do <em>wizard</em>.</p>
<div id="img-xcpng47" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng47.png" alt="xcpng47">
</div>
<div class="title">Figure 121. Criação de VM nova, parte 10</div>
</div>
</li>
<li>
<p>Na tela <em>Finish</em>, confira que todos os dados da VM estão de acordo com o desejado, e clique em <em>Create Now</em>.</p>
<div id="img-xcpng48" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng48.png" alt="xcpng48">
</div>
<div class="title">Figure 122. Criação de VM nova, parte 11</div>
</div>
</li>
<li>
<p>Após um curto período, a máquina virtual será criada. Acesse a aba <em>General</em> para visualizar suas características gerais.</p>
<div id="img-xcpng49" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng49.png" alt="xcpng49">
</div>
<div class="title">Figure 123. VM nova criada com sucesso</div>
</div>
</li>
<li>
<p>Acessando a aba <em>Console</em>, podemos visualizar a tela de instalação do Windows 10. Escolha idioma, teclado e clique em <em>Avançar</em>.</p>
<div id="img-xcpng50" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng50.png" alt="xcpng50">
</div>
<div class="title">Figure 124. Instalação do Windows 10, parte 1</div>
</div>
<div class="paragraph">
<p>Em seguida, clique em <em>Instalar agora</em>.</p>
</div>
<div id="img-xcpng51" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng51.png" alt="xcpng51">
</div>
<div class="title">Figure 125. Instalação do Windows 10, parte 2</div>
</div>
<div class="paragraph">
<p>Na tela de ativação do Windows, clique em <em>Não tenho a chave do produto</em> para prosseguir.</p>
</div>
<div id="img-xcpng52" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng52.png" alt="xcpng52">
</div>
<div class="title">Figure 126. Instalação do Windows 10, parte 3</div>
</div>
<div class="paragraph">
<p>Na escolha de versão do sistema, defina <em>Windows 10 Pro</em> e avance.</p>
</div>
<div id="img-xcpng53" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng53.png" alt="xcpng53">
</div>
<div class="title">Figure 127. Instalação do Windows 10, parte 4</div>
</div>
<div class="paragraph">
<p>Aceite os termos de licença do Windows, e prossiga.</p>
</div>
<div id="img-xcpng54" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng54.png" alt="xcpng54">
</div>
<div class="title">Figure 128. Instalação do Windows 10, parte 5</div>
</div>
<div class="paragraph">
<p>Em tipo de instalação, defina <em>Personalizada: Instalar apenas o Windows (avançado)</em>.</p>
</div>
<div id="img-xcpng55" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng55.png" alt="xcpng55">
</div>
<div class="title">Figure 129. Instalação do Windows 10, parte 6</div>
</div>
<div class="paragraph">
<p>Escolha o único disco disponível, e clique em avançar.</p>
</div>
<div id="img-xcpng56" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng56.png" alt="xcpng56">
</div>
<div class="title">Figure 130. Instalação do Windows 10, parte 7</div>
</div>
<div class="paragraph">
<p>O processo de instalação será iniciado, como mostrado a seguir.</p>
</div>
<div id="img-xcpng57" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng57.png" alt="xcpng57">
</div>
<div class="title">Figure 131. Instalação do Windows 10, progresso</div>
</div>
</li>
<li>
<p>Durante a instalação da máquina virtual, utilize a aba <em>Performance</em> para monitorar a utilização de recursos da máquina virtual.</p>
<div id="img-xcpng58" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng58.png" alt="xcpng58">
</div>
<div class="title">Figure 132. Monitoramento de performance de VM</div>
</div>
</li>
<li>
<p>Após a instalação e reinício da máquina (e algum tempo de espera), os passos de finalização da instalação irão começar. Na escolha de região, defina <em>Brasil</em> e prossiga.</p>
<div id="img-xcpng59" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng59.png" alt="xcpng59">
</div>
<div class="title">Figure 133. Finalizando a instalação do Windows 10, parte 1</div>
</div>
<div class="paragraph">
<p>Escolha o <em>layout</em> de teclado <em>Português (Brasil ABNT2)</em>.</p>
</div>
<div id="img-xcpng60" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng60.png" alt="xcpng60">
</div>
<div class="title">Figure 134. Finalizando a instalação do Windows 10, parte 2</div>
</div>
<div class="paragraph">
<p>Pule o passo para definição de um <em>layout</em> de teclado secundário.</p>
</div>
<div id="img-xcpng61" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng61.png" alt="xcpng61">
</div>
<div class="title">Figure 135. Finalizando a instalação do Windows 10, parte 3</div>
</div>
<div class="paragraph">
<p>Configure a VM para uso pessoal, como mostrado abaixo.</p>
</div>
<div id="img-xcpng62" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng62.png" alt="xcpng62">
</div>
<div class="title">Figure 136. Finalizando a instalação do Windows 10, parte 4</div>
</div>
<div class="paragraph">
<p>Quando da criação de conta, clique em <em>Conta offline</em> para criar um usuário local.</p>
</div>
<div id="img-xcpng63" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng63.png" alt="xcpng63">
</div>
<div class="title">Figure 137. Finalizando a instalação do Windows 10, parte 5</div>
</div>
<div class="paragraph">
<p>Na tela seguinte, confirme sua escolha clicando em <em>Não</em>.</p>
</div>
<div id="img-xcpng64" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng64.png" alt="xcpng64">
</div>
<div class="title">Figure 138. Finalizando a instalação do Windows 10, parte 6</div>
</div>
<div class="paragraph">
<p>Defina o nome do usuário local como <code>aluno</code>.</p>
</div>
<div id="img-xcpng65" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng65.png" alt="xcpng65">
</div>
<div class="title">Figure 139. Finalizando a instalação do Windows 10, parte 7</div>
</div>
<div class="paragraph">
<p>Em seguida, defina sua senha como <code>Virt3sr</code>.</p>
</div>
<div id="img-xcpng66" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng66.png" alt="xcpng66">
</div>
<div class="title">Figure 140. Finalizando a instalação do Windows 10, parte 8</div>
</div>
<div class="paragraph">
<p>Confirme-a:</p>
</div>
<div id="img-xcpng67" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng67.png" alt="xcpng67">
</div>
<div class="title">Figure 141. Finalizando a instalação do Windows 10, parte 9</div>
</div>
<div class="paragraph">
<p>Agora, surgirão três telas de definição de perguntas de segurança para a conta. Escolha quaisquer combinações de perguntas/respostas e prossiga.</p>
</div>
<div id="img-xcpng68" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng68.png" alt="xcpng68">
</div>
<div class="title">Figure 142. Finalizando a instalação do Windows 10, parte 10</div>
</div>
<div class="paragraph">
<p>Quando perguntado se deseja tornar a Cortana sua assistente pessoal, recuse.</p>
</div>
<div id="img-xcpng69" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng69.png" alt="xcpng69">
</div>
<div class="title">Figure 143. Finalizando a instalação do Windows 10, parte 11</div>
</div>
<div class="paragraph">
<p>Não aceite a configuração de histórico de atividades.</p>
</div>
<div id="img-xcpng70" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng70.png" alt="xcpng70">
</div>
<div class="title">Figure 144. Finalizando a instalação do Windows 10, parte 12</div>
</div>
<div class="paragraph">
<p>Finalmente, para as configurações de privacidade do sistema, desabilite todas as opções de clique em <em>Aceitar</em>.</p>
</div>
<div id="img-xcpng71" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng71.png" alt="xcpng71">
</div>
<div class="title">Figure 145. Finalizando a instalação do Windows 10, parte 13</div>
</div>
<div class="paragraph">
<p>Pronto! O Windows 10 está instalado e configurado.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_7_instalação_dos_adicionais_de_convidado">7) Instalação dos adicionais de convidado</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para instalar os adicionais de convidado no XCP-ng Center, o primeiro passo é atualizar a máquina-alvo. Abra o <em>Windows Update</em> e inicie o processo de atualização.</p>
<div id="img-xcpng72" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng72.png" alt="xcpng72">
</div>
<div class="title">Figure 146. Atualização da VM, parte 1</div>
</div>
<div class="paragraph">
<p>Caso seja necessário reiniciar a máquina, aceite.</p>
</div>
<div id="img-xcpng73" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng73.png" alt="xcpng73">
</div>
<div class="title">Figure 147. Atualização da VM, parte 2</div>
</div>
<div class="paragraph">
<p>Ao final do processo (pode ser necessário invocar o processo de atualização múltiplas vezes), você deverá ver a mensagem <em>Você está atualizado</em>, como mostrado a seguir.</p>
</div>
<div id="img-xcpng74" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng74.png" alt="xcpng74">
</div>
<div class="title">Figure 148. Atualização da VM, parte 3</div>
</div>
</li>
<li>
<p>Como o XCP-ng é uma versão <em>open-source</em> do XenServer proprietário da Citrix, não há permissão para distribuir os binários de instalação dos adicionais de convidade diretamente, como documentado em <a href="https://github.com/xcp-ng/xcp/wiki/Guest-Tools" class="bare">https://github.com/xcp-ng/xcp/wiki/Guest-Tools</a> . Fizemos a extração da ISO de instalação dos <em>guest tools</em> a partir do CD de instalação da versão comercial do XenServer, disponibilizando-o no repositório de ISOs sob o nome <code>XenServer-guest-tools-VERSION.iso</code>.</p>
<div class="paragraph">
<p>Na console de acesso à VM, altere a imagem no drive de DVD virtual da máquina para a ISO de instalação dos <em>guest tools</em>, como mostrado a seguir:</p>
</div>
<div id="img-xcpng76" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng76.png" alt="xcpng76">
</div>
<div class="title">Figure 149. Instalação do Guest Tools, parte 1</div>
</div>
<div class="paragraph">
<p>Execute a instalação do pacote.</p>
</div>
<div id="img-xcpng77" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng77.png" alt="xcpng77">
</div>
<div class="title">Figure 150. Instalação do Guest Tools, parte 2</div>
</div>
<div class="paragraph">
<p>A máquina deverá ser reiniciada para instalação dos <em>PV Drivers</em> do XenServer, como visto abaixo.</p>
</div>
<div id="img-xcpng78" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng78.png" alt="xcpng78">
</div>
<div class="title">Figure 151. Instalação do Guest Tools, parte 3</div>
</div>
</li>
<li>
<p>Ao final do processo de instalação, abra o <em>Gerenciador de Dispositivos</em> da máquina virtual e confira, em <em>Controladores de armazenamento</em>, que o <em>driver</em> <em>XenServer PV Storage Host Adapter</em> está instalado.</p>
<div id="img-xcpng79" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng79.png" alt="xcpng79">
</div>
<div class="title">Figure 152. Instalação dos drivers de storage PV</div>
</div>
</li>
<li>
<p>De volta à console do XCP-ng Center, cheque que o estado de virtualização da VM mostra que o I/O está otimizado, e que o agente de gerenciamento está instalado.</p>
<div id="img-xcpng80" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng80.png" alt="xcpng80">
</div>
<div class="title">Figure 153. Guest Tools instalado com sucesso</div>
</div>
</li>
<li>
<p>Na aba <em>Performance</em>, confira que os dados reportados pela máquina virtual estão muito mais precisos, após a instalação do agente.</p>
<div id="img-xcpng81" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng81.png" alt="xcpng81">
</div>
<div class="title">Figure 154. Dados de performance após guest tools</div>
</div>
</li>
<li>
<p>Não se esqueça de ejetar a imagem ISO acessando a aba <em>Storage</em> &gt; <em>Eject</em>.</p>
<div id="img-xcpng82" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng82.png" alt="xcpng82">
</div>
<div class="title">Figure 155. Ejetando imagem ISO</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_8_acesso_ao_hypervisor_via_ssh">8) Acesso ao hypervisor via SSH</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Durante as atividades deste curso iremos ter que digitar alguns comandos no terminal das VMs, os quais serão mostrados nos cadernos de atividade de cada sessão. Alguns desses comandos serão bastante longos e/ou terão uma sintaxe complicada&#8201;&#8212;&#8201;nesse caso, o ideal é que tenhamos a possibilidade de copiá-los diretamente do caderno para a console, evitando erros de digitação.</p>
<div class="paragraph">
<p>O protocolo de login remoto SSH é ideal para solucionar essa tarefa. Em ambiente Windows, dois dos métodos mais populares para efetuar logins remotos via SSH são os programas PuTTY (<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" class="bare">https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a>) ou Cygwin (<a href="https://cygwin.com/install.html" class="bare">https://cygwin.com/install.html</a>). Vamos, primeiro, visualizar os passos necessários usando o PuTTY.</p>
</div>
<div class="paragraph">
<p>Em qualquer caso, o primeiro passo é sempre descobrir qual o endereço IP da máquina remota à qual queremos nos conectar. No caso do hypervisor XCP-ng, basta visualizar o endereço IP da máquina observando a página de sumário em seu host físico.</p>
</div>
<div class="paragraph">
<p>O uso do <strong>PuTTY</strong>, por se tratar de um programa <em>standalone</em> com o objetivo único de efetuar login via SSH, é mais simples. Faça o download do PuTTY em sua máquina física Windows, usando a URL informada acima. Em seguida, apenas abra o programa e digite na caixa <em>Host Name</em> o endereço IP da máquina remota descoberto acima. Em seguida, clique em <em>Open</em>.</p>
</div>
<div id="img-ssh1" class="imageblock text-center">
<div class="content">
<img src="./img/3_XCP-ng-s1/ssh1.png" alt="ssh1">
</div>
<div class="title">Figure 156. Login via SSH usando o PuTTY, parte 1</div>
</div>
<div class="paragraph">
<p>Será mostrado um alerta de segurança avisando que a chave do <em>host</em> remoto não se encontra na <em>cache</em> local, o que pode configurar um risco de segurança. Clique em <em>Yes</em> para prosseguir com a tentativa de login.</p>
</div>
<div class="paragraph">
<p>Em seguida, será solicitado o nome de usuário com o qual efetuar a conexão. Informe o usuário <code>root</code>, com senha <code>Virt3sr</code>. Em caso de sucesso, você verá a tela parecida com a que se segue:</p>
</div>
<div id="img-ssh2" class="imageblock text-center">
<div class="content">
<img src="./img/3_XCP-ng-s1/ssh2.png" alt="ssh2">
</div>
<div class="title">Figure 157. Login via SSH usando o PuTTY, parte 2</div>
</div>
<div class="paragraph">
<p>Para copiar/colar comandos no PuTTY, basta selecionar o texto desejado no ambiente da máquina física e digitar <code>CTRL + C</code>, e em seguida clicar com o botão direito na janela do PuTTY. O texto selecionado será colado na posição do cursor.</p>
</div>
</li>
<li>
<p>O uso do Cygwin é um pouco mais envolvido, já que seu objetivo é mais complexo: prover, em ambiente Windows, funcionalidade equivalente à que temos disponível em uma distribuição Linux. Para começar, faça o download e execute o instalador do Cygwin em sua máquina física Windows.</p>
<div class="paragraph">
<p>A instalação é, em grande parte, bastante similar à de qualquer aplicativo Windows. Na tela inicial, clique em <em>Next</em>. Em <em>Choose a Download Source</em>, mantenha marcada a caixa <em>Install from Internet</em> e clique em <em>Next</em>. Em <em>Select Root Install Directory</em>, os valores padrão estão apropriados&#8201;&#8212;&#8201;clique em <em>Next</em>. Na tela <em>Select Local Package Directory</em>, novamente, mantenha o valor padrão e clique em <em>Next</em>.</p>
</div>
<div class="paragraph">
<p>Agora, vamos selecionar a fonte de pacotes. Em <em>Select Your Internet Connection</em>, a menos que haja um <em>proxy</em> na rede local (informe-se com seu instrutor), mantenha marcada a caixa <em>Direct Connection</em> e clique em <em>Next</em>. Será feito o download da lista de espelhos disponíveis para o Cygwin. Em <em>Choose A Download Site</em>, qualquer espelho irá funcionar, mas evidentemente é desejável que escolhamos um que possua maior velocidade de download&#8201;&#8212;&#8201;o site <a href="http://linorg.usp.br" class="bare">http://linorg.usp.br</a> é provavelmente uma boa opção, nesse caso. Clique em <em>Next</em>, e o instalador irá baixar a lista de pacotes disponíveis.</p>
</div>
<div class="paragraph">
<p>Em adição ao sistema-base padrão, é necessário instalar o OpenSSH para efetuar logins remotos. Na caixa de busca <em>Search</em>, no topo da tela, digite o termo de busca <code>openssh</code>. Expanda a árvore <code>Net</code> e clique na palavra <em>Skip</em> na linha do pacote <code>openssh: The OpenSSH server and client programs</code>&#8201;&#8212;&#8201;ela irá alterar para a versão a ser instalada, <code>7.9p1-1</code> no caso da figura mostrada abaixo:</p>
</div>
<div id="img-ssh3" class="imageblock text-center">
<div class="content">
<img src="./img/3_XCP-ng-s1/ssh3.png" alt="ssh3">
</div>
<div class="title">Figure 158. Instalação do OpenSSH no Cygwin</div>
</div>
<div class="paragraph">
<p>Clique em <em>Next</em>. Em <em>Review and confirm changes</em>, verifique que o Cygwin irá instalar o OpenSSH e todas as demais dependências do sistema-base Linux, como o <em>shell</em> <code>bash</code> ou ferramentas como o <code>grep</code>, e clique em <em>Next</em>. O instalador irá fazer o download e instalação dos pacotes selecionados.</p>
</div>
<div class="paragraph">
<p>Concluído o processo, procure pelo programa <code>Cygwin Terminal</code> no menu iniciar da sua máquina física Windows, e execute-o. Agora, tente fazer login via SSH normalmente, como se estivesse em um <em>shell</em> Linux:</p>
</div>
<div id="img-ssh4" class="imageblock text-center">
<div class="content">
<img src="./img/3_XCP-ng-s1/ssh4.png" alt="ssh4">
</div>
<div class="title">Figure 159. Login via SSH usando o Cygwin</div>
</div>
<div class="paragraph">
<p>Para copiar/colar comandos no Cygwin, basta selecionar o texto desejado no ambiente da máquina física e digitar <code>CTRL + C</code>, e em seguida mudar o foco para a janela do Cygwin e digitar a combinação <code>SHIFT + Insert</code>. Para copiar texto a partir da janela do Cygwin, selecione-o e use a combinação de teclas <code>CTRL + Insert</code>. Para encontrar os arquivos localizados em sua máquina física, o diretório <code>/cygdrive/X</code> pode ser usado para mapear para os discos da máquina local&#8201;&#8212;&#8201;por exemplo, o diretório <code>/cygdrive/c</code> mapeia diretamente para o <code>C:\</code> da máquina Windows.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_9_armazenamento_de_dados_das_máquinas_virtuais">9) Armazenamento de dados das máquinas virtuais</h3>
<div class="paragraph">
<p>Quando novos discos virtuais são criados para as máquinas virtuais, é alocado espaço na partição LVM do hypervisor. Nesta etapa, será vista a relação entre os volumes virtuais gerenciados com o XCP-ng e a infraestrutura LVM. Utilize o comando <code>xe help</code> para praticar outros comando além dos exemplos abaixo.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Acesse o hypervisor via PuTTY ou Cygwin, como mencionado na atividade anterior. Utilize o comando <code>xe vm-disk-list</code> para listar os discos associados com uma VM específica (pode-se utilizar a tecla <code>TAB</code> para completar o nome da máquina virtual automaticamente).</p>
<div class="literalblock">
<div class="content">
<pre>[root@xcp-ng-d1-g1 ~]# xe vm-disk-list vm=win10-d1-g1
Disk 0 VBD:
uuid ( RO)             : 40f50b9b-dac8-ada1-09fa-79024a5dece0
    vm-name-label ( RO): win10-d1-g1
       userdevice ( RW): 0


Disk 0 VDI:
uuid ( RO)             : 7354b5b1-debe-4b0a-b03c-7d3707f72525
       name-label ( RW): win10-d1-g1 0
    sr-name-label ( RO): Local storage
     virtual-size ( RO): 42949672960</pre>
</div>
</div>
</li>
<li>
<p>Utilize o comando <code>lvdisplay</code> para exibir os volumes lógicos do LVM. Observe que, após a criação da nova máquina virtual, há um novo volume lógico cujo nome corresponde ao UUID do disco da VM e ao <em>Storage Repository</em> <em>Local Storage</em>.</p>
<div class="literalblock">
<div class="content">
<pre>[root@xcp-ng-d1-g1 ~]# lvdisplay /dev/VG_XenStorage-9f9f3987-d606-87c4-c543-7277d8f2848a/VHD-7354b5b1-debe-4b0a-b03c-7d3707f72525
  /run/lvm/lvmetad.socket: connect failed: No such file or directory
  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.
  --- Logical volume ---
  LV Path                /dev/VG_XenStorage-9f9f3987-d606-87c4-c543-7277d8f2848a/VHD-7354b5b1-debe-4b0a-b03c-7d3707f72525
  LV Name                VHD-7354b5b1-debe-4b0a-b03c-7d3707f72525
  VG Name                VG_XenStorage-9f9f3987-d606-87c4-c543-7277d8f2848a
  LV UUID                6YpqDE-1TYW-0g71-coRz-CVeN-svZg-cxvV6O
  LV Write Access        read/write
  LV Creation host, time xcp-ng-d1-g1, 2018-11-28 10:29:41 -0200
  LV Status              available
  # open                 1
  LV Size                40.09 GiB
  Current LE             10262
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:1</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_10_snapshots_de_máquinas_virtuais">10) Snapshots de máquinas virtuais</h3>
<div class="paragraph">
<p>Um <em>snapshot</em> de uma máquina virtual é uma cópia do seu estado em um determinado momento. Estas cópias podem ser utilizadas para fins de backup, gerando diversas versões funcionais da máquina virtual e recuperando um estado anterior, quando necessário.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para criar um <em>snapshot</em>, acesse a aba <em>Snapshots</em> da VM e clique no botão <em>Take Snapshot</em>.</p>
<div id="img-xcpng84" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng84.png" alt="xcpng84">
</div>
<div class="title">Figure 160. Criação de snapshots, parte 1</div>
</div>
<div class="paragraph">
<p>Defina o nome do <em>snapshot</em>, e se deseja guardar apenas o estado dos discos ou também da memória da VM.</p>
</div>
<div id="img-xcpng85" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng85.png" alt="xcpng85">
</div>
<div class="title">Figure 161. Criação de snapshots, parte 2</div>
</div>
</li>
<li>
<p>Concluído o <em>snapshot</em>, vamos testar sua funcionalidade. Abra a console da VM e crie um arquivo texto no Desktop do usuário <code>aluno</code>, com qualquer conteúdo.</p>
<div id="img-xcpng86" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng86.png" alt="xcpng86">
</div>
<div class="title">Figure 162. Alteração do estado da VM</div>
</div>
</li>
<li>
<p>Com a função <em>Revert To</em>, é possível retornar para algum dos estados previamente salvos. Em <em>Actions</em>, é possível utilizar um <em>snapshot</em> para criar novas máquinas virtuais. Um <em>snapshot</em> também pode ser convertido em um arquivo de backup ou <em>template</em>: como arquivo de backup, ele pode ser posteriormente restaurado em caso de perda dos dados no <em>storage</em>; já como <em>template</em>, uma nova máquina virtual pode ser gerada a partir do <em>snapshot</em>.</p>
<div class="paragraph">
<p>Selecione o <em>snapshot</em> criado no passo (1) e clique em <em>Revert To</em>:</p>
</div>
<div id="img-xcpng87" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng87.png" alt="xcpng87">
</div>
<div class="title">Figure 163. Revertendo estado da VM, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme a reversão do estado da VM.</p>
</div>
<div id="img-xcpng88" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng88.png" alt="xcpng88">
</div>
<div class="title">Figure 164. Revertendo estado da VM, parte 2</div>
</div>
<div class="paragraph">
<p>Após a reversão do estado, note que o <em>snapshot</em> continua existindo e podendo ser usado posteriormente.</p>
</div>
<div id="img-xcpng89" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng89.png" alt="xcpng89">
</div>
<div class="title">Figure 165. Revertendo estado da VM, parte 3</div>
</div>
</li>
<li>
<p>Retorne à console da VM&#8201;&#8212;&#8201;note que o arquivo texto que havíamos criado sumiu!</p>
<div id="img-xcpng90" class="imageblock text-center png">
<div class="content">
<img src="./img/3_XCP-ng-s1/xcpng90.png" alt="xcpng90">
</div>
<div class="title">Figure 166. Estado da VM revertido com sucesso</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_4_xcp_ng_avançado">Sessão 4: XCP-ng avançado</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_criação_de_pools">1) Criação de pools</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para criar um novo <em>pool</em>, é necessário que o XCP-ng Center esteja conectado aos dois hypervisors do grupo. Utilize o botão <em>Add New Server</em> para adicionar os dois hypervisors ao mesmo XCP-ng Center. A partir de agora, o gerenciamento dos hypervisors do grupo será centralizado em uma única máquina. Façam um revezamento no gerenciamento e comuniquem-se para melhor entendimento da atividade proposta.</p>
<div class="paragraph">
<p>Como mencionado, o primeiro passo é adicionar o segundo hypervisor usando o botão <em>Add New Server</em>.</p>
</div>
<div id="img-xcpng-2-1" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng1.png" alt="xcpng1">
</div>
<div class="title">Figure 167. Adicionando novo servidor ao XCP-ng Center</div>
</div>
</li>
<li>
<p>É necessário remover um dos repositórios ISO dos servidores, para evitar duplicidade. No exemplo abaixo, iremos remover o repositório ISO da máquina <code>xpc-ng-d2-g1</code>:</p>
<div id="img-xcpng-2-2" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng2.png" alt="xcpng2">
</div>
<div class="title">Figure 168. Removendo repositório ISO, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme a remoção:</p>
</div>
<div id="img-xcpng-2-3" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng3.png" alt="xcpng3">
</div>
<div class="title">Figure 169. Removendo repositório ISO, parte 2</div>
</div>
<div class="paragraph">
<p>E o "esquecimento" do repositório de ISOs, finalmente.</p>
</div>
<div id="img-xcpng-2-4" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng4.png" alt="xcpng4">
</div>
<div class="title">Figure 170. Removendo repositório ISO, parte 3</div>
</div>
</li>
<li>
<p>Agora, vamos criar o <em>pool</em>&#8201;&#8212;&#8201;clique na raiz dos elementos do <em>datacenter</em> e em seguida no botão <em>New Pool</em>:</p>
<div id="img-xcpng-2-5" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng5.png" alt="xcpng5">
</div>
<div class="title">Figure 171. Criação de pool, parte 1</div>
</div>
<div class="paragraph">
<p>Escolha um nome sugestivo para o <em>pool</em> (no exemplo abaixo, <code>pool-g1</code>), e inclua ambos os servidores no mesmo.</p>
</div>
<div id="img-xcpng-2-6" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng6.png" alt="xcpng6">
</div>
<div class="title">Figure 172. Criação de pool, parte 2</div>
</div>
</li>
<li>
<p>Findo o processo, você verá o <em>pool</em> recém-criado com ambos os hypervisors abarcados.</p>
<div id="img-xcpng-2-7" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng7.png" alt="xcpng7">
</div>
<div class="title">Figure 173. Pool criado com sucesso</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_dispositivo_de_armazenamento_remoto">2) Dispositivo de armazenamento remoto</h3>
<div class="paragraph">
<p>Para possibilitar a movimentação de uma máquina virtual entre dois hypervisors, é necessário a existência de um dispositivo de armazenamento compartilhado entre os mesmos. Isto pode ser feito através do compartilhamento de rede como NFS ou com dispositivos de disco remotos. Neste curso, iremos utilizar um <em>storage</em> baseado em software (FreeNAS), configurado durante a sessão 2. O acesso ao <em>storage</em> se dará através do protocolo iSCSI, encapsulando comandos SCSI através da rede padrão do sistema.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No XCP-ng Center, selecione o <em>pool</em> do grupo e em seguida o botão <em>New Storage</em>. Em <em>Block based storage</em>, selecione a opção iSCSI e prossiga.</p>
<div id="img-xcpng-2-8" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng8.png" alt="xcpng8">
</div>
<div class="title">Figure 174. Criação de storage compartilhado, parte 1</div>
</div>
<div class="paragraph">
<p>Escolha um nome para o <em>storage</em> compartilhado:</p>
</div>
<div id="img-xcpng-2-9" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng9.png" alt="xcpng9">
</div>
<div class="title">Figure 175. Criação de storage compartilhado, parte 2</div>
</div>
<div class="paragraph">
<p>Informe o endereço IP da máquina que possui o FreeNAS instalado para o grupo, e mantenha a porta padrão 3260. Clique em <em>Scan Target Host</em>&#8201;&#8212;&#8201;os campos <em>Target IQN</em> e <em>Target LUN</em> devem ser preenchidos automaticamente.</p>
</div>
<div id="img-xcpng-2-10" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng10.png" alt="xcpng10">
</div>
<div class="title">Figure 176. Criação de storage compartilhado, parte 3</div>
</div>
<div class="paragraph">
<p>Confirme a formatação da LUN:</p>
</div>
<div id="img-xcpng-2-11" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng11.png" alt="xcpng11">
</div>
<div class="title">Figure 177. Criação de storage compartilhado, parte 4</div>
</div>
<div class="paragraph">
<p>Ao final do processo, a LUN compartilhada deve ser adicionada ao <em>pool</em> de servidores. Confira as informações da mesma acessando a aba <em>General</em>.</p>
</div>
<div id="img-xcpng-2-12" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng12.png" alt="xcpng12">
</div>
<div class="title">Figure 178. Storage compartilhado adicionado com sucesso</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_movendo_máquinas_virtuais_para_o_storage_compartilhado">3) Movendo máquinas virtuais para o Storage compartilhado</h3>
<div class="paragraph">
<p>O disco das máquinas virtuais devem ser movidos para um dispositivo de armazenamento compartilhado, de forma que seja possível movê-las entre hypervisors na atividade seguinte.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se ligada, desligue uma das VMs do grupo. Em seguida, clique com o botão direito sobre a mesma e selecione <em>Move VM</em>.</p>
<div id="img-xcpng-2-13" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng13.png" alt="xcpng13">
</div>
<div class="title">Figure 179. Movendo máquina virtual, parte 1</div>
</div>
<div class="paragraph">
<p>Defina o <em>pool</em> do grupo como destino para a máquina virtual&#8201;&#8212;&#8201;não é necessário especificar um servidor-destino.</p>
</div>
<div id="img-xcpng-2-14" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng14.png" alt="xcpng14">
</div>
<div class="title">Figure 180. Movendo máquina virtual, parte 2</div>
</div>
<div class="paragraph">
<p>Escolha o <em>storage</em> compartilhado configurado na atividade anterior como SR (<em>storage repository</em>) alvo para a movimentação da VM.</p>
</div>
<div id="img-xcpng-2-15" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng15.png" alt="xcpng15">
</div>
<div class="title">Figure 181. Movendo máquina virtual, parte 3</div>
</div>
</li>
<li>
<p>Você pode acompanhar o progresso de movimentação da VM na janela <em>Events</em>:</p>
<div id="img-xcpng-2-16" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng16.png" alt="xcpng16">
</div>
<div class="title">Figure 182. Progresso de movimentação da VM</div>
</div>
</li>
<li>
<p>Ao final do processo, navegue até a LUN compartilhada e observe na aba <em>Storage</em> que o disco da máquina virtual encontra-se lá:</p>
<div id="img-xcpng-2-17" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng17.png" alt="xcpng17">
</div>
<div class="title">Figure 183. movimentação de máquina virtual realizada com sucesso</div>
</div>
</li>
<li>
<p>Para evitar confusões nos passos posteriores, remova a máquina virtual que <strong>NÃO</strong> foi movimentada para o <em>storage</em> compartilhado&#8201;&#8212;&#8201;no exemplo abaixo, a VM <code>win10-d2-g1</code>:</p>
<div id="img-xcpng-2-18" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng18.png" alt="xcpng18">
</div>
<div class="title">Figure 184. Removendo VM não-compartilhada, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme que a VM sendo removida é de fato a que não se encontra no <em>storage</em> comum, e confirme.</p>
</div>
<div id="img-xcpng-2-19" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng19.png" alt="xcpng19">
</div>
<div class="title">Figure 185. Removendo VM não-compartilhada, parte 2</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_migração_manual_de_máquinas_virtuais_no_pool">4) Migração manual de máquinas virtuais no pool</h3>
<div class="paragraph">
<p>Uma vez que o disco da máquina virtual encontra-se no dispositivo compartilhado, é possível efetuar a migração on-line dentro de um mesmo <em>pool</em> entre hypervisors.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ligue a VM que se encontra no <em>storage</em> compartilhado.</p>
<div id="img-xcpng-2-20" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng20.png" alt="xcpng20">
</div>
<div class="title">Figure 186. Ligando VM</div>
</div>
</li>
<li>
<p>Após o <em>boot</em>, descubra o endereço IP da VM usando o comando <code>ipconfig</code>, no <em>prompt</em> de comando do Windows.</p>
<div id="img-xcpng-2-21" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng21.png" alt="xcpng21">
</div>
<div class="title">Figure 187. Descobrindo IP da VM</div>
</div>
<div class="paragraph">
<p>Para permitir <code>ping</code> para a VM, é necessário habilitar regras no firewall do Windows. Abra o <em>Windows Defender Firewall com Segurança Avançada</em> e habilite as regras de <code>Solicitação de Eco&#8201;&#8212;&#8201;ICMPv4 in</code>.</p>
</div>
<div id="img-xcpng-2-22" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng22.png" alt="xcpng22">
</div>
<div class="title">Figure 188. Habilitando ping no firewall</div>
</div>
</li>
<li>
<p>Em sua máquina física, inicie um <code>ping</code> sem limite de pacotes (com a opção <code>-t</code>) para o IP da máquina virtual. Você deverá ver respostas como as mostradas na janela abaixo:</p>
<div id="img-xcpng-2-23" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng23.png" alt="xcpng23">
</div>
<div class="title">Figure 189. Ping para a VM com sucesso</div>
</div>
</li>
<li>
<p>Agora, vamos mover a VM. Clique com o botão direito sobre a mesma e selecione <em>Migrate to Server</em>, especificando o outro servidor do <em>pool</em>.</p>
<div id="img-xcpng-2-24" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng24.png" alt="xcpng24">
</div>
<div class="title">Figure 190. Movendo máquina virtual</div>
</div>
</li>
<li>
<p>Acompanhe o progresso de movimentação na janela <em>Events</em>.</p>
<div id="img-xcpng-2-25" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng25.png" alt="xcpng25">
</div>
<div class="title">Figure 191. Progresso da movimentação de VM</div>
</div>
</li>
<li>
<p>Em sua janela de <code>ping</code> no host físico, note que um baixíssimo número de pacotes foi perdido durante a migração&#8201;&#8212;&#8201;no exemplo abaixo, apenas um:</p>
<div id="img-xcpng-2-26" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng26.png" alt="xcpng26">
</div>
<div class="title">Figure 192. Perda de pacotes durante migração</div>
</div>
</li>
<li>
<p>Na aba <em>Performance</em> da VM, observe o comportamento do servidor durante o período de migração.</p>
<div id="img-xcpng-2-27" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng27.png" alt="xcpng27">
</div>
<div class="title">Figure 193. desc</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_ativando_a_alta_disponibilidade_ha">5) Ativando a Alta Disponibilidade - HA</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Agora, vamos ativar a alta disponibilidade para o <em>pool</em> de servidores configurado. Clique com o botão direito sobre o <em>pool</em> e selecione <em>High Availability</em>.</p>
<div id="img-xcpng-2-29" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng29.png" alt="xcpng29">
</div>
<div class="title">Figure 194. Ativando alta disponibilidade, parte 1</div>
</div>
<div class="paragraph">
<p>Na tela inicial, clique em <em>Next</em>.</p>
</div>
<div id="img-xcpng-2-30" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng30.png" alt="xcpng30">
</div>
<div class="title">Figure 195. Ativando alta disponibilidade, parte 2</div>
</div>
<div class="paragraph">
<p>Escolha o SR compartilhado para <em>heartbeat</em> entre os membros do <em>pool</em>.</p>
</div>
<div id="img-xcpng-2-31" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng31.png" alt="xcpng31">
</div>
<div class="title">Figure 196. Ativando alta disponibilidade, parte 3</div>
</div>
<div class="paragraph">
<p>Ative o HA para a VM compartilhada do <em>pool</em>, mantendo o <em>HA restart priority</em> como <em>Restart</em> e <em>Failures tolerated</em> como 1 (como são utilizados apenas dois hypervisors, só é possível suportar uma falha).</p>
</div>
<div id="img-xcpng-2-32" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng32.png" alt="xcpng32">
</div>
<div class="title">Figure 197. Ativando alta disponibilidade, parte 4</div>
</div>
<div class="paragraph">
<p>Revise as configurações, e confirme a criação do HA.</p>
</div>
<div id="img-xcpng-2-33" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng33.png" alt="xcpng33">
</div>
<div class="title">Figure 198. Ativando alta disponibilidade, finalização</div>
</div>
</li>
<li>
<p>Vamos testar! Inicie um <code>ping</code> infinito para a VM.</p>
<div id="img-xcpng-2-34" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng34.png" alt="xcpng34">
</div>
<div class="title">Figure 199. Ping iniciado para a VM</div>
</div>
</li>
<li>
<p>Determine em qual hypervisor a VM está rodando. No exemplo abaixo, ela está na máquina <code>xcp-ng-d2-g1</code>.</p>
<div id="img-xcpng-2-35" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng35.png" alt="xcpng35">
</div>
<div class="title">Figure 200. VM rodando num hypervisor do pool</div>
</div>
</li>
<li>
<p>Retire o cabo de rede ou desligue abruptamente o host físico no qual a VM está operando. Após algum tempo, ela será reiniciada no host remanescente do pool, como mostrado abaixo.</p>
<div id="img-xcpng-2-36" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng36.png" alt="xcpng36">
</div>
<div class="title">Figure 201. VM reiniciada em hypervisor ativo</div>
</div>
</li>
<li>
<p>Note que o período de indisponibilidade de <code>ping</code> é altíssimo&#8201;&#8212;&#8201;além do período de inatividade e detecção, temos que esperar a VM reiniciar para voltar a obter resposta.</p>
<div id="img-xcpng-2-37" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng37.png" alt="xcpng37">
</div>
<div class="title">Figure 202. Indisponibilidade de ping</div>
</div>
</li>
<li>
<p>Em <em>Notifications</em> &gt; <em>Alerts</em>, note as mensagens de alerta levantadas para o <em>pool</em>.</p>
<div id="img-xcpng-2-38" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng38.png" alt="xcpng38">
</div>
<div class="title">Figure 203. Alertas de indisponibilidade no pool</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_indisponibilização_do_pool_master">6) Indisponibilização do pool master</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Agora, vamos fazer o contrário. Retorne o <em>pool</em> ao seu estado de normalidade, com ambas as máquinas ativas. Feito isso, derrube o hypervisor que se manteve ativo nos passos anteriores, que deve estar rodando a VM compartilhada e operando como <em>pool master</em> (em nosso exemplo, a máquina <code>xcp-ng-d1-g1</code>).</p>
<div id="img-xcpng-2-39" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng39.png" alt="xcpng39">
</div>
<div class="title">Figure 204. Pool master indisponibilizado</div>
</div>
<div class="paragraph">
<p>Como mostrado a seguir, após algum tempo a máquina remanescente assume como <em>pool master</em>, e o <em>failover</em> de alta disponibilidade se torna inviável.</p>
</div>
<div id="img-xcpng-2-40" class="imageblock text-center">
<div class="content">
<img src="./img/4_XCP-ng-s2/xcpng40.png" alt="xcpng40">
</div>
<div class="title">Figure 205. Hypervisor assume como pool master</div>
</div>
</li>
<li>
<p>O comportamento do XCP-ng quando da indisponibilização do <em>pool master</em> pode parecer um pouco estranho, a princípio&#8201;&#8212;&#8201;isso se deve ao fato de que a recomendação para operação do mesmo é que haja no mínimo 3 hypervisors no <em>pool</em>, e não apenas 2, para estabelecimento de maioria. Os links a seguir documentam esse comportamento e oferecem sugestões de configuração para ambientes com menos máquinas disponíveis para integração ao <em>pool</em>:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><a href="https://support.citrix.com/article/CTX129721" class="bare">https://support.citrix.com/article/CTX129721</a></p>
</li>
<li>
<p><a href="https://docs.citrix.com/en-us/xenserver/current-release/high-availability.html" class="bare">https://docs.citrix.com/en-us/xenserver/current-release/high-availability.html</a></p>
</li>
<li>
<p><a href="https://xenserver.org/blog/entry/xenserver-high-availability-alternative-ha-lizard-1.html" class="bare">https://xenserver.org/blog/entry/xenserver-high-availability-alternative-ha-lizard-1.html</a></p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_5_introdução_ao_hyper_v">Sessão 5: Introdução ao Hyper-V</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_instalação_do_hyper_v">1) Instalação do Hyper-V</h3>
<div class="paragraph">
<p>O Hyper-V é instalado como um complemento em todas as edições Windows Server. Para criar um <em>cluster</em> de hypervisors, é necessário associá-los a um mesmo domínio. A criação deste domínio foge ao escopo do curso&#8201;&#8212;&#8201;por este motivo, para desenvolvimento das práticas desta sessão, utilizaremos um servidor AD com domínio (<code>virtesr.edu.br</code>) e usuários já configurado pela equipe de apoio local da unidade.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crie uma mídia bootável com o instalador do Windows Server 2016, conforme instruções providas pelo instrutor. Em seguida, insira a mídia na máquina destacada como hypervisor para a dupla e execute o <em>boot</em> via USB. Você verá a tela a seguir:</p>
<div id="img-hyperv1" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv1.png" alt="hyperv1">
</div>
<div class="title">Figure 206. Instalação do Hyper-V, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione o idioma, formato de tempo/moeda e teclado, e clique em <em>Next</em>.</p>
</div>
</li>
<li>
<p>Na tela seguinte, clique em <em>Install now</em>.</p>
<div id="img-hyperv2" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv2.png" alt="hyperv2">
</div>
<div class="title">Figure 207. Instalação do Hyper-V, parte 2</div>
</div>
</li>
<li>
<p>Na escolha de versão do Windows Server 2016, selecione <em>Datacenter Evaluation (Desktop Experience)</em>.</p>
<div id="img-hyperv3" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv3.png" alt="hyperv3">
</div>
<div class="title">Figure 208. Instalação do Hyper-V, parte 3</div>
</div>
</li>
<li>
<p>Aceite os termos de licença, e prossiga.</p>
<div id="img-hyperv4" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv4.png" alt="hyperv4">
</div>
<div class="title">Figure 209. Instalação do Hyper-V, parte 4</div>
</div>
</li>
<li>
<p>Para o tipo de instalação, selecione <em>Custom: Install Windows only (advanced)</em>.</p>
<div id="img-hyperv5" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv5.png" alt="hyperv5">
</div>
<div class="title">Figure 210. Instalação do Hyper-V, parte 5</div>
</div>
</li>
<li>
<p>Selecione o único disco disponível, e prossiga.</p>
<div id="img-hyperv6" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv6.png" alt="hyperv6">
</div>
<div class="title">Figure 211. Instalação do Hyper-V, parte 6</div>
</div>
<div class="paragraph">
<p>Caso o disco não esteja formatado, apague todas as partições antes de prosseguir&#8201;&#8212;&#8201;se houver problemas com o formato atual do disco, pode ser necessário corrigir a tabela de partições usando um disco de recuperação Linux (consulte seu instrutor).</p>
</div>
</li>
<li>
<p>O Windows Server 2016 começará a ser instalado. Aguarde a conclusão do processo.</p>
<div id="img-hyperv7" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv7.png" alt="hyperv7">
</div>
<div class="title">Figure 212. Instalação do Hyper-V em progresso</div>
</div>
</li>
<li>
<p>Concluído o procedimento, o sistema será reiniciado. Defina a senha do usuário <code>Administrator</code> como <code>Virt3sr</code>, como mostrado abaixo:</p>
<div id="img-hyperv8" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv8.png" alt="hyperv8">
</div>
<div class="title">Figure 213. Definição da senha administrativa</div>
</div>
<div class="paragraph">
<p>Faça login no sistema, a seguir.</p>
</div>
<div id="img-hyperv9" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv9.png" alt="hyperv9">
</div>
<div class="title">Figure 214. Login inicial</div>
</div>
<div class="paragraph">
<p>Tudo pronto! O sistema foi instalado com sucesso.</p>
</div>
<div id="img-hyperv10" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv10.png" alt="hyperv10">
</div>
<div class="title">Figure 215. Conclusão do processo de instalação</div>
</div>
</li>
<li>
<p>Vamos colocar o servidor no domínio <code>virtesr.edu.br</code>. O primeiro passo é alterar o servidor DNS primário, o que pode ser feito através das opções IPv4 do sistema. Use o endereço indicado pelo instrutor.</p>
<div id="img-hyperv11" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv11.png" alt="hyperv11">
</div>
<div class="title">Figure 216. Configuração do DNS primário</div>
</div>
<div class="paragraph">
<p>Desabilite ainda o protocolo IPv6 da máquina, para evitar que outros servidores DNS sejam consultados prioritariamente.</p>
</div>
<div id="img-hyperv12" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv12.png" alt="hyperv12">
</div>
<div class="title">Figure 217. Desabilitando o protocolo IPv6</div>
</div>
</li>
<li>
<p>Em <em>System</em> &gt; <em>System Properties</em>, altere o domínio da máquina atual. Defina o nome de máquina como <code>HYPERV-DX-GY</code> (substituindo <code>X</code> e <code>Y</code> por sua dupla/grupo), e torne-o membro do domínio <code>virtesr.edu.br</code>.</p>
<div id="img-hyperv13" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv13.png" alt="hyperv13">
</div>
<div class="title">Figure 218. Alterando domínio da máquina</div>
</div>
<div class="paragraph">
<p>Para ingressar no domínio, será necessário informar um usuário com permissão de <em>Domain Admin</em>. Use a combinação de usuário/senha informada pelo instrutor para esse fim.</p>
</div>
<div id="img-hyperv14" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv14.png" alt="hyperv14">
</div>
<div class="title">Figure 219. Autenticação no domínio</div>
</div>
<div class="paragraph">
<p>Se houver sucesso no procedimento, você verá a janela a seguir:</p>
</div>
<div id="img-hyperv15" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv15.png" alt="hyperv15">
</div>
<div class="title">Figure 220. Ingresso no domínio com sucesso</div>
</div>
<div class="paragraph">
<p>O sistema deverá ser reiniciado. Aceite a sugestão da janela subsequente.</p>
</div>
<div id="img-hyperv16" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv16.png" alt="hyperv16">
</div>
<div class="title">Figure 221. Reiniciando o sistema</div>
</div>
</li>
<li>
<p>Após o <em>reboot</em>, faça login com o usuário do domínio (<strong>NÃO</strong> utilize o usuário <code>Administrator</code> local, use uma das contas <code>UserX</code>, dependendo da máquina que você esteja usando&#8201;&#8212;&#8201;consulte o mapa de sala). Abra o <em>prompt</em> de comando e use os comandos <code>whoami</code> e <code>hostname</code> para verificar que suas configurações foram realizadas com sucesso.</p>
<div id="img-hyperv17" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv17.png" alt="hyperv17">
</div>
<div class="title">Figure 222. Integração ao domínio concluída</div>
</div>
</li>
<li>
<p>Vamos instalar o Hyper-V. Abra o <em>Server Manager</em>, e em seguida execute o <em>wizard</em> <em>Add Roles and Features</em>. Na página inicial deste, clique em <em>Next</em>.</p>
<div id="img-hyperv19" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv19.png" alt="hyperv19">
</div>
<div class="title">Figure 223. Instalação do Hyper-V, parte 1</div>
</div>
<div class="paragraph">
<p>Mantenha a caixa <em>Role-base or feature-based installation</em> marcada, e clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv20" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv20.png" alt="hyperv20">
</div>
<div class="title">Figure 224. Instalação do Hyper-V, parte 2</div>
</div>
<div class="paragraph">
<p>Selecione seu servidor no <em>pool</em> (deve ser o único disponível), e prossiga.</p>
</div>
<div id="img-hyperv21" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv21.png" alt="hyperv21">
</div>
<div class="title">Figure 225. Instalação do Hyper-V, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>Select server roles</em>, marque a caixa <em>Hyper-V</em>.</p>
</div>
<div id="img-hyperv22" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv22.png" alt="hyperv22">
</div>
<div class="title">Figure 226. Instalação do Hyper-V, parte 4</div>
</div>
<div class="paragraph">
<p>Aceite a instalação das <em>features</em> adicionais, necessárias ao funcionamento do Hyper-V.</p>
</div>
<div id="img-hyperv23" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv23.png" alt="hyperv23">
</div>
<div class="title">Figure 227. Instalação do Hyper-V, parte 5</div>
</div>
<div class="paragraph">
<p>Na tela <em>Select features</em>, clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv24" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv24.png" alt="hyperv24">
</div>
<div class="title">Figure 228. Instalação do Hyper-V, parte 6</div>
</div>
<div class="paragraph">
<p>Leia os avisos na tela <em>Hyper-V</em>, e prossiga.</p>
</div>
<div id="img-hyperv25" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv25.png" alt="hyperv25">
</div>
<div class="title">Figure 229. Instalação do Hyper-V, parte 7</div>
</div>
<div class="paragraph">
<p>Em <em>Virtual Switches</em>, marque a caixa com seu adaptador Ethernet físico e prossiga.</p>
</div>
<div id="img-hyperv26" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv26.png" alt="hyperv26">
</div>
<div class="title">Figure 230. Instalação do Hyper-V, parte 8</div>
</div>
<div class="paragraph">
<p>Para migração de VMs, mantenha todas as configurações inalteradas e prossiga. Iremos configurar esta característica em uma atividade futura.</p>
</div>
<div id="img-hyperv27" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv27.png" alt="hyperv27">
</div>
<div class="title">Figure 231. Instalação do Hyper-V, parte 9</div>
</div>
<div class="paragraph">
<p>Em <em>Default Stores</em>, mantenha os diretórios de armazenamento padrão do sistema e prossiga.</p>
</div>
<div id="img-hyperv28" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv28.png" alt="hyperv28">
</div>
<div class="title">Figure 232. Instalação do Hyper-V, parte 10</div>
</div>
<div class="paragraph">
<p>Confirme que todos os dados de instalação estão corretos, marque a caixa <em>Restart the destination server automatically if required</em> e inicie a instalação do Hyper-V.</p>
</div>
<div id="img-hyperv29" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv29.png" alt="hyperv29">
</div>
<div class="title">Figure 233. Instalação do Hyper-V, confirmação</div>
</div>
<div class="paragraph">
<p>Ao final do processo, clique em <em>Close</em>. Reinicie sua máquina, se ela não houver feito isso automaticamente.</p>
</div>
<div id="img-hyperv30" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv30.png" alt="hyperv30">
</div>
<div class="title">Figure 234. Instalação do Hyper-V concluída</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_gerenciamento_do_hyper_v">2) Gerenciamento do Hyper-V</h3>
<div class="paragraph">
<p>O Hyper-V pode ser gerenciado através do centro de controle do servidor ou por ferramentas que utilizem a interface <em>Windows Management Instrumentation</em> (WMI) . Scripts para <em>PowerShell</em> que utilizam esta infraestrutura podem ser encontrados em: <a href="http://pshyperv.codeplex.com/" class="bare">http://pshyperv.codeplex.com/</a></p>
</div>
<div class="paragraph">
<p>Durante o curso, o <em>Server Manager</em> será utilizado para acessar o <em>snap-in</em> de gerenciamento do Hyper-V.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para acessar a interface de gerenciamento, clique em <em>Server Manager</em> &gt; <em>Tools</em> e selecione <em>Hyper-V Manager</em>.</p>
</li>
<li>
<p>Localize a entrada para a máquina local, e clique no atalho <em>Hyper-V Settings</em>.</p>
<div id="img-hyperv31" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv31.png" alt="hyperv31">
</div>
<div class="title">Figure 235. Configurações do Hyper-V</div>
</div>
</li>
<li>
<p>Em <em>Virtual Hard Disks</em> e <em>Virtual Machines</em>, localize o caminho padrão utilizados para armazenar as imagens e configurações das máquinas virtuais. O Hyper-V mantém o particionamento efetuado na instalação do Windows.</p>
<div id="img-hyperv32" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv32.png" alt="hyperv32">
</div>
<div class="title">Figure 236. Armazenamento de VHDs</div>
</div>
<div id="img-hyperv33" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv33.png" alt="hyperv33">
</div>
<div class="title">Figure 237. Armazenamento de configurações de VMs</div>
</div>
</li>
<li>
<p>Em <em>Keyboard</em>, observe o mapeamento das teclas modificadoras (<code>Ctrl</code>, <code>Alt</code> e <code>Windows</code>) quando utilizadas nas máquinas virtuais.</p>
<div id="img-hyperv34" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv34.png" alt="hyperv34">
</div>
<div class="title">Figure 238. Configurações de atalhos de teclado</div>
</div>
</li>
<li>
<p>Volte a interface de gerenciamento e utilize o link <em>Virtual Switch Manager</em> para editar as configurações de rede do ambiente virtual. Acesse as configurações da interface de rede local disponível em <em>Virtual Networks</em>, e configure a interface de rede como externa. Marque também a caixa <em>Allow management operating system to share this network adapter</em>.</p>
<div id="img-hyperv35" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv35.png" alt="hyperv35">
</div>
<div class="title">Figure 239. Configurações de rede virtual</div>
</div>
</li>
<li>
<p>Durante a instalação do Hyper-V, foi configurada uma rede virtual conectada a uma interface física de rede. Observe que as redes podem ser do tipo:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Externa: rede conectada a uma interface física;</p>
</li>
<li>
<p>Somente Interno: para comunicação entre máquinas virtuais e o hypervisor;</p>
</li>
<li>
<p>Privada: somente visível para as máquinas virtuais.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Os endereços MACs são atribuídos durante a criação das máquinas virtuais e, podem ser alterados em <em>MAC Address Range</em>.</p>
</div>
<div id="img-hyperv36" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv36.png" alt="hyperv36">
</div>
<div class="title">Figure 240. Faixa de endereços MAC</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_acesso_ao_servidor_de_isos">3) Acesso ao servidor de ISOs</h3>
<div class="paragraph">
<p>No Hyper-V, o acesso ao servidor com os arquivos ISO utilizadas para instalação de máquinas virtuais deve ser realizado através de uma unidade de rede mapeada no Hypervisor.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Acessando o <em>Windows Explorer</em> clique em <em>Computer</em> e, na parte superior da janela, clique em <em>Map network drive</em>.</p>
<div id="img-hyperv37" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv37.png" alt="hyperv37">
</div>
<div class="title">Figure 241. Mapeando unidade de rede, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione uma letra (<code>Z</code>, por exemplo) e informe o caminho completo até o compartilhamento CIFS (URL informada pelo instrutor). Marque a caixa <em>Reconnect at sign-in</em>.</p>
</div>
<div id="img-hyperv38" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv38.png" alt="hyperv38">
</div>
<div class="title">Figure 242. Mapeando unidade de rede, parte 2</div>
</div>
<div class="paragraph">
<p>Após o mapeamento, navegue para a unidade de rede e verifique seu conteúdo.</p>
</div>
<div id="img-hyperv39" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv39.png" alt="hyperv39">
</div>
<div class="title">Figure 243. Unidade de rede mapeada com sucesso</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_criação_de_máquinas_virtuais">4)  Criação de máquinas virtuais</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>De volta ao <em>Hyper-V Manager</em>, acesse <em>New</em> &gt; <em>Virtual Machine</em>. Na tela inicial, clique em <em>Next</em>.</p>
<div id="img-hyperv40" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv40.png" alt="hyperv40">
</div>
<div class="title">Figure 244. Criação de VM, parte 1</div>
</div>
<div class="paragraph">
<p>Especifique um nome relevante para a VM (no exemplo abaixo, <code>win10-d1-g1</code>), e clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv41" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv41.png" alt="hyperv41">
</div>
<div class="title">Figure 245. Criação de VM, parte 2</div>
</div>
<div class="paragraph">
<p>Agora, escolha a geração 2 para a VM:</p>
</div>
<div id="img-hyperv42" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv42.png" alt="hyperv42">
</div>
<div class="title">Figure 246. Criação de VM, parte 3</div>
</div>
<div class="paragraph">
<p>Na alocação de memória para a VM, determine 4 GB.</p>
</div>
<div id="img-hyperv43" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv43.png" alt="hyperv43">
</div>
<div class="title">Figure 247. Criação de VM, parte 4</div>
</div>
<div class="paragraph">
<p>Em rede, defina como conexão o único <em>virtual switch</em> disponível em seu ambiente.</p>
</div>
<div id="img-hyperv44" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv44.png" alt="hyperv44">
</div>
<div class="title">Figure 248. Criação de VM, parte 5</div>
</div>
<div class="paragraph">
<p>Na configuração do VHDX, mantenha como padrão o caminho de armazenamento e altere seu tamanho para 40 GB.</p>
</div>
<div id="img-hyperv45" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv45.png" alt="hyperv45">
</div>
<div class="title">Figure 249. Criação de VM, parte 6</div>
</div>
<div class="paragraph">
<p>Na definição de uma imagem ISO para instalação do sistema-alvo, aponte o compartilhamento de rede que foi adicionado na atividade anterior. Caso ele não esteja sendo mostrado pelo Windows Explorer, digite manualmente o caminho completo até o <em>share</em> CIFS com a imagem ISO de instalação do Windows 10, como mostrado no exemplo abaixo.</p>
</div>
<div id="img-hyperv46" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv46.png" alt="hyperv46">
</div>
<div class="title">Figure 250. Criação de VM, parte 7</div>
</div>
<div class="paragraph">
<p>Na tela de sumário final, confirme que as informações de criação da VM estão corretas e clique em <em>Finish</em>.</p>
</div>
<div id="img-hyperv47" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv47.png" alt="hyperv47">
</div>
<div class="title">Figure 251. Criação de VM, finalização</div>
</div>
</li>
<li>
<p>Uma vez criada a VM, clique com o botão direito na mesma em em seguida em <em>Connect</em> para abrir a console de interação.</p>
<div id="img-hyperv48" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv48.png" alt="hyperv48">
</div>
<div class="title">Figure 252. Abrindo a console da VM</div>
</div>
<div class="paragraph">
<p>Agora, clique em <em>Start</em> para ligar a máquina virtual.</p>
</div>
<div id="img-hyperv49" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv49.png" alt="hyperv49">
</div>
<div class="title">Figure 253. Ligando a VM</div>
</div>
</li>
<li>
<p>Você verá a tela de instalação do Windows 10, da mesma forma que fizemos em sessões anteriores. Faça a instalação do SO seguindo os passos delineados na sessão 3.</p>
<div id="img-hyperv50" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv50.png" alt="hyperv50">
</div>
<div class="title">Figure 254. Instalação do Windows 10</div>
</div>
<div class="paragraph">
<p>Instalado e configurado o SO, você estará o Desktop padrão do Windows 10, como mostrado a seguir.</p>
</div>
<div id="img-hyperv51" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv51.png" alt="hyperv51">
</div>
<div class="title">Figure 255. Windows 10 instalado com sucesso</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_configuração_padrão_das_máquinas_virtuais">5) Configuração padrão das máquinas virtuais</h3>
<div class="paragraph">
<p>No atalho <em>Settings</em>, é possível alterar quase todos os recursos associados a uma máquina virtual.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Em <em>Processor</em>, é possível definir a quantidade de processadores lógicos, reservas de recursos e limites de utilização.</p>
<div id="img-hyperv52" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv52.png" alt="hyperv52">
</div>
<div class="title">Figure 256. Configurações de processador da VM</div>
</div>
</li>
<li>
<p>Em <em>SCSI Controller</em> &gt; <em>Hard Drive</em>, note que o disco virtual criado utiliza conexão SCSI, por padrão.
.desc</p>
<div id="img-hyperv53" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv53.png" alt="hyperv53">
</div>
</div>
<div class="paragraph">
<p>Observe atentamente a localização do arquivo VHDX da máquina virtual: iremos movê-lo brevemente, na atividade a seguir.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_replicação_de_vm_entre_hyper_v">6) Replicação de VM entre Hyper-V</h3>
<div class="paragraph">
<p>Nesta atividade iremos testar uma das mais importantes funcionalidades do Hyper-V: replicação de máquinas virtuais. O processo de configuração é simples e por consumir poucos recursos pode ser implementado em pequenas e médias empresas. Siga os passos abaixo com bastante atenção para conhecer melhor seu funcionamento.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vamos preparar o sistema para replicação das VMs. Primeiro, desligue a máquina virtual criada na atividade (4), se estiver ligada.</p>
<div class="paragraph">
<p>Em seguida, crie a pasta nova <code>C:\vms</code>, como mostrado a seguir.</p>
</div>
<div id="img-hyperv54" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv54.png" alt="hyperv54">
</div>
<div class="title">Figure 257. Criando pasta de compartilhamento</div>
</div>
<div class="paragraph">
<p>Agora, vá ao local de armazenamento do arquivo VHDX da máquina virtual (que visualizamos no passo 2 da atividade 5), recorte-o e cole na pasta <code>C:\vms</code>, como se segue:</p>
</div>
<div id="img-hyperv55" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv55.png" alt="hyperv55">
</div>
<div class="title">Figure 258. Movendo VHDX da máquina virtual</div>
</div>
</li>
<li>
<p>De volta ao <em>Hyper-V Manager</em>, em <em>Settings</em> &gt; <em>Hardware</em> &gt; <em>SCSI Controller</em> &gt; <em>Hard Drive</em>, informe o novo caminho do disco virtual para o Hyper-V.</p>
<div id="img-hyperv56" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv56.png" alt="hyperv56">
</div>
<div class="title">Figure 259. Relocando caminho do VHDX</div>
</div>
</li>
<li>
<p>Em <em>Replication Configuration</em>, marque a caixa <em>Enable this computer as a Replica server</em>. Marque a caixa <em>Use Kerberos (HTTP)</em>, na porta 80. Finalmente, em <em>Authorization and storage</em>, marque o botão <em>Allow replication from any authenticated server</em> e especifique o caminho de busca <code>C:\vms</code>. Confira abaixo:</p>
<div id="img-hyperv58" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv58.png" alt="hyperv58">
</div>
<div class="title">Figure 260. Configurações de replicação</div>
</div>
<div class="paragraph">
<p>O Hyper-V irá avisar que é necessário configurar o firewall local para permitir tráfego na porta indicada.</p>
</div>
<div id="img-hyperv59" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv59.png" alt="hyperv59">
</div>
<div class="title">Figure 261. Aviso de configuração de firewall</div>
</div>
</li>
<li>
<p>Abra o <em>Windows Firewall with Advanced Security</em> e habilite a regra <em>Hyper-V Replica HTTP Listener (TCP-In)</em>.</p>
<div id="img-hyperv60" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv60.png" alt="hyperv60">
</div>
<div class="title">Figure 262. Habilitando regra de firewall</div>
</div>
</li>
<li>
<p>Agora sim! De volta ao <em>Hyper-V Manager</em>, clique com o botão direito sobre a VM e depois em <em>Enable Replication</em>.</p>
<div id="img-hyperv61" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv61.png" alt="hyperv61">
</div>
<div class="title">Figure 263. Habilitando replicação, parte 1</div>
</div>
<div class="paragraph">
<p>Na tela inicial, clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv62" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv62.png" alt="hyperv62">
</div>
<div class="title">Figure 264. Habilitando replicação, parte 2</div>
</div>
<div class="paragraph">
<p>Em <em>Replica server</em>, digite o nome de máquina do hypervisor remoto que receberá a réplica de VM (este será o hypervisor <strong>do seu colega</strong>, não a máquina local). No exemplo abaixo, especificamos a máquina <code>HYPERV-D2-G1</code>.</p>
</div>
<div id="img-hyperv63" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv63.png" alt="hyperv63">
</div>
<div class="title">Figure 265. Habilitando replicação, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>Specify Connection Parameters</em>, mantenha a porta de conexão em 80, uso de autenticação Kerberos (HTTP) e marque a caixa <em>Compress the data that is transmitted over the network</em>.</p>
</div>
<div id="img-hyperv64" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv64.png" alt="hyperv64">
</div>
<div class="title">Figure 266. Habilitando replicação, parte 4</div>
</div>
<div class="paragraph">
<p>Na escolha de VHDs de replicação, marque o disco virtual da VM corrente.</p>
</div>
<div id="img-hyperv65" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv65.png" alt="hyperv65">
</div>
<div class="title">Figure 267. Habilitando replicação, parte 5</div>
</div>
<div class="paragraph">
<p>Quanto à frequência de atualização de envio de mudanças para o servidor de réplica, selecione 30 segundos.</p>
</div>
<div id="img-hyperv66" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv66.png" alt="hyperv66">
</div>
<div class="title">Figure 268. Habilitando replicação, parte 6</div>
</div>
<div class="paragraph">
<p>Na configuração de pontos de restauração, marque <em>Create additional hourly recovery points</em>, com frequência de 24h, e marque a caixa que habilita criação de <em>snapshots</em> VSS, com frequência de 4h.</p>
</div>
<div id="img-hyperv67" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv67.png" alt="hyperv67">
</div>
<div class="title">Figure 269. Habilitando replicação, parte 7</div>
</div>
<div class="paragraph">
<p>No método inicial de replicação, marque a caixa <em>Send initial copy over the network</em>, e <em>Start replication immediately</em>. Clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv68" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv68.png" alt="hyperv68">
</div>
<div class="title">Figure 270. Habilitando replicação, parte 8</div>
</div>
<div class="paragraph">
<p>Confirme que as opções de replicação estão corretas, e clique em <em>Finish</em>.</p>
</div>
<div id="img-hyperv69" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv69.png" alt="hyperv69">
</div>
<div class="title">Figure 271. Habilitando replicação, finalização</div>
</div>
</li>
<li>
<p>Acompanhe o progresso de envio da réplica através da coluna <em>Status</em> da VM.</p>
<div id="img-hyperv70" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv70.png" alt="hyperv70">
</div>
<div class="title">Figure 272. Progresso de envio de réplica</div>
</div>
<div class="paragraph">
<p>Ao receber a réplica da máquina virtual do hypervisor de seu colega, também é possível acompanhar o progresso de recebimento de mudanças na coluna <em>Status</em>.</p>
</div>
<div id="img-hyperv71" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv71.png" alt="hyperv71">
</div>
<div class="title">Figure 273. Progresso de recebimento de réplica</div>
</div>
</li>
<li>
<p>Terminados os processos de replicação, tente iniciar a VM remota.</p>
<div id="img-hyperv72" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv72.png" alt="hyperv72">
</div>
<div class="title">Figure 274. Iniciando VM sob replicação</div>
</div>
<div class="paragraph">
<p>O sistema reporta erro, informando que a máquina está em processo contínuo de replicação.</p>
</div>
<div id="img-hyperv73" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv73.png" alt="hyperv73">
</div>
<div class="title">Figure 275. Erro ao inicial VM sob replicação</div>
</div>
</li>
<li>
<p>Vamos testar a funcionalidade de replicação. Inicie um ping infinito (<code>ping -t</code>) para uma das VMs da dupla.</p>
<div id="img-hyperv74" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv74.png" alt="hyperv74">
</div>
<div class="title">Figure 276. Ping para VM em operação</div>
</div>
<div class="paragraph">
<p>Remova o cabo de rede ou desligue abruptamente o hypervisor-pai da VM que está recebendo o ping. No outro hypervisor, navegue para <em>Replication</em> &gt; <em>View Replication Health</em> para visualizar o que aconteceu com a máquina.</p>
</div>
<div id="img-hyperv75" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv75.png" alt="hyperv75">
</div>
<div class="title">Figure 277. Monitoramento de replicação</div>
</div>
<div class="paragraph">
<p>Note que o sistema reporta problemas, informando que não é possível contatar o hypervisor responsável pela replicação.</p>
</div>
<div id="img-hyperv76" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv76.png" alt="hyperv76">
</div>
<div class="title">Figure 278. Replicação com problemas</div>
</div>
<div class="paragraph">
<p>Em <em>Replication</em> &gt; <em>Failover</em>, vamos ativar a tolerância a falhas da VM, assumindo o controle pela operação da máquina sendo replicada.</p>
</div>
<div id="img-hyperv77" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv77.png" alt="hyperv77">
</div>
<div class="title">Figure 279. Ativação do failover de VM</div>
</div>
<div class="paragraph">
<p>O sistema avisa que o <em>failover</em> deve ser ativado apenas se a VM primária estiver em estado de falha. Como este é o caso (já que indisponibilizamos o hypervisor primário), confirme a operação de <em>failover</em>.</p>
</div>
<div id="img-hyperv78" class="imageblock text-center">
<div class="content">
<img src="./img/5_Hyper-V-s1/hyperv78.png" alt="hyperv78">
</div>
<div class="title">Figure 280. Confirmação de failover de VM</div>
</div>
<div class="paragraph">
<p>Espere a VM ligar, e depois verifique: é possível efetuar <code>ping</code> para a máquina virtual? Outra pergunta: caso o hypervisor primário volte a tornar-se disponível, quais passos devem ser realizados para retirar a VM secundária do estado de <em>failover</em> e retorná-la para o estado de replicação?</p>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_6_hyper_v_avançado">Sessão 6: Hyper-V avançado</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_configuração_de_cluster">1) Configuração de Cluster</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Antes de iniciar a configuração do <em>cluster</em>, devemos desabilitar a replicação ativada no final da sessão anterior. Em ambas as VMs, clique com o botão direito e navegue para <em>Replication</em> &gt; <em>Remove Replication</em>.</p>
<div id="img-hyperv-2-1" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv1.png" alt="hyperv1">
</div>
<div class="title">Figure 281. Removendo replicação, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme a operação.</p>
</div>
<div id="img-hyperv-2-2" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv2.png" alt="hyperv2">
</div>
<div class="title">Figure 282. Removendo replicação, parte 2</div>
</div>
</li>
<li>
<p>O Windows Server 2016 oferece um recurso para a agregação de servidores em <em>clusters</em> de alta disponibilidade. Para adicionar, abra o <em>Server Manager</em> e acesse <em>Add Roles and Features</em>.</p>
<div id="img-hyperv-2-3" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv3.png" alt="hyperv3">
</div>
<div class="title">Figure 283. Instalação do Failover Cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme a instalação baseada em <em>roles</em>.</p>
</div>
<div id="img-hyperv-2-4" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv4.png" alt="hyperv4">
</div>
<div class="title">Figure 284. Instalação do Failover Cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Selecione o servidor para instalação no <em>pool</em>.</p>
</div>
<div id="img-hyperv-2-5" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv5.png" alt="hyperv5">
</div>
<div class="title">Figure 285. Instalação do Failover Cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>Select server roles</em>, clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-6" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv6.png" alt="hyperv6">
</div>
<div class="title">Figure 286. Instalação do Failover Cluster, parte 4</div>
</div>
<div class="paragraph">
<p>Em <em>Select features</em>, marque a caixa <em>Failover Clustering</em>.</p>
</div>
<div id="img-hyperv-2-7" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv7.png" alt="hyperv7">
</div>
<div class="title">Figure 287. Instalação do Failover Cluster, parte 5</div>
</div>
<div class="paragraph">
<p>Confirme a instalação de <em>features</em> adicionais necessárias ao funcionamento do <em>Failover Cluster</em>.</p>
</div>
<div id="img-hyperv-2-8" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv8.png" alt="hyperv8">
</div>
<div class="title">Figure 288. Instalação do Failover Cluster, parte 6</div>
</div>
<div class="paragraph">
<p>Confirme a instalação, na janela seguinte.</p>
</div>
<div id="img-hyperv-2-9" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv9.png" alt="hyperv9">
</div>
<div class="title">Figure 289. Instalação do Failover Cluster, parte 7</div>
</div>
<div class="paragraph">
<p>Concluído o processo, clique em <em>Close</em>.</p>
</div>
<div id="img-hyperv-2-10" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv10.png" alt="hyperv10">
</div>
<div class="title">Figure 290. Instalação do Failover Cluster, parte 8</div>
</div>
</li>
<li>
<p>A partir deste ponto, a atividade deverá ser realizada em <strong>grupo</strong>, em <strong>apenas um</strong> dos hypervisors Windows Server 2016. Para iniciar a configuração do <em>cluster</em>, acesse <em>Tools</em> &gt; <em>Failover Cluster Manager</em> dentro do <em>Server Manager</em>.</p>
<div id="img-hyperv-2-11" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv11.png" alt="hyperv11">
</div>
<div class="title">Figure 291. Configuração do Failover Cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Na nova janela, na aba <em>Management</em>, clique em <em>Create Cluster</em>. O assistente de criação de <em>clusters</em> será iniciado em seguida.</p>
</div>
<div id="img-hyperv-2-12" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv12.png" alt="hyperv12">
</div>
<div class="title">Figure 292. Configuração do Failover Cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Leia as informações iniciais na tela <em>Before You Begin</em>, e em seguida clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-13" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv13.png" alt="hyperv13">
</div>
<div class="title">Figure 293. Configuração do Failover Cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>Select Servers</em>, digite o nome dos <strong>dois</strong> hypervisors do grupo, usando a nomenclatura de nome de máquina (FQDN) registrado junto ao <em>Active Directory</em>. Pode-se usar o endereço IP das máquinas, se desejado. Confira o exemplo a seguir:</p>
</div>
<div id="img-hyperv-2-14" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv14.png" alt="hyperv14">
</div>
<div class="title">Figure 294. Configuração do Failover Cluster, parte 4</div>
</div>
<div class="paragraph">
<p>Em <em>Validation Warning</em>, marque o botão <em>Yes. When I click Next (&#8230;&#8203;)</em> para confirmar a execução de testes de validação antes da criação do <em>cluster</em>.</p>
</div>
<div id="img-hyperv-2-15" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv15.png" alt="hyperv15">
</div>
<div class="title">Figure 295. Configuração do Failover Cluster, parte 5</div>
</div>
<div class="paragraph">
<p>O assistente de validação de configuração será aberto. Na janela inicial, leia as informações preliminares e clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-16" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv16.png" alt="hyperv16">
</div>
<div class="title">Figure 296. Configuração do Failover Cluster, parte 6</div>
</div>
<div class="paragraph">
<p>Em <em>Testing Options</em>, marque o botão <em>Run only tests I select</em> para visualizar e especificar quais testes de validação serão realizados.</p>
</div>
<div id="img-hyperv-2-17" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv17.png" alt="hyperv17">
</div>
<div class="title">Figure 297. Configuração do Failover Cluster, parte 7</div>
</div>
<div class="paragraph">
<p>Na tela <em>Test Selection</em>, mantenha todas as caixas exceto <em>Storage Spaces Direct</em> marcadas, e clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-18" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv18.png" alt="hyperv18">
</div>
<div class="title">Figure 298. Configuração do Failover Cluster, parte 8</div>
</div>
<div class="paragraph">
<p>Em <em>Confirmation</em>, verifique a lista de testes a serem realizados, e inicie-os.</p>
</div>
<div id="img-hyperv-2-19" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv19.png" alt="hyperv19">
</div>
<div class="title">Figure 299. Configuração do Failover Cluster, parte 9</div>
</div>
<div class="paragraph">
<p>Após algum tempo, a lista de resultados será mostrada, como exemplificado abaixo. Observe que foram levantados alertas devido à falta de um disco compartilhado entre os nós do <em>cluster</em>, o que iremos resolver a seguir.</p>
</div>
<div id="img-hyperv-2-20" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv20.png" alt="hyperv20">
</div>
<div class="title">Figure 300. Configuração do Failover Cluster, parte 10</div>
</div>
<div class="paragraph">
<p>De volta ao <em>wizard</em> de configuração do <em>Failover Cluster</em>, defina um nome sugestivo para o <em>cluster</em> da dupla.</p>
</div>
<div id="img-hyperv-2-21" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv21.png" alt="hyperv21">
</div>
<div class="title">Figure 301. Configuração do Failover Cluster, parte 11</div>
</div>
<div class="paragraph">
<p>Em <em>Confirmation</em>, verifique as informações do <em>cluster</em>, marque a caixa <em>Add all eligible storage to the cluster</em> e finalmente clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-22" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv22.png" alt="hyperv22">
</div>
<div class="title">Figure 302. Configuração do Failover Cluster, parte 12</div>
</div>
<div class="paragraph">
<p>Concluído o processo, clique em <em>Finish</em>.</p>
</div>
<div id="img-hyperv-2-23" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv23.png" alt="hyperv23">
</div>
<div class="title">Figure 303. Configuração do Failover Cluster, concluído</div>
</div>
</li>
<li>
<p>Confira se o <em>cluster</em> criado pode ser visualizado nos dois hypervisors do grupo, usando o <em>Failover Cluster Manager</em>.</p>
<div id="img-hyperv-2-24" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv24.png" alt="hyperv24">
</div>
<div class="title">Figure 304. Cluster criado com sucesso</div>
</div>
<div class="paragraph">
<p>Em <em>Nodes</em>, note que é possível observar que ambas as máquinas estão conectadas ao <em>cluster</em> em estado <em>Up</em>.</p>
</div>
<div id="img-hyperv-2-25" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv25.png" alt="hyperv25">
</div>
<div class="title">Figure 305. Nodes conectados ao cluster</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_configuração_de_storage_compartilhado">2) Configuração de storage compartilhado</h3>
<div class="paragraph">
<p>Da mesma forma que em outras atividades foi necessário configurar um dispositivo de armazenamento compartilhado (FreeNAS) entre os <em>nodes</em>, aqui faremos o mesmo. Este compartilhamento permitirá a migração de máquinas virtuais.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Este passo deve ser realizado em <strong>ambos</strong> os hypervisors da dupla.</p>
<div class="paragraph">
<p>No <em>Server Manager</em>, inicie a ferramenta <em>Tools</em> &gt; <em>iSCSI Initiator</em>.</p>
</div>
<div id="img-hyperv-2-26" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv26.png" alt="hyperv26">
</div>
<div class="title">Figure 306. Configuração iSCSI, parte 1</div>
</div>
<div class="paragraph">
<p>O sistema irá informar que o serviço iSCSI não foi iniciado. Clique em <em>Yes</em> para iniciá-lo, bem como configurá-lo como ativado em <em>boots</em> subsequentes do servidor.</p>
</div>
<div id="img-hyperv-2-27" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv27.png" alt="hyperv27">
</div>
<div class="title">Figure 307. Configuração iSCSI, parte 2</div>
</div>
<div class="paragraph">
<p>Na nova janela que se abrir, digite em <em>Target</em> o endereço IP do FreeNAS que será usado como <em>storage</em> compartilhado entre os nodos do <em>cluster</em>. Evidentemente, deve-se usar o mesmo <em>storage</em> para ambos os hypervisors. Em seguida, clique em <em>Quick Connect</em>.</p>
</div>
<div id="img-hyperv-2-28" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv28.png" alt="hyperv28">
</div>
<div class="title">Figure 308. Configuração iSCSI, parte 3</div>
</div>
<div class="paragraph">
<p>Na nova janela, verifique que a LUN correta foi exibida pelo <em>iSCSI Initiator</em>, e clique em <em>Done</em>.</p>
</div>
<div id="img-hyperv-2-29" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv29.png" alt="hyperv29">
</div>
<div class="title">Figure 309. Configuração iSCSI, parte 4</div>
</div>
<div class="paragraph">
<p>Na aba <em>Discovery</em>, note que o endereço IP e porta corretos do servidor FreeNAS figuram em ambos os hypervisors do grupo.</p>
</div>
<div id="img-hyperv-2-30" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv30.png" alt="hyperv30">
</div>
<div class="title">Figure 310. Configuração iSCSI, parte 5</div>
</div>
<div class="paragraph">
<p>Agora, navegue para a aba <em>Volumes and Devices</em> e clique no botão <em>Auto Configure</em>.</p>
</div>
<div id="img-hyperv-2-31" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv31.png" alt="hyperv31">
</div>
<div class="title">Figure 311. Configuração iSCSI, parte 6</div>
</div>
<div class="paragraph">
<p>Deverá surgir uma <em>string</em> longa representando o mapeamento da LUN do <em>storage</em> remoto no sistema local, como mostrado no figura a seguir.</p>
</div>
<div id="img-hyperv-2-32" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv32.png" alt="hyperv32">
</div>
<div class="title">Figure 312. Configuração iSCSI, parte 7</div>
</div>
</li>
<li>
<p>Realize os passos seguintes em <strong>apenas um</strong> hypervisor do grupo.</p>
<div class="paragraph">
<p>No <em>Server Manager</em>, acesse <em>Tools</em> &gt; <em>Computer Management</em>.</p>
</div>
<div id="img-hyperv-2-33" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv33.png" alt="hyperv33">
</div>
<div class="title">Figure 313. Inicialização da LUN, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>Storage</em> &gt; <em>Disk Management</em>, note que há um novo disco de 80 GB conectado; este disco corresponde à LUN no <em>storage</em> remoto. Observe, ainda, que ele se encontra em estado <em>offline</em>.</p>
</div>
<div id="img-hyperv-2-34" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv34.png" alt="hyperv34">
</div>
<div class="title">Figure 314. Inicialização da LUN, parte 2</div>
</div>
<div class="paragraph">
<p>Clique na proximidade da palavra <em>Offline</em> dentro do quadro do disco e depois em <em>Online</em> para torná-lo disponível.</p>
</div>
<div id="img-hyperv-2-35" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv35.png" alt="hyperv35">
</div>
<div class="title">Figure 315. Inicialização da LUN, parte 3</div>
</div>
<div class="paragraph">
<p>Agora, clique novamente e selecione <em>Initialize Disk</em>.</p>
</div>
<div id="img-hyperv-2-36" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv36.png" alt="hyperv36">
</div>
<div class="title">Figure 316. Inicialização da LUN, parte 4</div>
</div>
<div class="paragraph">
<p>Na nova janela, marque a caixa com o nome do disco e selecione o tipo de partição MBR para o mesmo.</p>
</div>
<div id="img-hyperv-2-37" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv37.png" alt="hyperv37">
</div>
<div class="title">Figure 317. Inicialização da LUN, parte 5</div>
</div>
<div class="paragraph">
<p>De volta à janela principal, clique com o botão direito sobre o espaço não-inicializado do disco e selecione a opção <em>New Simple Volume</em>.</p>
</div>
<div id="img-hyperv-2-38" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv38.png" alt="hyperv38">
</div>
<div class="title">Figure 318. Inicialização da LUN, parte 6</div>
</div>
<div class="paragraph">
<p>O <em>wizard</em> de configuração de disco será aberto. Clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-39" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv39.png" alt="hyperv39">
</div>
<div class="title">Figure 319. Inicialização da LUN, parte 7</div>
</div>
<div class="paragraph">
<p>Para o tamanho do volume do disco, mantenho o valor máximo especificado automaticamente.</p>
</div>
<div id="img-hyperv-2-40" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv40.png" alt="hyperv40">
</div>
<div class="title">Figure 320. Inicialização da LUN, parte 8</div>
</div>
<div class="paragraph">
<p>Assinale uma letra qualquer para o disco (no exemplo, <code>X</code>), e clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-41" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv41.png" alt="hyperv41">
</div>
<div class="title">Figure 321. Inicialização da LUN, parte 9</div>
</div>
<div class="paragraph">
<p>Formate o volume em NTFS, selecione um <em>label</em> com nome apropriado e marque a caixa <em>Perform a quick format</em>.</p>
</div>
<div id="img-hyperv-2-42" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv42.png" alt="hyperv42">
</div>
<div class="title">Figure 322. Inicialização da LUN, parte 10</div>
</div>
<div class="paragraph">
<p>Na janela final, confirme suas seleções e clique em <em>Finish</em>.</p>
</div>
<div id="img-hyperv-2-43" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv43.png" alt="hyperv43">
</div>
<div class="title">Figure 323. Inicialização da LUN, parte 11</div>
</div>
<div class="paragraph">
<p>De volta ao <em>Computer Management</em>, note que o disco foi inicializado e uma letra foi assinalada a ele.</p>
</div>
<div id="img-hyperv-2-44" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv44.png" alt="hyperv44">
</div>
<div class="title">Figure 324. Inicialização da LUN, concluída</div>
</div>
<div class="paragraph">
<p>Repita os passos desta etapa no segundo hypervisor da dupla. Não será necessário formatar o disco novamente, mas os passos de inicialização e assinalar letra ao disco deverão ser realizados. Ao final do processo, o disco deverá estar disponível de forma análoga ao que foi mostrado na tela acima.</p>
</div>
</li>
<li>
<p>Realize os passos seguintes em <strong>apenas um</strong> hypervisor do grupo.</p>
<div class="paragraph">
<p>Abra o <em>Failover Cluster Manager</em> e em <em>Storage</em> &gt; <em>Disks</em>, clique em <em>Add Disk</em>.</p>
</div>
<div id="img-hyperv-2-45" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv45.png" alt="hyperv45">
</div>
<div class="title">Figure 325. Adicionando disco compartilhado ao cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Na janela seguinte, o disco compartilhado (que deve estar disponível nos dois membros do <em>cluster</em>) é mostrado. Marque a caixa e clique em <em>OK</em>.</p>
</div>
<div id="img-hyperv-2-46" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv46.png" alt="hyperv46">
</div>
<div class="title">Figure 326. Adicionando disco compartilhado ao cluster, parte 2</div>
</div>
<div class="paragraph">
<p>De volta ao <em>Failover Cluster</em>, note que o disco foi adicionado e encontra-se em estado <em>Online</em>.</p>
</div>
<div id="img-hyperv-2-47" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv47.png" alt="hyperv47">
</div>
<div class="title">Figure 327. Adicionando disco compartilhado ao cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Clique com o botão direito sobre o disco, e em seguida em <em>Add to Cluster Shared Volumes</em>.</p>
</div>
<div id="img-hyperv-2-48" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv48.png" alt="hyperv48">
</div>
<div class="title">Figure 328. Adicionando disco compartilhado ao cluster, parte 4</div>
</div>
<div class="paragraph">
<p>O <em>storage</em> compartilhado será adicionado ao <em>cluster</em>, nos dois hypervisors. Acesse o caminho <code>C:\ClusterStorage\Volume1</code> para acessar o volume compartilhado.</p>
</div>
<div id="img-hyperv-2-49" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv49.png" alt="hyperv49">
</div>
<div class="title">Figure 329. Adicionando disco compartilhado ao cluster, concluído</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_migração_de_máquinas_virtuais">3) Migração de máquinas virtuais</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Em <strong>apenas um</strong> dos hypervisors do grupo, copie o arquivo VHDX da máquina virtual local para o <em>storage</em> compartilhado.</p>
<div id="img-hyperv-2-50" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv50.png" alt="hyperv50">
</div>
<div class="title">Figure 330. Cópia do arquivo VHDX</div>
</div>
<div class="paragraph">
<p>Acompanhe o progresso da cópia:</p>
</div>
<div id="img-hyperv-2-51" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv51.png" alt="hyperv51">
</div>
<div class="title">Figure 331. Progresso de cópia</div>
</div>
<div class="paragraph">
<p>Ao final do processo, a pasta <code>C:\ClusterStorage\Volume1</code> deve conter o arquivo VHDX da máquina virtual original.</p>
</div>
<div id="img-hyperv-2-52" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv52.png" alt="hyperv52">
</div>
<div class="title">Figure 332. Cópia concluída</div>
</div>
</li>
<li>
<p>No <em>Failover Cluster</em>, vamos criar uma nova máquina virtual que utilize o VHDX copiado anteriormente. Acesse <em>Roles</em> &gt; <em>Virtual Machines</em> &gt; <em>New Virtual Machine</em>.</p>
<div id="img-hyperv-2-53" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv53.png" alt="hyperv53">
</div>
<div class="title">Figure 333. Criação de VM no cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione o nodo-alvo para a VM (qualquer um é uma opção válida).</p>
</div>
<div id="img-hyperv-2-54" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv54.png" alt="hyperv54">
</div>
<div class="title">Figure 334. Criação de VM no cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Defina um nome apropriado para a VM do <em>cluster</em>, marque a caixa <em>Store the virtual machine in a different location</em> e aponte a pasta <code>C:\ClusterStorage\Volume1\Virtual Machines</code> para armazenamento da configuração da VM. Crie a pasta, caso esta não exista.</p>
</div>
<div id="img-hyperv-2-55" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv55.png" alt="hyperv55">
</div>
<div class="title">Figure 335. Criação de VM no cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Escolha a geração 2 para a VM.</p>
</div>
<div id="img-hyperv-2-56" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv56.png" alt="hyperv56">
</div>
<div class="title">Figure 336. Criação de VM no cluster, parte 4</div>
</div>
<div class="paragraph">
<p>Defina 4 GB de memória RAM para a máquina virtual.</p>
</div>
<div id="img-hyperv-2-57" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv57.png" alt="hyperv57">
</div>
<div class="title">Figure 337. Criação de VM no cluster, parte 5</div>
</div>
<div class="paragraph">
<p>Escolha o único <em>virtual switch</em> disponível para a saída de rede da VM.</p>
</div>
<div id="img-hyperv-2-58" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv58.png" alt="hyperv58">
</div>
<div class="title">Figure 338. Criação de VM no cluster, parte 6</div>
</div>
<div class="paragraph">
<p>Na tela <em>Connect Virtual Hard Disk</em>, marque a caixa <em>Use an existing virtual disk</em> e navegue até o caminho do arquivo VHDX que foi copiado no pass (1) desta atividade.</p>
</div>
<div id="img-hyperv-2-59" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv59.png" alt="hyperv59">
</div>
<div class="title">Figure 339. Criação de VM no cluster, parte 7</div>
</div>
<div class="paragraph">
<p>Na tela de sumário, confirme as opções de criação da máquina virtual e clique em <em>Finish</em>.</p>
</div>
<div id="img-hyperv-2-60" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv60.png" alt="hyperv60">
</div>
<div class="title">Figure 340. Criação de VM no cluster, finalização</div>
</div>
<div class="paragraph">
<p>O <em>Failover Cluster</em> irá reportar a criação da VM com sucesso, a seguir.</p>
</div>
<div id="img-hyperv-2-61" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv61.png" alt="hyperv61">
</div>
<div class="title">Figure 341. VM criada no cluster com sucesso</div>
</div>
</li>
<li>
<p>Observe a VM disponível na janela <em>Roles</em> do <em>Failover Cluster</em>. Clique em <em>Connect</em> para abrir a console de comunicação com a máquina virtual.</p>
<div id="img-hyperv-2-62" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv62.png" alt="hyperv62">
</div>
<div class="title">Figure 342. Acesso à VM do cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Com a console aberta, clique em <em>Start</em> para ligar a VM.</p>
</div>
<div id="img-hyperv-2-63" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv63.png" alt="hyperv63">
</div>
<div class="title">Figure 343. Acesso à VM do cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Uma vez ligada a VM, use o <em>prompt</em> de comando do Windows para descobrir o endereço IP da máquina, via comando <code>ipconfig</code>.</p>
</div>
<div id="img-hyperv-2-64" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv64.png" alt="hyperv64">
</div>
<div class="title">Figure 344. Acesso à VM do cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Lembre-se de desativar o firewall do Windows para permitir que pacotes ICMP sejam respondidos pela VM.</p>
</div>
<div id="img-hyperv-2-65" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv65.png" alt="hyperv65">
</div>
<div class="title">Figure 345. Acesso à VM do cluster, parte 4</div>
</div>
</li>
<li>
<p>De sua máquina física, inicie um ping infinito (comando <code>ping -t</code>) para a VM, acompanhando a resposta aos pacotes.</p>
<div id="img-hyperv-2-66" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv66.png" alt="hyperv66">
</div>
<div class="title">Figure 346. Ping iniciado para VM no cluster</div>
</div>
</li>
<li>
<p>No <em>Failover Cluster</em>, clique com o botão direito na VM e selecione <em>Move</em> &gt; <em>Live Migration</em> &gt; <em>Select Node</em>.</p>
<div id="img-hyperv-2-67" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv67.png" alt="hyperv67">
</div>
<div class="title">Figure 347. Migração de VM, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione o nó do <em>cluster</em> para o qual a máquina será movida.</p>
</div>
<div id="img-hyperv-2-68" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv68.png" alt="hyperv68">
</div>
<div class="title">Figure 348. Migração de VM, parte 2</div>
</div>
<div class="paragraph">
<p>Na coluna <em>Information</em>, acompanhe o progresso de migração da máquina virtual.</p>
</div>
<div id="img-hyperv-2-69" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv69.png" alt="hyperv69">
</div>
<div class="title">Figure 349. Migração de VM, parte 3</div>
</div>
</li>
<li>
<p>Concluído o <em>Live Migration</em>, volte ao comando ping rodando em sua máquina física e observe quantos pacotes foram perdidos durante o processo&#8201;&#8212;&#8201;poucos, não é mesmo? No exemplo abaixo, apenas 3 pacotes ICMP foram perdidos:</p>
<div id="img-hyperv-2-70" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv70.png" alt="hyperv70">
</div>
<div class="title">Figure 350. Pacotes perdidos durante migração de VM</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_alta_disponibilidade">4) Alta Disponibilidade</h3>
<div class="paragraph">
<p>O Hyper-V oferece suporte ao monitoramento de servidores por <em>heartbeat</em> e a reinicialização das máquinas virtuais que se tornam inoperantes por causa de falhas no sistema. Vamos testar essa funcionalidade?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para que o <em>cluster</em> consiga negociar a alta dispobilidade, é necessário que seja criado um disco compartilhado dedicado à manutenção do estado do <em>cluster</em>, o chamado <strong>quórum</strong>.</p>
<div class="paragraph">
<p>Abra a configuração do servidor FreeNAS que está sendo usado pelo <em>cluster</em>, e em <em>Armazenamento</em>, clique sobre o volume ZFS e depois em <em>Criar zvol</em>.</p>
</div>
<div id="img-hyperv-2-71" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv71.png" alt="hyperv71">
</div>
<div class="title">Figure 351. Criação de volume compartilhado no storage, parte 1</div>
</div>
<div class="paragraph">
<p>Defina um nome para o <em>zvol</em>, um comentário apropriado e tamanho de 2 GB. Note que não é necessário que o disco de quórum seja particularmente grande&#8201;&#8212;&#8201;de fato, de acordo com a documentação da Microsoft (<a href="https://support.microsoft.com/en-hk/help/280345/quorum-drive-configuration-information" class="bare">https://support.microsoft.com/en-hk/help/280345/quorum-drive-configuration-information</a>), 500 MB são suficientes para essa partição.</p>
</div>
<div id="img-hyperv-2-72" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv72.png" alt="hyperv72">
</div>
<div class="title">Figure 352. Criação de volume compartilhado no storage, parte 2</div>
</div>
<div class="paragraph">
<p>Em <em>Compartilhamento</em> &gt; <em>Block (iSCSI)</em> &gt; <em>Targets</em>, crie uma segunda LUN para o disco compartilhado recém-criado.</p>
</div>
<div id="img-hyperv-2-73" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv73.png" alt="hyperv73">
</div>
<div class="title">Figure 353. Criação de volume compartilhado no storage, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>Extents</em>, crie um novo <em>extent</em> para fazer a amarração da LUN.</p>
</div>
<div id="img-hyperv-2-74" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv74.png" alt="hyperv74">
</div>
<div class="title">Figure 354. Criação de volume compartilhado no storage, parte 4</div>
</div>
<div class="paragraph">
<p>Finalmente, em <em>Destinos Associados</em>, correlacione o <em>Target</em> e o <em>Extent</em> sob um número de LUN.</p>
</div>
<div id="img-hyperv-2-75" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv75.png" alt="hyperv75">
</div>
<div class="title">Figure 355. Criação de volume compartilhado no storage, parte 5</div>
</div>
</li>
<li>
<p>Em <strong>ambos</strong> os hypervisors do grupo, abra o <em>Server Manager</em> &gt; <em>Tools</em> &gt; <em>iSCSI Initiator</em> e reconecte-se no <em>storage</em> FreeNAS para fazer um <em>rescan</em> das LUNs disponíveis, com o botão <em>Quick Connect</em>.</p>
<div id="img-hyperv-2-76" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv76.png" alt="hyperv76">
</div>
<div class="title">Figure 356. Adicionando nova LUN ao cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Na nova janela, note que a LUN 2 é detectada. Clique sobre a mesma e em seguida em <em>Connect</em>.</p>
</div>
<div id="img-hyperv-2-77" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv77.png" alt="hyperv77">
</div>
<div class="title">Figure 357. Adicionando nova LUN ao cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Na aba <em>Volumes and Devices</em>, clique em <em>Auto Configure</em> para que a LUN seja relacionada a um <em>mount point</em> local no servidor.</p>
</div>
<div id="img-hyperv-2-78" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv78.png" alt="hyperv78">
</div>
<div class="title">Figure 358. Adicionando nova LUN ao cluster, parte 3</div>
</div>
</li>
<li>
<p>Em <strong>apenas um</strong> dos hypervisors, abra o <em>Server Manager</em> &gt; <em>Tools</em> &gt; <em>Computer Management</em> . Navegue para <em>Storage</em> &gt; <em>Disks</em> e torne o disco <em>Online</em>, como fizemos antes. Em seguida, clique em <em>Initialize Disk</em> e selecione o formato MBR.</p>
<div id="img-hyperv-2-79" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv79.png" alt="hyperv79">
</div>
<div class="title">Figure 359. Inicializando disco de quórum, parte 1</div>
</div>
<div class="paragraph">
<p>Da mesma forma que fizemos antes, inicie <em>New Simple Volume</em> e defina uma letra para o disco. Na tela de escolha de sistema de arquivos, mantenha NTFS e defina um <em>label</em> apropriado para o disco.</p>
</div>
<div id="img-hyperv-2-80" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv80.png" alt="hyperv80">
</div>
<div class="title">Figure 360. Inicializando disco de quórum, parte 2</div>
</div>
<div class="paragraph">
<p>Ao final do processo, o disco de quórum deve estar disponível como mostrado na figura abaixo:</p>
</div>
<div id="img-hyperv-2-81" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv81.png" alt="hyperv81">
</div>
<div class="title">Figure 361. Inicializando disco de quórum, concluído</div>
</div>
<div class="paragraph">
<p>No <strong>outro</strong> hypervisor do grupo faça configurações análogas de forma a tornar o disco de quórum acessível, como fizemos nos passos acima. Não é necessário reformatar o disco.</p>
</div>
</li>
<li>
<p>Em <strong>apenas um</strong> dos hypervisors, acesse o <em>Failover Cluster</em>. Em <em>Storage</em> &gt; <em>Disks</em>, clique em <em>Add Disk</em>.</p>
<div id="img-hyperv-2-82" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv82.png" alt="hyperv82">
</div>
<div class="title">Figure 362. Adicionando disco de quórum ao cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione o disco de quórum, com capacidade de 2 GB.</p>
</div>
<div id="img-hyperv-2-83" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv83.png" alt="hyperv83">
</div>
<div class="title">Figure 363. Adicionando disco de quórum ao cluster, parte 2</div>
</div>
</li>
<li>
<p>Clique com o botão direito sobre o <em>cluster</em>, e em seguida em <em>More Actions</em> &gt; <em>Configure Cluster Quorum Settings</em>.</p>
<div id="img-hyperv-2-84" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv84.png" alt="hyperv84">
</div>
<div class="title">Figure 364. Configurando o quórum do cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Na tela inicial do <em>wizard</em> de configuração do quórum do <em>cluster</em> clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-85" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv85.png" alt="hyperv85">
</div>
<div class="title">Figure 365. Configurando o quórum do cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Em <em>Select Quorum Configuration Option</em>, marque o botão do meio, <em>Select the quorum witness</em>.</p>
</div>
<div id="img-hyperv-2-86" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv86.png" alt="hyperv86">
</div>
<div class="title">Figure 366. Configurando o quórum do cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Depois, selecione <em>Configure a disk witness</em>.</p>
</div>
<div id="img-hyperv-2-87" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv87.png" alt="hyperv87">
</div>
<div class="title">Figure 367. Configurando o quórum do cluster, parte 4</div>
</div>
<div class="paragraph">
<p>Selecione o disco que foi configurado como quórum, que deve ser o único disponível para o <em>cluster</em>.</p>
</div>
<div id="img-hyperv-2-88" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv88.png" alt="hyperv88">
</div>
<div class="title">Figure 368. Configurando o quórum do cluster, parte 5</div>
</div>
<div class="paragraph">
<p>Verifique que suas configurações estão corretas, e clique em <em>Next</em>.</p>
</div>
<div id="img-hyperv-2-89" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv89.png" alt="hyperv89">
</div>
<div class="title">Figure 369. Configurando o quórum do cluster, parte 6</div>
</div>
<div class="paragraph">
<p>No sumário final, clique em <em>Finish</em> para encerrar o <em>wizard</em> de configuração.</p>
</div>
<div id="img-hyperv-2-90" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv90.png" alt="hyperv90">
</div>
<div class="title">Figure 370. Configurando o quórum do cluster, finalizado</div>
</div>
</li>
<li>
<p>De volta ao <em>Failover Cluster</em>, em <em>Storage</em> &gt; <em>Disks</em>, verifique que o <em>Cluster Shared Volume</em> e o <em>Disk Witness in Quorum</em> estão ambos corretamente configurados.</p>
<div id="img-hyperv-2-91" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv91.png" alt="hyperv91">
</div>
<div class="title">Figure 371. Quórum configurado com sucesso</div>
</div>
<div class="paragraph">
<p>Note que o quórum possui um <em>Owner node</em>, ou nó-dono. Neste nó, é possível visualizar o disco de quórum montado diretamente no Windows Explorer.</p>
</div>
<div id="img-hyperv-2-92" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv92.png" alt="hyperv92">
</div>
<div class="title">Figure 372. Disco de quórum disponível no nó-dono</div>
</div>
</li>
<li>
<p>Vamos testar a alta disponibilidade! Navegue para <em>Roles</em> e determine qual o nó-dono da máquina virtual em operação no <em>cluster</em>.</p>
<div id="img-hyperv-2-93" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv93.png" alt="hyperv93">
</div>
<div class="title">Figure 373. Nó-dono da VM identificado</div>
</div>
<div class="paragraph">
<p>Inicie um ping infinito (<code>ping -t</code>) para a VM. Em seguida, desligue o nó-dono da máquina virtual ordeiramente (i.e. selecionando a opção <em>Shut Down</em> no menu Iniciar do Windows Server 2016). Observe como rapidamente o nó-dono da VM é repassado para o outro host físico do <em>cluster</em>, e poucos pacotes são perdidos durante a migração da máquina.</p>
</div>
<div id="img-hyperv-2-94" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv94.png" alt="hyperv94">
</div>
<div class="title">Figure 374. Migração automática em caso de indisponibilidade</div>
</div>
</li>
<li>
<p>Claro, o teste do passo anterior foi feito de "caso pensado": ou seja, o servidor Windows que foi indisponibilizado foi desligado ordeiramente, e teve a oportunidade de avisar o outro membro do <em>cluster</em> e mover o estado da VM antes de concluir seu desligamento. E se essa máquina fosse desligada abruptamente?</p>
<div class="paragraph">
<p>Vamos testar: faça um <em>live migration</em> da VM de volta para o servidor original.</p>
</div>
<div id="img-hyperv-2-95" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv95.png" alt="hyperv95">
</div>
<div class="title">Figure 375. Migração da VM de volta para o nó-dono original</div>
</div>
<div class="paragraph">
<p>Agora, inicie um ping infinito para a VM e puxe o cabo de rede ou desligue "no botão" o nó-dono da VM, causando um desligamento abrupto. Observe que a VM entra em estado <em>Unmonitored</em> e os pacotes ICMP começam a ser perdidos.</p>
</div>
<div id="img-hyperv-2-96" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv96.png" alt="hyperv96">
</div>
<div class="title">Figure 376. VM indisponível após desligamento abrupto</div>
</div>
<div class="paragraph">
<p>De fato, a VM fica indisponível por um longo período, como visto abaixo. O nó remanescente do <em>cluster</em> irá aguardar um período de 4 minutos (valor padrão, configurável, como documentado em <a href="https://blogs.msdn.microsoft.com/clustering/2015/06/03/virtual-machine-compute-resiliency-in-windows-server-2016/" class="bare">https://blogs.msdn.microsoft.com/clustering/2015/06/03/virtual-machine-compute-resiliency-in-windows-server-2016/</a>)</p>
</div>
<div id="img-hyperv-2-97" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv97.png" alt="hyperv97">
</div>
<div class="title">Figure 377. VM indisponível por longo período</div>
</div>
<div class="paragraph">
<p>Em <em>Nodes</em>, observe que após 4 minutos o hypervisor desligado entra em estado <em>Isolated</em>.</p>
</div>
<div id="img-hyperv-2-98" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv98.png" alt="hyperv98">
</div>
<div class="title">Figure 378. Hypervisor em estado Isolated</div>
</div>
<div class="paragraph">
<p>A VM é reiniciada no nó remanescente do <em>cluster</em>, e os pacotes ICMP começam a ser respondidos novamente:</p>
</div>
<div id="img-hyperv-2-99" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv99.png" alt="hyperv99">
</div>
<div class="title">Figure 379. VM reiniciada e disponível</div>
</div>
</li>
<li>
<p>Note que todos os testes exemplificados até aqui buscaram desligar o hypervisor que <strong>não</strong> atuava como mestre do <em>cluster</em> e <strong>não</strong> era o nó-dono do disco de quórum. E se fizermos isso, o que acontece?</p>
<div id="img-hyperv-2-100" class="imageblock text-center">
<div class="content">
<img src="./img/6_Hyper-V-s2/hyperv100.png" alt="hyperv100">
</div>
<div class="title">Figure 380. Testando indisponibilização do nó-mestre do cluster</div>
</div>
<div class="paragraph">
<p>Mova o disco de quórum e VM para o mesmo nó, que deverá atuar como mestre do <em>cluster</em>. Em seguida, teste: o que acontece se desligarmos abruptamente esse host físico? O disco de quórum, VM e liderança do <em>cluster</em> serão assumidos pelo outro membro? E, se sim, após quanto tempo?</p>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_7_introdução_ao_vsphere">Sessão 7: Introdução ao VSphere</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_instalação_do_vmware_esxi">1) Instalação do VMware ESXi</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crie uma mídia bootável com o instalador do ESXi, conforme instruções providas pelo instrutor. Em seguida, insira a mídia na máquina destacada como hypervisor para a dupla e execute o <em>boot</em> via USB. Você verá a tela a seguir:</p>
<div id="img-vmw1" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw1.png" alt="vmw1">
</div>
<div class="title">Figure 381. Tela inicial de boot do ESXi</div>
</div>
<div class="paragraph">
<p>Selecione a primeira opção para iniciar o instalador.</p>
</div>
</li>
<li>
<p>Você verá a tela de boas-vindas do ESXi. Aperte <code>ENTER</code> para continuar.</p>
<div id="img-vmw2" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw2.png" alt="vmw2">
</div>
<div class="title">Figure 382. Instalação do ESXi, parte 1</div>
</div>
</li>
<li>
<p>Pressione <code>F11</code> para aceitar o termo de licença da ferramenta, e prossiga.</p>
<div id="img-vmw3" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw3.png" alt="vmw3">
</div>
<div class="title">Figure 383. Instalação do ESXi, parte 2</div>
</div>
</li>
<li>
<p>Selecione o disco físico da máquina local (provavelmente do tipo SATA ou ATA, como mostrado abaixo) para instalar o hypervisor.</p>
<div id="img-vmw4" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw4.png" alt="vmw4">
</div>
<div class="title">Figure 384. Instalação do ESXi, parte 3</div>
</div>
<div class="paragraph">
<p>O instalador avisa que os dados do disco serão apagados com o processo de instalação. Pressione <code>ENTER</code> para continuar.</p>
</div>
<div id="img-vmw5" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw5.png" alt="vmw5">
</div>
<div class="title">Figure 385. Instalação do ESXi, parte 4</div>
</div>
</li>
<li>
<p>Selecione <code>Brazilian</code> como o mapa de teclado do sistema.</p>
<div id="img-vmw6" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw6.png" alt="vmw6">
</div>
<div class="title">Figure 386. Instalação do ESXi, parte 5</div>
</div>
</li>
<li>
<p>Devido à exigência de parâmetro mínimo de senha por parte do ESXi, escolha <code>Virt3sr!</code> como a senha do usuário <code>root</code>.</p>
<div id="img-vmw7" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw7.png" alt="vmw7">
</div>
<div class="title">Figure 387. Instalação do ESXi, parte 6</div>
</div>
</li>
<li>
<p>Caso o instalador avise que algum hardware pode não ser suportado em versões posteriores do ESXi, pressione <code>ENTER</code> para prosseguir.</p>
<div id="img-vmw8" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw8.png" alt="vmw8">
</div>
<div class="title">Figure 388. Instalação do ESXi, parte 7</div>
</div>
</li>
<li>
<p>Finalmente, pressione <code>F11</code> para confirmar a instalação do hypervisor.</p>
<div id="img-vmw9" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw9.png" alt="vmw9">
</div>
<div class="title">Figure 389. Instalação do ESXi, parte 8</div>
</div>
<div class="paragraph">
<p>Após algum tempo, o sistema será instalado com sucesso. Pressione <code>ENTER</code> para reiniciar, e remova a mídia USB de instalação.</p>
</div>
<div id="img-vmw10" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw10.png" alt="vmw10">
</div>
<div class="title">Figure 390. Instalação do ESXi, concluída</div>
</div>
</li>
<li>
<p>Após o <em>reboot</em>, você verá a console administrativa do ESXi como mostrado na figura a seguir:</p>
<div id="img-vmw11" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw11.png" alt="vmw11">
</div>
<div class="title">Figure 391. Console administrativa do ESXi</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_conhecendo_o_vmware_esxi">2) Conhecendo o VMware ESXi</h3>
<div class="paragraph">
<p>É possível acessar o hypervisor via SSH após sua habilitação, ou diretamente no console do ESXi. Faremos o primeiro acesso através da console administrativa na máquina física.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pressione <code>F2</code> para acessar o menu <em>Customize System</em>. Faça login com o usuário <code>root</code> e a senha configurada no passo (6) da atividade anterior.</p>
<div id="img-vmw12" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw12.png" alt="vmw12">
</div>
<div class="title">Figure 392. Login na console administrativa do ESXi</div>
</div>
<div class="paragraph">
<p>Nesta interface é possível configurar algumas opções do hypervisor, como senha de acesso do administrador, rede de gerência, teclado, consulta a informações para suporte, visualização dos logs do sistema, entre outros.</p>
</div>
</li>
<li>
<p>Acesse <em>Configure Management Network</em> &gt; <em>DNS Configuration</em>.</p>
<div id="img-vmw13" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw13.png" alt="vmw13">
</div>
<div class="title">Figure 393. Configurações DNS</div>
</div>
<div class="paragraph">
<p>Altere o <em>hostname</em> da máquina para um valor significativo (no exemplo abaixo, estamos usando <code>esxi-d1-g1</code>).</p>
</div>
<div id="img-vmw14" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw14.png" alt="vmw14">
</div>
<div class="title">Figure 394. Alteração do hostname local</div>
</div>
<div class="paragraph">
<p>Em <em>Network Adapters</em> é possível visualizar as interfaces de gerenciamento deste host. Caso o servidor disponha de duas placas de rede, o ESXi atribui por padrão a gerência do host à primeira interface de rede física (vmnic0).</p>
</div>
<div id="img-vmw15" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw15.png" alt="vmw15">
</div>
<div class="title">Figure 395. Interfaces de rede do host físico</div>
</div>
<div class="paragraph">
<p>Pressione <code>ESC</code> para sair do menu corrente, e confirme as alterações teclando <code>Y</code> (<em>yes</em>).</p>
</div>
<div id="img-vmw16" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw16.png" alt="vmw16">
</div>
<div class="title">Figure 396. Confirmação de mudanças</div>
</div>
</li>
<li>
<p>Em <em>Troubleshooting Mode Options</em> &gt; <em>Enable SSH</em>, habilite o acesso remoto ao hypervisor via SSH.</p>
<div id="img-vmw17" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw17.png" alt="vmw17">
</div>
<div class="title">Figure 397. Habilitando acesso remoto</div>
</div>
<div class="paragraph">
<p>Novamente, saia do menu corrente e confirme suas alterações.</p>
</div>
</li>
<li>
<p>Usando o PuTTY ou Cygwin, logue via SSH no hypervisor ESXi. Informações a respeito do ambiente podem ser obtidas com o comando <code>esxcfg-info</code>. Este comando apresenta dados sobre o hardware, configurações do console de gerenciamento, além de informações sobre o estado dos recursos (CPU, memória etc.) e configurações relativas ao comportamento do hypervisor, armazenamento, alocação de memória para as máquinas virtuais, entre outros.</p>
<div id="img-vmw18" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw18.png" alt="vmw18">
</div>
<div class="title">Figure 398. Consulta do UUID do sistema via esxcfg-info</div>
</div>
</li>
<li>
<p>No ESXi, os dispositivos de armazenamento são gerenciados através do sistema VMFS. Estes dispositivos são agrupados em unidades lógicas chamadas <em>datastores</em>, onde são armazenados os dados das máquinas virtuais.</p>
<div class="paragraph">
<p>Na instalação padrão do ESXi, é criado um espaço de armazenamento (<code>datastore1</code>), acessível pelo caminho <code>/vmfs</code>. Dentro do subdiretório <code>Volumes</code> são armazenados os dados das máquinas virtuais.</p>
</div>
<div class="paragraph">
<p>O acesso de uma máquina virtual à rede externa é feito através de um <em>Virtual Switch</em> (<em>vSwitch</em>). Cada interface de rede de uma máquina virtual é associada a um <em>vSwitch</em>. Em cada um deles, é possível definir políticas de acesso à rede externa, configurações de firewall etc. Com a utilização de vários switches virtuais é possível criar configurações com redes isoladas, controlar tráfego de rede de grupos de máquinas virtuais ou com configurações de segurança distintas.</p>
</div>
<div class="paragraph">
<p>Um switch virtual possui um número de portas nas quais são conectadas as interfaces das máquinas virtuais. Observe que três destas portas são ocupadas na configuração padrão. Em uma destas portas, é conectado o dispositivo de rede físico <code>vmnic0</code>. Um switch pode estar conectado a várias interfaces físicas para prover balanceamento de carga ou tolerância a falhas. As outras duas portas são ocupadas pela rede padrão das novas máquinas virtuais e pelo console do hypervisor.</p>
</div>
<div class="paragraph">
<p>Abaixo, mostramos um exemplo de saída que exemplifica os temas apresentados neste passo:</p>
</div>
<div id="img-vmw19" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw19.png" alt="vmw19">
</div>
<div class="title">Figure 399. Informações de datastores e vSwitches</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_acessando_a_interface_web_de_configuração">3) Acessando a interface web de configuração</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para acessar a interface web de configuração do ESXi, digite o endereço apresentado na parte de baixo da console administrativa. Será apresentada uma tela de aviso de conexão TLS não confiável&#8201;&#8212;&#8201;aceite o certificado auto-assinado.</p>
<div id="img-vmw20" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw20.png" alt="vmw20">
</div>
<div class="title">Figure 400. Acesso à interface web do ESXi</div>
</div>
</li>
<li>
<p>Faça login na interface web com a conta <code>root</code> e a senha definida durante a instalação.</p>
<div id="img-vmw21" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw21.png" alt="vmw21">
</div>
<div class="title">Figure 401. Login na interface web</div>
</div>
<div class="paragraph">
<p>Quando perguntado se deseja ingressar no programa de melhoria de experiência do cliente VMWare, decline</p>
</div>
<div id="img-vmw22" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw22.png" alt="vmw22">
</div>
<div class="title">Figure 402. Ingresso no programa de melhoria de experiência do cliente VMWare</div>
</div>
</li>
<li>
<p>Finalmente, teremos acesso à interface web do ESXi. Navegue pelas diferentes janelas e abas para se ambientar com o sistema.</p>
<div id="img-vmw23" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw23.png" alt="vmw23">
</div>
<div class="title">Figure 403. Acesso à interface web do ESXi</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_adicionando_repositório_de_arquivos_iso">4) Adicionando repositório de arquivos ISO</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vamos adicionar um repositório de imagens ISO para instalar novas VMs. Acesse <em>Storage</em> &gt; <em>Datastores</em> &gt; <em>New datastore</em>.</p>
<div id="img-vmw24" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw24.png" alt="vmw24">
</div>
<div class="title">Figure 404. Criação de datastore ISO, parte 1</div>
</div>
<div class="paragraph">
<p>Na janela <em>Select creation type</em>, escolha <em>Mount NFS datastore</em>.</p>
</div>
<div id="img-vmw25" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw25.png" alt="vmw25">
</div>
<div class="title">Figure 405. Criação de datastore ISO, parte 2</div>
</div>
<div class="paragraph">
<p>Escolha um nome, e informe o endereço IP e caminho para o <em>mount</em> NFS contendo os arquivos ISO (consulte seu instrutor para obter o caminho correto). Defina a versão 4 do protocolo NFS.</p>
</div>
<div id="img-vmw26" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw26.png" alt="vmw26">
</div>
<div class="title">Figure 406. Criação de datastore ISO, parte 3</div>
</div>
<div class="paragraph">
<p>Na tela de confirmação, revise os dados e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw27" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw27.png" alt="vmw27">
</div>
<div class="title">Figure 407. Criação de datastore ISO, concluído</div>
</div>
</li>
<li>
<p>Uma vez criado o <em>datastore</em>, clique com o botão direito sobre o mesmo e selecione <em>Browse</em>.</p>
<div id="img-vmw28" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw28.png" alt="vmw28">
</div>
<div class="title">Figure 408. Visualizando arquivos no datastore, parte 1</div>
</div>
<div class="paragraph">
<p>Observe que as imagens ISO de instalação dos SOs estão disponíveis para uso.</p>
</div>
<div id="img-vmw29" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw29.png" alt="vmw29">
</div>
<div class="title">Figure 409. Visualizando arquivos no datastore, parte 2</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_criação_de_máquinas_virtuais">5) Criação de máquinas virtuais</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Agora, acesse <em>Virtual Machines</em> &gt; <em>Create/Register VM</em>.</p>
<div id="img-vmw30" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw30.png" alt="vmw30">
</div>
<div class="title">Figure 410. Criando VMs, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>Select creation type</em>, escolha <em>Create a new virtual machine</em>.</p>
</div>
<div id="img-vmw31" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw31.png" alt="vmw31">
</div>
<div class="title">Figure 411. Criando VMs, parte 2</div>
</div>
<div class="paragraph">
<p>Escolha um nome sugestivo para a VM, defina sua compatibilidade com hypervisors ESXi, sistema operacional (Windows) e versão do SO hóspede (Microsoft Windows 10 64-bit). Habilite a caixa <em>Enable Windows Virtualization Based Security</em>.</p>
</div>
<div id="img-vmw32" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw32.png" alt="vmw32">
</div>
<div class="title">Figure 412. Criando VMs, parte 3</div>
</div>
<div class="paragraph">
<p>Para o armazenamento, escolha o <code>datastore1</code> local.</p>
</div>
<div id="img-vmw33" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw33.png" alt="vmw33">
</div>
<div class="title">Figure 413. Criando VMs, parte 4</div>
</div>
<div class="paragraph">
<p>Agora, vamos configurar o hardware da VM. Aloque 2 processadores, 4 GB de RAM e 40 GB de armazenamento no disco virtual.</p>
</div>
<div id="img-vmw34" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw34.png" alt="vmw34">
</div>
<div class="title">Figure 414. Criando VMs, parte 5</div>
</div>
<div class="paragraph">
<p>Mais abaixo, na mesma tela, conecte ao <em>CD/DVD Drive 1</em> um arquivo ISO do <em>datastore</em>.</p>
</div>
<div id="img-vmw35" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw35.png" alt="vmw35">
</div>
<div class="title">Figure 415. Criando VMs, parte 6</div>
</div>
<div class="paragraph">
<p>Aponte a imagem ISO de instalação do Windows 10, como mostrado a seguir.</p>
</div>
<div id="img-vmw36" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw36.png" alt="vmw36">
</div>
<div class="title">Figure 416. Criando VMs, parte 7</div>
</div>
<div class="paragraph">
<p>Feito isso, clique em <em>Next</em>.</p>
</div>
<div id="img-vmw37" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw37.png" alt="vmw37">
</div>
<div class="title">Figure 417. Criando VMs, parte 8</div>
</div>
<div class="paragraph">
<p>Confirme as opções de criação da VM e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw38" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw38.png" alt="vmw38">
</div>
<div class="title">Figure 418. Criando VMs, concluído</div>
</div>
</li>
<li>
<p>Após a criação da máquina virtual, selecione-a e clique em <em>Power On</em> para ligar.</p>
<div id="img-vmw39" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw39.png" alt="vmw39">
</div>
<div class="title">Figure 419. Ligando VM</div>
</div>
<div class="paragraph">
<p>A tela de instalação do Windows 10 surgirá, brevemente. Proceda com a instalação do SO como feito em sessões anteriores.</p>
</div>
<div id="img-vmw40" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw40.png" alt="vmw40">
</div>
<div class="title">Figure 420. Instalação do Windows 10 na VM, iniciada</div>
</div>
<div class="paragraph">
<p>Após a conclusão do processo você terá o Desktop do usuário <code>aluno</code>, na VM Windows 10, como mostrado abaixo.</p>
</div>
<div id="img-vmw41" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw41.png" alt="vmw41">
</div>
<div class="title">Figure 421. Instalação do Windows 10 na VM, concluída</div>
</div>
</li>
<li>
<p>Agora, vamos instalar os adicionais para convidado do ESXi: clique com o botão direito sobre a VM e acesse <em>Guest OS</em> &gt; <em>Install VMWare Tools</em>.</p>
<div id="img-vmw42" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw42.png" alt="vmw42">
</div>
<div class="title">Figure 422. Instalação do VMWare Tools, parte 1</div>
</div>
<div class="paragraph">
<p>O CD de instalação será inserido no drive virtual da VM. Abra o Windows Explorer e inicie a execução automática da mídia, como mostrado abaixo.</p>
</div>
<div id="img-vmw43" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw43.png" alt="vmw43">
</div>
<div class="title">Figure 423. Instalação do VMWare Tools, parte 2</div>
</div>
<div class="paragraph">
<p>O programa de instalação do VMWare Tools será iniciado.</p>
</div>
<div id="img-vmw44" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw44.png" alt="vmw44">
</div>
<div class="title">Figure 424. Instalação do VMWare Tools, parte 3</div>
</div>
<div class="paragraph">
<p>Selecione a instalação típica:</p>
</div>
<div id="img-vmw45" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw45.png" alt="vmw45">
</div>
<div class="title">Figure 425. Instalação do VMWare Tools, parte 4</div>
</div>
<div class="paragraph">
<p>E, finalmente, pressione <em>Install</em> para iniciar o processo de instalação; aguarde sua conclusão.</p>
</div>
<div id="img-vmw46" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw46.png" alt="vmw46">
</div>
<div class="title">Figure 426. Instalação do VMWare Tools, parte 5</div>
</div>
<div class="paragraph">
<p>Após a conclusão do processo, clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw47" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw47.png" alt="vmw47">
</div>
<div class="title">Figure 427. Instalação do VMWare Tools, concluída</div>
</div>
<div class="paragraph">
<p>Será necessário reiniciar a VM após a instalação do VMWare Tools. Confirme essa ação clicando em <em>Yes</em>.</p>
</div>
<div id="img-vmw48" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw48.png" alt="vmw48">
</div>
<div class="title">Figure 428. Reiniciando VM após instalação do VMWare Tools</div>
</div>
<div class="paragraph">
<p>Após o <em>reboot</em> verifique, na página de <em>status</em> da máquina virtual, que o VMWare Tools está instalado e detectado pelo hypervisor, como mostrado abaixo.</p>
</div>
<div id="img-vmw49" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw49.png" alt="vmw49">
</div>
<div class="title">Figure 429. VMWare Tools detectado pelo hypervisor</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_criação_de_snapshots">6) Criação de snapshots</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para criar <em>snapshots</em> de máquinas virtuais, basta clicar com o botão direito sobre a mesma e acessar <em>Snapshots</em> &gt; <em>Take Snapshot</em>.</p>
<div id="img-vmw50" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw50.png" alt="vmw50">
</div>
<div class="title">Figure 430. Criação de snapshots, parte 1</div>
</div>
<div class="paragraph">
<p>Na janela seguinte, selecione um nome para o <em>snapshot</em>. Se a VM estiver ligada, pode ser interessante incluir o <em>snapshot</em> de memória marcando a caixa <em>Snapshot the virtual machine&#8217;s memory</em>.</p>
</div>
<div id="img-vmw51" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw51.png" alt="vmw51">
</div>
<div class="title">Figure 431. Criação de snapshots, parte 2</div>
</div>
</li>
<li>
<p>Uma vez criado o <em>snapshot</em>, podemos gerenciá-los através do menu <em>Snapshots</em> &gt; <em>Manage Snapshots</em>.</p>
<div id="img-vmw52" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw52.png" alt="vmw52">
</div>
<div class="title">Figure 432. Gerenciando snapshots, parte 1</div>
</div>
<div class="paragraph">
<p>A tela seguinte mostrará a lista de <em>snapshots</em> disponíveis para a VM, bem como seu estado atual.</p>
</div>
<div id="img-vmw53" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw53.png" alt="vmw53">
</div>
<div class="title">Figure 433. Gerenciando snapshots, parte 2</div>
</div>
</li>
<li>
<p>Acesse a VM e crie um arquivo texto, com qualquer conteúdo, no Desktop do usuário <code>aluno</code>.</p>
<div id="img-vmw54" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw54.png" alt="vmw54">
</div>
<div class="title">Figure 434. Alterando estado atual da máquina</div>
</div>
</li>
<li>
<p>Agora, volte à gerência de <em>snapshots</em>, selecione o <em>snapshot</em> criado durante o passo (1) e clique em <em>Restore snapshot</em>.</p>
<div id="img-vmw55" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw55.png" alt="vmw55">
</div>
<div class="title">Figure 435. Restaurando snapshot, parte 1</div>
</div>
<div class="paragraph">
<p>O sistema avisa que o estado atual da máquina será perdido, se não for salvo de antemão. Clique em <em>Restore</em> para confirmar a restauração.</p>
</div>
<div id="img-vmw56" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw56.png" alt="vmw56">
</div>
<div class="title">Figure 436. Restaurando snapshot, parte 2</div>
</div>
</li>
<li>
<p>Acesse novamente a console da VM. Note que o arquivo texto, que havíamos criado anteriormente, já não existe mais.</p>
<div id="img-vmw57" class="imageblock text-center">
<div class="content">
<img src="./img/7_VSphere-s1/vmw57.png" alt="vmw57">
</div>
<div class="title">Figure 437. Arquivo texto pós-snapshot apagado</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_8_vsphere_avançado">Sessão 8: VSphere avançado</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_instalando_o_vcenter">1) Instalando o vCenter</h3>
<div class="paragraph">
<p>O vCenter é uma ferramenta que, através de seus recursos, proporciona ao gestor de um ambiente virtualizado a possibilidade de gerenciamento central de todos os hypervisors (ESXi) de uma organização. Em nosso laboratório, o vCenter será usado para gerenciar de forma central os dois hypervisors de um grupo&#8201;&#8212;&#8201;assim, sua instalação deve ser feita em <strong>apenas uma</strong> máquina do grupo, devendo esta atividade ser executada em equipe.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para iniciar a instalação do vCenter, o primeiro passo é montar a ISO de instalação (consulte seu instrutor sobre a localização deste arquivo). Use a funcionalidade nativa do Windows ou aplicativos externos (como o Virtual CloneDrive) para montar o disco.</p>
<div id="img-vmw-2-1" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw1.png" alt="vmw1">
</div>
<div class="title">Figure 438. Montando ISO de instalação do vCenter</div>
</div>
<div class="paragraph">
<p>A imagem será montada em sua máquina física sob uma letra qualquer (no exemplo abaixo, <code>E:\</code>). Acesse a raiz desse ponto de montagem, e depois entre na pasta <code>vcsa-ui-installer\win32</code>. Em seguida, execute o programa <code>installer.exe</code>, como mostrado abaixo.</p>
</div>
<div id="img-vmw-2-2" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw2.png" alt="vmw2">
</div>
<div class="title">Figure 439. Execução do instalador do vCenter</div>
</div>
</li>
<li>
<p>O instalador do vCenter será iniciado. Na janela de abertura, selecione a opção <em>Install</em>.</p>
<div id="img-vmw-2-3" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw3.png" alt="vmw3">
</div>
<div class="title">Figure 440. Instalação do vCenter, estágio 1, parte 1</div>
</div>
<div class="paragraph">
<p>Na tela introdutória, clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-4" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw4.png" alt="vmw4">
</div>
<div class="title">Figure 441. Instalação do vCenter, estágio 1, parte 2</div>
</div>
<div class="paragraph">
<p>Aceite os termos de licença da ferramenta, e clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-5" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw5.png" alt="vmw5">
</div>
<div class="title">Figure 442. Instalação do vCenter, estágio 1, parte 3</div>
</div>
<div class="paragraph">
<p>Para o tipo de <em>deployment</em>, selecione <em>vCenter Server with an Embedded Platform Services Controller</em>, e prossiga.</p>
</div>
<div id="img-vmw-2-6" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw6.png" alt="vmw6">
</div>
<div class="title">Figure 443. Instalação do vCenter, estágio 1, parte 4</div>
</div>
<div class="paragraph">
<p>Para o alvo da instalação do vCenter, indique o endereço IP de um dos hypervisors do grupo. Especifique a porta 443, usuário <code>root</code>, e senha de acesso definida na sessão anterior.</p>
</div>
<div id="img-vmw-2-7" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw7.png" alt="vmw7">
</div>
<div class="title">Figure 444. Instalação do vCenter, estágio 1, parte 5</div>
</div>
<div class="paragraph">
<p>Será mostrado um aviso sobre o certificado auto-assinado do hypervisor ESXi ao qual estamos nos conectando. Clique em <em>Yes</em> para prosseguir.</p>
</div>
<div id="img-vmw-2-8" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw8.png" alt="vmw8">
</div>
<div class="title">Figure 445. Instalação do vCenter, estágio 1, parte 6</div>
</div>
<div class="paragraph">
<p>Agora, defina as informações do <em>appliance</em> do vCenter. Escolha um nome apropriado para a VM, e <code>Virt3sr!</code> como senha de acesso administrativo.</p>
</div>
<div id="img-vmw-2-9" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw9.png" alt="vmw9">
</div>
<div class="title">Figure 446. Instalação do vCenter, estágio 1, parte 7</div>
</div>
<div class="paragraph">
<p>Para o tamanho do <em>deployment</em>, escolha <em>Tiny</em>. O <em>storage size</em> pode ser mantido como <em>Default</em>.</p>
</div>
<div id="img-vmw-2-10" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw10.png" alt="vmw10">
</div>
<div class="title">Figure 447. Instalação do vCenter, estágio 1, parte 8</div>
</div>
<div class="paragraph">
<p>Em seguida, escolha o <code>datastore1</code> como alvo de armazenamento do disco virtual do <em>appliance</em>. Habilite a opção <em>Enable Thin Disk Mode</em>.</p>
</div>
<div id="img-vmw-2-11" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw11.png" alt="vmw11">
</div>
<div class="title">Figure 448. Instalação do vCenter, estágio 1, parte 9</div>
</div>
<div class="paragraph">
<p>Nas configurações de rede, defina a rede-alvo <em>VM Network</em>, com configuração IPv4 e DHCP habilitados. Não altere as portas comuns, 80/HTTP e 443/HTTPS.</p>
</div>
<div id="img-vmw-2-12" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw12.png" alt="vmw12">
</div>
<div class="title">Figure 449. Instalação do vCenter, estágio 1, parte 10</div>
</div>
<div class="paragraph">
<p>Tudo pronto para iniciar o estágio 1 de instalação. Revise suas opções, e clique em <em>Finish</em> para prosseguir.</p>
</div>
<div id="img-vmw-2-13" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw13.png" alt="vmw13">
</div>
<div class="title">Figure 450. Instalação do vCenter, estágio 1, finalizado</div>
</div>
<div class="paragraph">
<p>Acompanhe o progresso de instalação da ferramenta, que pode levar algum tempo.</p>
</div>
<div id="img-vmw-2-14" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw14.png" alt="vmw14">
</div>
<div class="title">Figure 451. Progresso de instalação do vCenter, estágio 1</div>
</div>
<div class="paragraph">
<p>Ao final do processo de instalação, clique em <em>Continue</em>.</p>
</div>
<div id="img-vmw-2-15" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw15.png" alt="vmw15">
</div>
<div class="title">Figure 452. Estágio 1 de instalação do vCenter concluído</div>
</div>
</li>
<li>
<p>Vamos para o estágio 2 de instalação do vCenter. Na tela de apresentação, clique em <em>Next</em>.</p>
<div id="img-vmw-2-16" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw16.png" alt="vmw16">
</div>
<div class="title">Figure 453. Instalação do vCenter, estágio 2, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione a sincronização de hora com o host ESXi, e mantenha o acesso SSH habilitado.</p>
</div>
<div id="img-vmw-2-17" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw17.png" alt="vmw17">
</div>
<div class="title">Figure 454. Instalação do vCenter, estágio 2, parte 2</div>
</div>
<div class="paragraph">
<p>Agora, configure o SSO (<em>Single Sign-On</em>). Selecione <em>Create a new SSO domain</em> e, em seguida, defina um nome para o domínio SSO (guarde esse nome, pois ele será necessário para o login no ambiente do vCenter): no exemplo abaixo, sugerimos o nome <code>vcenter-gX.virtesr.edu.br</code>&#8201;&#8212;&#8201;substitua <code>X</code> pelo número do seu grupo. Defina a senha de acesso ao ambiente como <code>Virt3sr!</code>.</p>
</div>
<div id="img-vmw-2-18" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw18.png" alt="vmw18">
</div>
<div class="title">Figure 455. Instalação do vCenter, estágio 2, parte 3</div>
</div>
<div class="paragraph">
<p>Na tela do CEIP (VMWare <em>Customer Experience Improvement Program</em>), mantenha a caixa de ingresso no programa desmarcada e clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-19" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw19.png" alt="vmw19">
</div>
<div class="title">Figure 456. Instalação do vCenter, estágio 2, parte 4</div>
</div>
<div class="paragraph">
<p>Na tela de finalização, revise suas opções e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-20" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw20.png" alt="vmw20">
</div>
<div class="title">Figure 457. Instalação do vCenter, estágio 2, finalizado</div>
</div>
<div class="paragraph">
<p>O sistema avisa que o processo de instalação não poderá ser pausado ou interrompido uma vez que seja iniciado. Confirme clicando em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-21" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw21.png" alt="vmw21">
</div>
<div class="title">Figure 458. Confirmação de instalação do vCenter, estágio 2</div>
</div>
<div class="paragraph">
<p>Concluído o processo, clique em <em>Close</em>.</p>
</div>
<div id="img-vmw-2-22" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw22.png" alt="vmw22">
</div>
<div class="title">Figure 459. Instalação do vCenter, estágio 2, concluído</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_gerenciando_um_datacenter_com_o_vcenter">2) Gerenciando um datacenter com o vCenter</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para conectar-se ao vCenter, o primeiro passo é descobrir seu endereço IP. Acesse a interface web do host ESXi no qual o <em>appliance</em> do vCenter foi instalado, e localize sua máquina virtual.</p>
<div id="img-vmw-2-23" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw23.png" alt="vmw23">
</div>
<div class="title">Figure 460. Localizando VM do vCenter</div>
</div>
<div class="paragraph">
<p>Clique em <em>Console</em> para abrir a tela da VM, o observe o endereço IP alocado à mesma na parte de baixo da tela (no exemplo, o IP do vCenter é o <code>200.130.46.12</code>).</p>
</div>
<div id="img-vmw-2-24" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw24.png" alt="vmw24">
</div>
<div class="title">Figure 461. Determinando IP do vCenter</div>
</div>
</li>
<li>
<p>Abra o navegador web em sua máquina física, acessando o IP do vCenter via HTTPS. Você verá uma tela apontando erro no certificado auto-assinado, como mostrado abaixo.</p>
<div id="img-vmw-2-25" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw25.png" alt="vmw25">
</div>
<div class="title">Figure 462. Erro no certificado ao acessar o vCenter</div>
</div>
<div class="paragraph">
<p>Há duas opções para uso da interface web do vCenter: selecione a versão HTML5 do <em>vSphere Web Client</em>.</p>
</div>
<div id="img-vmw-2-26" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw26.png" alt="vmw26">
</div>
<div class="title">Figure 463. Seleção de versão do cliente web</div>
</div>
<div class="paragraph">
<p>Agora, vamos ao login. Entre com o usuário <code>administrator@DOMAIN</code>, substituindo <code>DOMAIN</code> pelo domínio SSO definido durante o estágio 2, parte 3 de instalação do vCenter na atividade anterior. Use a senha de acesso definida anteriormente, provavelmente <code>Virt3sr!</code>.</p>
</div>
<div id="img-vmw-2-27" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw27.png" alt="vmw27">
</div>
<div class="title">Figure 464. Login no vCenter</div>
</div>
<div class="paragraph">
<p>Enfim, você terá acesso à interface do vCenter. Navegue pelas janelas e abas para se ambientar com a ferramenta.</p>
</div>
<div id="img-vmw-2-28" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw28.png" alt="vmw28">
</div>
<div class="title">Figure 465. Interface do vCenter</div>
</div>
</li>
<li>
<p>Agora, vamos criar um <em>datacenter</em> de gerência. Clique com o botão direito sobre o IP do vCenter na aba à esquerda da janela, e selecione <em>New Datacenter</em>.</p>
<div id="img-vmw-2-29" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw29.png" alt="vmw29">
</div>
<div class="title">Figure 466. Criação de datacenter, parte 1</div>
</div>
<div class="paragraph">
<p>Escolha um nome sugestivo para seu <em>datacenter</em> (no exemplo, <code>datacenter-gX</code>), e clique em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-30" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw30.png" alt="vmw30">
</div>
<div class="title">Figure 467. Criação de datacenter, parte 2</div>
</div>
</li>
<li>
<p>Criado o <em>datacenter</em>, vamos adicionar hosts a ele. Clique com o botão direito sobre o <em>datacenter</em> e selecione <em>Add Host</em>.</p>
<div id="img-vmw-2-31" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw31.png" alt="vmw31">
</div>
<div class="title">Figure 468. Adição de hosts ao datacenter, parte 1</div>
</div>
<div class="paragraph">
<p>Digite o endereço IP do hypervisor ESXi que será adicionado ao <em>datacenter</em>.</p>
</div>
<div id="img-vmw-2-32" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw32.png" alt="vmw32">
</div>
<div class="title">Figure 469. Adição de hosts ao datacenter, parte 2</div>
</div>
<div class="paragraph">
<p>Informe o usuário/senha de acesso ao host.</p>
</div>
<div id="img-vmw-2-33" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw33.png" alt="vmw33">
</div>
<div class="title">Figure 470. Adição de hosts ao datacenter, parte 3</div>
</div>
<div class="paragraph">
<p>Confirme a aceitação do certificado auto-assinado.</p>
</div>
<div id="img-vmw-2-34" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw34.png" alt="vmw34">
</div>
<div class="title">Figure 471. Adição de hosts ao datacenter, parte 4</div>
</div>
<div class="paragraph">
<p>Revise as informações do host em <em>Host summary</em>, e clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-35" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw35.png" alt="vmw35">
</div>
<div class="title">Figure 472. Adição de hosts ao datacenter, parte 5</div>
</div>
<div class="paragraph">
<p>Ao assinalar licenças, mantenha a opção <em>Evaluation License</em> habilitada e clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-36" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw36.png" alt="vmw36">
</div>
<div class="title">Figure 473. Adição de hosts ao datacenter, parte 6</div>
</div>
<div class="paragraph">
<p>Em <em>Lockdown mode</em>, mantenha o botão <em>Disabled</em> marcado e clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-37" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw37.png" alt="vmw37">
</div>
<div class="title">Figure 474. Adição de hosts ao datacenter, parte 7</div>
</div>
<div class="paragraph">
<p>Em <em>VM location</em> selecione o <em>datacenter</em> de destino do host (só deve have um disponível) e prossiga.</p>
</div>
<div id="img-vmw-2-38" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw38.png" alt="vmw38">
</div>
<div class="title">Figure 475. Adição de hosts ao datacenter, parte 8</div>
</div>
<div class="paragraph">
<p>Revise as opções selecionadas e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-39" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw39.png" alt="vmw39">
</div>
<div class="title">Figure 476. Adição de hosts ao datacenter, finalizado</div>
</div>
<div class="paragraph">
<p>O primeiro host foi adicionado com sucesso! Novamente, clique com o botão direito no <em>datacenter</em> e selecione <em>Add Host</em> para adicionar o segundo hypervisor.</p>
</div>
<div id="img-vmw-2-40" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw40.png" alt="vmw40">
</div>
<div class="title">Figure 477. Adição do segundo hypervisor ao datacenter</div>
</div>
<div class="paragraph">
<p>Repita os passos anteriores, alterando o endereço IP do hypervisor a ser adicionado e quaisquer outras informações relevantes. Ao final do processo, sua tela de finalização deve estar como se segue:</p>
</div>
<div id="img-vmw-2-41" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw41.png" alt="vmw41">
</div>
<div class="title">Figure 478. Adição do segundo hypervisor ao datacenter, finalizado</div>
</div>
<div class="paragraph">
<p>Ao final do processo, ambos os hosts devem estar incluídos no <em>datacenter</em>, como mostrado abaixo.</p>
</div>
<div id="img-vmw-2-42" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw42.png" alt="vmw42">
</div>
<div class="title">Figure 479. Todos os hosts incluídos no datacenter</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_configurando_acesso_ao_storage">3) Configurando Acesso ao Storage</h3>
<div class="paragraph">
<p>Antes de iniciar esta atividade, garante que o FreeNAS está ligado e acessível&#8201;&#8212;&#8201;assim como em sessões anteriores, iremos usar apenas um servidor FreeNAS como <em>storage</em> centralizado para ambos os hypervisors do grupo. Verifique, ainda, que a VM que será usada para testes está com VMWare Tools instalado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para adicionar uma <em>storage</em> externa, clique sobre um dos hosts do <em>datacenter</em> e acesse <em>Configure</em> &gt; <em>Storage</em> &gt; <em>Storage Adapters</em> &gt; <em>Add Software Adapter</em>.</p>
<div id="img-vmw-2-43" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw43.png" alt="vmw43">
</div>
<div class="title">Figure 480. Adição de storage compartilhado, parte 1</div>
</div>
<div class="paragraph">
<p>Na nova janela, selecione <em>Add software iSCSI adapter</em>.</p>
</div>
<div id="img-vmw-2-44" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw44.png" alt="vmw44">
</div>
<div class="title">Figure 481. Adição de storage compartilhado, parte 2</div>
</div>
<div class="paragraph">
<p>Clique sobre o novo adaptador adicionado (abaixo da seção <em>Model: iSCSI Software Adapter</em>), e em <em>Dynamic Discovery</em> clique em <em>Add</em>.</p>
</div>
<div id="img-vmw-2-45" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw45.png" alt="vmw45">
</div>
<div class="title">Figure 482. Adição de storage compartilhado, parte 3</div>
</div>
<div class="paragraph">
<p>Na nova janela, digite o IP do servidor FreeNAS e mantenha a porta padrão 3260. Clique em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-46" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw46.png" alt="vmw46">
</div>
<div class="title">Figure 483. Adição de storage compartilhado, parte 4</div>
</div>
<div class="paragraph">
<p>Feito isso, clique em <em>Rescan Storage</em> para encontrar as LUNs disponíveis.</p>
</div>
<div id="img-vmw-2-47" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw47.png" alt="vmw47">
</div>
<div class="title">Figure 484. Adição de storage compartilhado, parte 5</div>
</div>
<div class="paragraph">
<p>Mantenha ambas as opções de <em>rescan</em> marcadas, e clique em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-48" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw48.png" alt="vmw48">
</div>
<div class="title">Figure 485. Adição de storage compartilhado, parte 6</div>
</div>
<div class="paragraph">
<p>Na aba à esquerda, alterne para <em>Storage</em> &gt; <em>Storage Devices</em>. Você deve conseguir visualizar as duas LUNs disponíveis no FreeNAS na janela, como mostrado abaixo.</p>
</div>
<div id="img-vmw-2-50" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw50.png" alt="vmw50">
</div>
<div class="title">Figure 486. Adição de storage compartilhado, concluído</div>
</div>
<div class="paragraph">
<p>Temos que tornar o <em>storage</em> compartilhado acessível também pelo outro hypervisor. Selecione o outro host físico e acesse <em>Configure</em> &gt; <em>Storage</em> &gt; <em>Storage Adapters</em> &gt; <em>Add Software Adapter</em>.</p>
</div>
<div id="img-vmw-2-51" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw51.png" alt="vmw51">
</div>
<div class="title">Figure 487. Adição de storage compartilhado no outro hypervisor</div>
</div>
<div class="paragraph">
<p>Repita os passos de adição de adaptador iSCSI, descoberta e <em>rescan</em>, como fizemos antes. Ao final do processo, você deverá conseguir enxergar as LUNs do <em>storage</em> compartilhado a partir do segundo hypervisor, como mostrado a seguir.</p>
</div>
<div id="img-vmw-2-52" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw52.png" alt="vmw52">
</div>
<div class="title">Figure 488. Adição de storage compartilhado no outro hypervisor, concluído</div>
</div>
</li>
<li>
<p>Antes de criar um <em>cluster</em> em nosso <em>datacenter</em>, vamos desligar as VMs em operação (<strong>exceto</strong> a VM do <em>appliance</em> do vCenter). Clique com o botão direito sobre a VM do Windows 10 em um dos hypervisors do grupo, e acesse <em>Power</em> &gt; <em>Power Off</em>.</p>
<div id="img-vmw-2-53" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw53.png" alt="vmw53">
</div>
<div class="title">Figure 489. Desligando VMs, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme o desligamento.</p>
</div>
<div id="img-vmw-2-54" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw54.png" alt="vmw54">
</div>
<div class="title">Figure 490. Desligando VMs, parte 2</div>
</div>
<div class="paragraph">
<p>Faça o mesmo com a VM Windows 10 operando no outro hypervisor.</p>
</div>
<div id="img-vmw-2-55" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw55.png" alt="vmw55">
</div>
<div class="title">Figure 491. Desligando VMs, parte 3</div>
</div>
</li>
<li>
<p>Agora sim, vamos criar o <em>cluster</em>. Clique com o botão direito sobre o <em>datacenter</em> e selecione <em>New Cluster</em>.</p>
<div id="img-vmw-2-56" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw56.png" alt="vmw56">
</div>
<div class="title">Figure 492. Criando cluster no datacenter, parte 1</div>
</div>
<div class="paragraph">
<p>Selecione um nome apropriado para o <em>cluster</em> (no exemplo, <code>cluster-gX</code>), e habilite <strong>apenas</strong> a funcionalidade <em>vSphere HA</em>. Em seguida, clique em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-57" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw57.png" alt="vmw57">
</div>
<div class="title">Figure 493. Criando cluster no datacenter, parte 2</div>
</div>
<div class="paragraph">
<p>Vamos adicionar máquinas ao <em>cluster</em>. Clique com o botão direito sobre o <em>cluster</em>, e em seguida em <em>Add Hosts</em>.</p>
</div>
<div id="img-vmw-2-58" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw58.png" alt="vmw58">
</div>
<div class="title">Figure 494. Criando cluster no datacenter, parte 3</div>
</div>
<div class="paragraph">
<p>Na tela inicial, selecione a aba <em>Existing hosts</em> e marque os dois hypervisors do grupo, como mostrado abaixo.</p>
</div>
<div id="img-vmw-2-59" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw59.png" alt="vmw59">
</div>
<div class="title">Figure 495. Criando cluster no datacenter, parte 4</div>
</div>
<div class="paragraph">
<p>Caso sejam reportados <em>warnings</em> para um dos hypervisors, ignore e clique em <em>Next</em> para prosseguir.</p>
</div>
<div id="img-vmw-2-60" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw60.png" alt="vmw60">
</div>
<div class="title">Figure 496. Criando cluster no datacenter, parte 5</div>
</div>
<div class="paragraph">
<p>Na tela final, revise as opções de criação do <em>cluster</em> e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-61" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw61.png" alt="vmw61">
</div>
<div class="title">Figure 497. Criando cluster no datacenter, finalizado</div>
</div>
<div class="paragraph">
<p>De volta à console principal do vCenter, note que ambos os hypervisors estão dentro do <em>cluster</em>, e todas as VMs são vistas como parte do mosmo <em>pool</em> de recursos. Se aplicável, clique nos hypervisors para removê-los do <em>Maintenance Mode</em> (modo de manutenção).</p>
</div>
<div id="img-vmw-2-63" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw63.png" alt="vmw63">
</div>
<div class="title">Figure 498. Hypervisors disponíveis dentro do cluster</div>
</div>
</li>
<li>
<p>Vamos adicionar o <em>storage</em> compartilhado ao <em>cluster</em>. Clique com o botão direito sobre o <em>cluster</em> e acesse <em>Storage</em> &gt; <em>New Datastore</em>.</p>
<div id="img-vmw-2-64" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw64.png" alt="vmw64">
</div>
<div class="title">Figure 499. Adicionando storage compartilhado ao cluster, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>Type</em>, selecione o tipo VMFS.</p>
</div>
<div id="img-vmw-2-65" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw65.png" alt="vmw65">
</div>
<div class="title">Figure 500. Adicionando storage compartilhado ao cluster, parte 2</div>
</div>
<div class="paragraph">
<p>Escolha um nome apropriado para o <em>datastore</em> (no exemplo abaixo, <code>ds-gX</code>), e aponte a LUN com tamanho de 80 GB no FreeNAS como alvo.</p>
</div>
<div id="img-vmw-2-66" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw66.png" alt="vmw66">
</div>
<div class="title">Figure 501. Adicionando storage compartilhado ao cluster, parte 3</div>
</div>
<div class="paragraph">
<p>Selecione a versão 6 do VMFS, e prossiga.</p>
</div>
<div id="img-vmw-2-67" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw67.png" alt="vmw67">
</div>
<div class="title">Figure 502. Adicionando storage compartilhado ao cluster, parte 4</div>
</div>
<div class="paragraph">
<p>Na configuração de particionamento, em <em>Partition Configuration</em> selecione <em>Use all available partitions</em>; use a totalidade do tamanho do <em>datastore</em>, 80 GB, e mantenha o tamanho de bloco e granularidade em seus valores padrão. Em seguida, clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-68" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw68.png" alt="vmw68">
</div>
<div class="title">Figure 503. Adicionando storage compartilhado ao cluster, parte 5</div>
</div>
<div class="paragraph">
<p>Confirme as opções de adição do <em>datastore</em> a o_cluster_, e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-69" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw69.png" alt="vmw69">
</div>
<div class="title">Figure 504. Adicionando storage compartilhado ao cluster, finalizado</div>
</div>
<div class="paragraph">
<p>Tudo certo! Ou&#8230;&#8203; está mesmo? Note que ocorrerá um erro ao criar a partição no <em>datastore</em> compartilhado: "<em>Cannot change the host configuration</em>". Como resolver?</p>
</div>
<div id="img-vmw-2-70" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw70.png" alt="vmw70">
</div>
<div class="title">Figure 505. Erro ao adicionar storagem compartilhado ao cluster</div>
</div>
<div class="paragraph">
<p>Clique em um dos hypervisors do grupo e acesse <em>Configure</em> &gt; <em>Storage</em> &gt; <em>Storage Devices</em>, e selecione a LUN do FreeNAS que tentamos adicionar ao <em>cluster</em> anteriormente. Observe o caminho até a LUN na linha <em>Location</em>, como destacado na figura abaixo.</p>
</div>
<div id="img-vmw-2-71" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw71.png" alt="vmw71">
</div>
<div class="title">Figure 506. Caminho de acesso no sistema de arquivos à LUN compartilhada</div>
</div>
<div class="paragraph">
<p>Acesse o hypervisor (o <strong>mesmo</strong> que foi utilizado no passo anterior) via SSH e invoque o comando <code>partedUtil setptbl LUNPATH msdos</code>, substituindo <code>LUNPATH</code> pelo caminho da LUN descoberto anteriormente. Esse comando irá apagar a tabela de partições da LUN, criando uma nova (em formato MBR) e vazia. Confira no exemplo abaixo:</p>
</div>
<div id="img-vmw-2-72" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw72.png" alt="vmw72">
</div>
<div class="title">Figure 507. Formatando tabela de partições da LUN</div>
</div>
<div class="paragraph">
<p>Vamos tentar novamente? Volte à console do vCenter e clique com o botão direito no <em>cluster</em>, acessando <em>Storage</em> &gt; <em>New Datastore</em>. Repita os passos de adição do <em>datastore</em> compartilhado que fizemos antes.</p>
</div>
<div id="img-vmw-2-73" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw73.png" alt="vmw73">
</div>
<div class="title">Figure 508. Adicionando storage compartilhado ao cluster, segunda tentativa</div>
</div>
<div class="paragraph">
<p>Na tela de finalização, revise os parâmetros de adição do <em>storage</em>, como se segue. Em seguida, clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-74" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw74.png" alt="vmw74">
</div>
<div class="title">Figure 509. Adicionando storage compartilhado ao cluster, finalizado (de novo)</div>
</div>
<div class="paragraph">
<p>Agora sim, o processo obtém sucesso. Veja na aba <em>Recent Tasks</em> que a criação do <em>datastore</em> VMFS é completada corretamente, desta vez.</p>
</div>
<div id="img-vmw-2-75" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw75.png" alt="vmw75">
</div>
<div class="title">Figure 510. Storage compartilhado formatado com sucesso</div>
</div>
</li>
<li>
<p>Clique em um dos hypervisors do grupo, e acesse a aba <em>Datastores</em>. O <em>storage</em> compartilhado deve estar visível sob o nome <code>ds-gX</code>.</p>
<div id="img-vmw-2-76" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw76.png" alt="vmw76">
</div>
<div class="title">Figure 511. Visualizando datastore compartilhado, hypervisor 1</div>
</div>
<div class="paragraph">
<p>Faça a conferência no outro hypervisor:</p>
</div>
<div id="img-vmw-2-77" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw77.png" alt="vmw77">
</div>
<div class="title">Figure 512. Visualizando datastore compartilhado, hypervisor 2</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_migração_de_máquinas_virtuais">4) Migração de máquinas virtuais</h3>
<div class="paragraph">
<p>Para esta atividade recomendamos a migração de apenas uma das VMs do grupo, já que o <em>storage</em> FreeNAS não possui espaço útil para armazenar mais do que uma máquina virtual em <em>fault tolerance</em>.</p>
</div>
<div class="paragraph">
<p>Uma vez configurado o <em>storage</em> compartilhado entre os hosts do <em>cluster</em>, é possível efetuar a migração das máquinas virtuais entre eles. Para tanto deve-se, primeiramente, mover os discos virtuais das máquinas para o <em>storage</em> compartilhado.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selecione uma das VMs do grupo como alvo para migração entre os hosts do <em>cluster</em>. Antes de começar, deve-se remover todos os <em>snapshots</em> de máquina acessando <em>Snapshots</em> &gt; <em>Delete All Snapshots</em>.</p>
<div id="img-vmw-2-78" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw78.png" alt="vmw78">
</div>
<div class="title">Figure 513. Removendo snapshots de máquina, parte 1</div>
</div>
<div class="paragraph">
<p>Confirme a remoção dos <em>snapshots</em> clicando em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-79" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw79.png" alt="vmw79">
</div>
<div class="title">Figure 514. Removendo snapshots de máquina, parte 2</div>
</div>
</li>
<li>
<p>Agora, vamos migrar o disco da VM para o <em>storage</em> compartilhado. Clique com o botão direito sobre a VM e acesse <em>Migrate</em>.</p>
<div id="img-vmw-2-80" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw80.png" alt="vmw80">
</div>
<div class="title">Figure 515. Migração de VM para o storage compartilhado, parte 1</div>
</div>
<div class="paragraph">
<p>Na escolha do tipo de migração a ser feita, marque o botão <em>Change storage only</em>.</p>
</div>
<div id="img-vmw-2-81" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw81.png" alt="vmw81">
</div>
<div class="title">Figure 516. Migração de VM para o storage compartilhado, parte 2</div>
</div>
<div class="paragraph">
<p>Mantenha o formato do disco em <em>Same format as source</em>, e marque como destino o <em>datastore</em> compartilhado (no exemplo abaixo, <code>ds-gX</code>). Clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-82" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw82.png" alt="vmw82">
</div>
<div class="title">Figure 517. Migração de VM para o storage compartilhado, parte 3</div>
</div>
<div class="paragraph">
<p>Confirme as opções de migração, e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-83" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw83.png" alt="vmw83">
</div>
<div class="title">Figure 518. Migração de VM para o storage compartilhado, finalizado</div>
</div>
<div class="paragraph">
<p>O processo de migração do <em>storage</em> da VM pode demorar um certo tempo. Acompanhe seu progresso através da aba <em>Recent Tasks</em>.</p>
</div>
</li>
<li>
<p>Confirme que o disco da máquina virtual foi de fato movido para o <em>storage</em>: clique com o botão direito na VM, e acesse <em>Edit Settings</em>. Em <em>Virtual Hardware</em> &gt; <em>Hard Disk 1</em> &gt; <em>Disk File</em>, verifique que o <em>datastore</em> de origem do arquivo é, de fato, a LUN do FreeNAS (no exemplo abaixo, <code>ds-gX</code>).</p>
<div id="img-vmw-2-84" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw84.png" alt="vmw84">
</div>
<div class="title">Figure 519. Disco virtual da VM localizado no datastore compartilhado</div>
</div>
</li>
<li>
<p>Vamos agora fazer a configuração da rede virtual dos hypervisors para suportar o vMotion. Clique em um dos hypervisors do grupo e acesse <em>Configure</em> &gt; <em>Networking</em> &gt; <em>VMkernel adapters</em> &gt; <em>Add Networking</em>.</p>
<div id="img-vmw-2-85" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw85.png" alt="vmw85">
</div>
<div class="title">Figure 520. Configuração de rede para o vMotion, parte 1</div>
</div>
<div class="paragraph">
<p>Para o tipo de conexão, selecione <em>VMkernel Network Adapter</em>.</p>
</div>
<div id="img-vmw-2-86" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw86.png" alt="vmw86">
</div>
<div class="title">Figure 521. Configuração de rede para o vMotion, parte 2</div>
</div>
<div class="paragraph">
<p>Em <em>Select target device</em>, marque o botão <em>Select an existing standard switch</em> e clique em <em>Browse</em>.</p>
</div>
<div id="img-vmw-2-87" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw87.png" alt="vmw87">
</div>
<div class="title">Figure 522. Configuração de rede para o vMotion, parte 3</div>
</div>
<div class="paragraph">
<p>Selecione o único switch disponível, <code>vSwitch0</code>.</p>
</div>
<div id="img-vmw-2-88" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw88.png" alt="vmw88">
</div>
<div class="title">Figure 523. Configuração de rede para o vMotion, parte 4</div>
</div>
<div class="paragraph">
<p>Em seguida, clique em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-89" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw89.png" alt="vmw89">
</div>
<div class="title">Figure 524. Configuração de rede para o vMotion, parte 5</div>
</div>
<div class="paragraph">
<p>Selecione um <em>label</em> apropriado para o adaptador de rede (no exemplo, <code>VMotion</code>), não indique nenhum ID de VLAN, e mantenha configurações de IPv4, MTU e pilha TCP/IP inalteradas. Para os serviços habilitados, marque as caixas <em>vMotion</em> e <em>Fault Tolerance logging</em> e, então, clique em <em>Next</em>.</p>
</div>
<div id="img-vmw-2-90" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw90.png" alt="vmw90">
</div>
<div class="title">Figure 525. Configuração de rede para o vMotion, parte 6</div>
</div>
<div class="paragraph">
<p>Nas configurações IPv4, mantenha o botão <em>Obtain IPv4 settings automatically</em> marcado.</p>
</div>
<div id="img-vmw-2-91" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw91.png" alt="vmw91">
</div>
<div class="title">Figure 526. Configuração de rede para o vMotion, parte 7</div>
</div>
<div class="paragraph">
<p>Revise as opções de configuração do adaptador de rede, e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-92" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw92.png" alt="vmw92">
</div>
<div class="title">Figure 527. Configuração de rede para o vMotion, finalizado</div>
</div>
<div class="paragraph">
<p>De volta à console do vCenter, acesse <em>Virtual switches</em> para visualizar graficamente a organização dos switches virtuais do hypervisor corrente. Clique em <em>Edit</em>.</p>
</div>
<div id="img-vmw-2-93" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw93.png" alt="vmw93">
</div>
<div class="title">Figure 528. Configuração de switch virtual, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>vSwitch0 - Edit Setting</em>, acesse a aba <em>Teaming and failover</em> e mova a placa <code>vmnic0</code> para a seção <em>Standby adapters</em>, como ilustrado pela figura abaixo.</p>
</div>
<div id="img-vmw-2-94" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw94.png" alt="vmw94">
</div>
<div class="title">Figure 529. Configuração de switch virtual, parte 2</div>
</div>
<div class="paragraph">
<p>O sistema irá avisar que nenhum adaptador de rede está em estado <em>Active</em>. Ignore o aviso e clique em <em>Ok</em>.</p>
</div>
<div id="img-vmw-2-95" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw95.png" alt="vmw95">
</div>
<div class="title">Figure 530. Configuração de switch virtual, finalizado</div>
</div>
<div class="paragraph">
<p>Ufa, tudo pronto! Ou quase&#8230;&#8203; agora, clique no outro hypervisor do grupo e repita as configurações de rede realizadas até aqui. Acesse <em>Configure</em> &gt; <em>Networking</em> &gt; <em>VMkernel adapters</em> &gt; <em>Add Networking</em> para adicionar um adaptador de rede para o <em>vMotion</em>:</p>
</div>
<div id="img-vmw-2-96" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw96.png" alt="vmw96">
</div>
<div class="title">Figure 531. Configuração de rede para o vMotion, hypervisor 2</div>
</div>
<div class="paragraph">
<p>Depois, navegue para <em>Virtual switches</em> e configure o adaptador em <em>Standby</em>.</p>
</div>
<div id="img-vmw-2-97" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw97.png" alt="vmw97">
</div>
<div class="title">Figure 532. Configuração de switch virtual, hypervisor 2</div>
</div>
</li>
<li>
<p>Vamos testar! Ligue a VM cujo disco encontra-se no <em>storage</em> compartilhado em <em>Power</em> &gt; <em>Power On</em>.</p>
<div id="img-vmw-2-98" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw98.png" alt="vmw98">
</div>
<div class="title">Figure 533. Ligando VM para teste de migração</div>
</div>
<div class="paragraph">
<p>Após o <em>boot</em>, é possível visualizar o endereço IP da VM diretamente na interface do vCenter, como destacado na imagem abaixo.</p>
</div>
<div id="img-vmw-2-99" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw99.png" alt="vmw99">
</div>
<div class="title">Figure 534. Endereço IP da VM em operação</div>
</div>
<div class="paragraph">
<p>Para permitir que pacotes ICMP atinjam a máquina virtual Windows 10, acesse a console desta e desative o firewall do Windows.</p>
</div>
<div id="img-vmw-2-100" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw100.png" alt="vmw100">
</div>
<div class="title">Figure 535. Desabilitando firewall do Windows para permitir ICMP</div>
</div>
<div class="paragraph">
<p>Agora, inicie um ping infinito (<code>ping -t</code>) para o endereço IP da VM Windows 10.</p>
</div>
<div id="img-vmw-2-101" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw101.png" alt="vmw101">
</div>
<div class="title">Figure 536. Ping iniciado para VM</div>
</div>
<div class="paragraph">
<p>De volta à console do vCenter, determine em qual host físico a máquina virtual está operando. Essa informação pode ser visualizada na tela de sumário da VM, em <em>Related Objects</em> &gt; <em>Host</em>.</p>
</div>
<div id="img-vmw-2-102" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw102.png" alt="vmw102">
</div>
<div class="title">Figure 537. Host físico hospedando VM</div>
</div>
<div class="paragraph">
<p>Vamos migrar a máquina virtual. Clique com o botão direito sobre a mesma e selecione <em>Migrate</em>.</p>
</div>
<div id="img-vmw-2-103" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw103.png" alt="vmw103">
</div>
<div class="title">Figure 538. Migrando VM, parte 1</div>
</div>
<div class="paragraph">
<p>No tipo de migração, selecione <em>Change compute resource only</em>, já que o <em>storage</em> está compartilhado no FreeNAS.</p>
</div>
<div id="img-vmw-2-104" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw104.png" alt="vmw104">
</div>
<div class="title">Figure 539. Migrando VM, parte 2</div>
</div>
<div class="paragraph">
<p>Selecione o host de destino para a VM: o outro hipervisor, com IP diferente do que determinamos anteriormente.</p>
</div>
<div id="img-vmw-2-105" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw105.png" alt="vmw105">
</div>
<div class="title">Figure 540. Migrando VM, parte 3</div>
</div>
<div class="paragraph">
<p>Não é necessário fazer quaisquer alterações na configuração de rede da VM.</p>
</div>
<div id="img-vmw-2-106" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw106.png" alt="vmw106">
</div>
<div class="title">Figure 541. Migrando VM, parte 4</div>
</div>
<div class="paragraph">
<p>Selecione o vMotion com alta prioridade, para acelerar o processo de migração.</p>
</div>
<div id="img-vmw-2-107" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw107.png" alt="vmw107">
</div>
<div class="title">Figure 542. Migrando VM, parte 5</div>
</div>
<div class="paragraph">
<p>Na tela de finalização, revise suas opções e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-108" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw108.png" alt="vmw108">
</div>
<div class="title">Figure 543. Migrando VM, finalizado</div>
</div>
<div class="paragraph">
<p>Acompanhe o progresso de migração da VM na aba <em>Recent Tasks</em>, como destacado.</p>
</div>
<div id="img-vmw-2-109" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw109.png" alt="vmw109">
</div>
<div class="title">Figure 544. Progresso de migração da VM</div>
</div>
<div class="paragraph">
<p>Em sua console rodando o comando <code>ping</code>, note que um número baixíssimo de pacotes é perdido durante a migração&#8201;&#8212;&#8201;no exemplo abaixo, apenas um pacote foi perdido.</p>
</div>
<div id="img-vmw-2-110" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw110.png" alt="vmw110">
</div>
<div class="title">Figure 545. Pacotes perdidos durante migração de VM</div>
</div>
<div class="paragraph">
<p>Finalmente, na tela de sumário da VM, confirme que o host hospedeiro foi de fato alterado para o outro hypervisor do grupo.</p>
</div>
<div id="img-vmw-2-111" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw111.png" alt="vmw111">
</div>
<div class="title">Figure 546. Hypervisor hospedeiro alterado após vMotion</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_ativando_alta_disponibilidade_e_tolerância_a_falhas">5) Ativando alta disponibilidade e tolerância a falhas</h3>
<div class="paragraph">
<p>O mecanismo de tolerância a falhas é habilitado apenas para máquinas virtuais selecionadas pelo administrador. Para estas, é mantida uma cópia em execução em outro host. Em caso de falhas, esta cópia entra em funcionamento imediatamente, diminuindo o tempo de recuperação de falhas.</p>
</div>
<div class="paragraph">
<p>Inicialmente, os hosts devem ser configurados para que o suporte à alta disponibilidade funcione corretamente. Para isso, será necessário que o <em>vSwitch</em> utilizado para a migração da máquina virtual possua no mínimo duas interfaces de rede (uma ativa e uma em <em>standby</em> para o caso de falhas) e que cada servidor possua uma porta <em>VMkernel</em> para troca de mensagens sobre falhas. Embora a recomendação oficial seja que o hypervisor tenha uma interface de rede dedicada para fazer o <em>fault tolerance</em>, para fins de demonstração não será necessário dispor de duas interfaces de rede, como testaremos neste laboratório.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Para ativar a funcionalidade de <em>fault tolerance</em> em uma VM, basta clicar com o botão direito sobre a mesma e acessar <em>Fault Tolerance</em> &gt; <em>Turn On Fault Tolerance</em>. Use a VM que foi configurada no <em>storage</em> compartilhado na atividade anterior.</p>
<div id="img-vmw-2-112" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw112.png" alt="vmw112">
</div>
<div class="title">Figure 547. Ativando fault tolerance em VM</div>
</div>
<div class="paragraph">
<p>Imediatamente veremos erros relacionados à configuração da VM. Vamos corrigi-los antes de prosseguir.</p>
</div>
<div id="img-vmw-2-113" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw113.png" alt="vmw113">
</div>
<div class="title">Figure 548. Erro ao ativar fault tolerance</div>
</div>
</li>
<li>
<p>Desligue a VM acessando <em>Power</em> &gt; <em>Power Off</em>.</p>
<div id="img-vmw-2-114" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw114.png" alt="vmw114">
</div>
<div class="title">Figure 549. Desligando VM</div>
</div>
</li>
<li>
<p>Agora, edite as configurações da máquina virtual acessando <em>Edit Settings</em>.</p>
<div id="img-vmw-2-115" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw115.png" alt="vmw115">
</div>
<div class="title">Figure 550. Editando configurações de VM, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>Virtual Hardware</em>, reduza o número de CPUs da VM para 1, e remova os dispositivos <em>CD/DVD drive 1</em> e <em>USB Controller</em>.</p>
</div>
<div id="img-vmw-2-116" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw116.png" alt="vmw116">
</div>
<div class="title">Figure 551. Editando configurações de VM, parte 2</div>
</div>
<div class="paragraph">
<p>Ainda em <em>Virtual Hardware</em>, expanda o contexto <em>CPU</em> e desabilite a opção <em>Expose hardware assisted virtualization to the guest OS</em>.</p>
</div>
<div id="img-vmw-2-118" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw118.png" alt="vmw118">
</div>
<div class="title">Figure 552. Editando configurações de VM, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>VM Options</em>, desabilite a opção <em>Virtualization Based Security</em>.</p>
</div>
<div id="img-vmw-2-117" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw117.png" alt="vmw117">
</div>
<div class="title">Figure 553. Editando configurações de VM, parte 4</div>
</div>
<div class="paragraph">
<p>Essas alterações de configuração da VM são necessárias por uma série de limitações existentes no ESXi para máquinas em <em>fault tolerance</em>. A lista completa de limitações e requerimentos do ESXi para operação com o <em>fault tolerance</em> podem ser consultadas na documentação oficial, em <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.avail.doc/GUID-57929CF0-DA9B-407A-BF2E-E7B72708D825.html" class="bare">https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.avail.doc/GUID-57929CF0-DA9B-407A-BF2E-E7B72708D825.html</a> .</p>
</div>
</li>
<li>
<p>Para funcionamento do <em>fault tolerance</em> o vCenter exige que seja disponibilizado um disco dedicado na <em>storage</em> para manter o estado de replicação da máquina virtual. Logue no FreeNAS como o usuário <code>root</code> e, em <em>Armazenamento</em>, edite o <code>zvol2</code>.</p>
<div id="img-vmw-2-119" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw119.png" alt="vmw119">
</div>
<div class="title">Figure 554. Disponibilizando disco de fault tolerance no storage, parte 1</div>
</div>
<div class="paragraph">
<p>Aumente o tamanho do <code>zvol2</code> para 50 GB.</p>
</div>
<div id="img-vmw-2-120" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw120.png" alt="vmw120">
</div>
<div class="title">Figure 555. Disponibilizando disco de fault tolerance no storage, parte 2</div>
</div>
<div class="paragraph">
<p>Em <em>Compartilhamento</em> &gt; <em>Block (iSCSI)</em> &gt; <em>Extents</em>, edite o <code>Extent2</code>, correspondente ao <code>zvol2</code>.</p>
</div>
<div id="img-vmw-2-121" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw121.png" alt="vmw121">
</div>
<div class="title">Figure 556. Disponibilizando disco de fault tolerance no storage, parte 3</div>
</div>
<div class="paragraph">
<p>Em <em>Dispositivo</em>, certifique-se que a LUN exposta pelo <em>extent</em> possui 50 GB, como esperado.</p>
</div>
<div id="img-vmw-2-122" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw122.png" alt="vmw122">
</div>
<div class="title">Figure 557. Disponibilizando disco de fault tolerance no storage, parte 4</div>
</div>
</li>
<li>
<p>De volta à console do vCenter, clique em um dos hypervisors do <em>cluster</em> e acesse <em>Configure</em> &gt; <em>Storage</em> &gt; <em>Storage Adapters</em>. Selecione o adaptador abaixo da seção <em>Model: iSCSI Software Adapter</em> e clique em <em>Rescan Adapter</em>.</p>
<div id="img-vmw-2-123" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw123.png" alt="vmw123">
</div>
<div class="title">Figure 558. Verificando atualização da LUN no vCenter, parte 1</div>
</div>
<div class="paragraph">
<p>Em <em>Devices</em>, logo abaixo, verifique que o tamanho da LUN 2 foi atualizado de 2 GB para 50 GB, seu novo tamanho.</p>
</div>
<div id="img-vmw-2-124" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw124.png" alt="vmw124">
</div>
<div class="title">Figure 559. Verificando atualização da LUN no vCenter, parte 2</div>
</div>
</li>
<li>
<p>Vamos criar o disco de <em>fault tolerance</em>. Clique com o botão direito no <em>cluster</em> e acesse <em>Storage</em> &gt; <em>New Datastore</em>.</p>
<div id="img-vmw-2-125" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw125.png" alt="vmw125">
</div>
<div class="title">Figure 560. Adição de disco de fault tolerance, parte 1</div>
</div>
<div class="paragraph">
<p>Defina um nome apropriado para o disco (no exemplo, <code>ds-ft-gX</code>), e selecione a LUN 2 exposta pelo FreeNAS, com 50 GB.</p>
</div>
<div id="img-vmw-2-126" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw126.png" alt="vmw126">
</div>
<div class="title">Figure 561. Adição de disco de fault tolerance, parte 2</div>
</div>
<div class="paragraph">
<p>Em <em>Partition Configuration</em> selecione <em>Use all available partitions</em> e defina o <em>Datastore Size</em> como 50 GB.</p>
</div>
<div id="img-vmw-2-127" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw127.png" alt="vmw127">
</div>
<div class="title">Figure 562. Adição de disco de fault tolerance, parte 3</div>
</div>
</li>
<li>
<p>Agora sim, vamos tentar novamente. Clique com o botão direito sobre a VM no <em>storage</em> compartilhado e acesse <em>Fault Tolerance</em> &gt; <em>Turn On Fault Tolerance</em>.</p>
<div id="img-vmw-2-128" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw128.png" alt="vmw128">
</div>
<div class="title">Figure 563. Habilitando fault tolerance, parte 1</div>
</div>
<div class="paragraph">
<p>Será mostrado um aviso referente à baixa largura de banda na placa de rede dos hosts do <em>cluster</em>. Clique em <em>Yes</em>.</p>
</div>
<div id="img-vmw-2-129" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw129.png" alt="vmw129">
</div>
<div class="title">Figure 564. Habilitando fault tolerance, parte 2</div>
</div>
<div class="paragraph">
<p>Selecione o <em>datastore</em> recém-criado (dedicado ao <em>fault tolerance</em>, com 50 GB) para armazenar o disco da VM secundária e arquivos de configuração.</p>
</div>
<div id="img-vmw-2-130" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw130.png" alt="vmw130">
</div>
<div class="title">Figure 565. Habilitando fault tolerance, parte 3</div>
</div>
<div class="paragraph">
<p>Selecione o host para a VM secundária.</p>
</div>
<div id="img-vmw-2-131" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw131.png" alt="vmw131">
</div>
<div class="title">Figure 566. Habilitando fault tolerance, parte 4</div>
</div>
<div class="paragraph">
<p>Revise as opções de configuração do <em>fault tolerance</em> e clique em <em>Finish</em>.</p>
</div>
<div id="img-vmw-2-132" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw132.png" alt="vmw132">
</div>
<div class="title">Figure 567. Habilitando fault tolerance, finalizado</div>
</div>
</li>
<li>
<p>Note que o ícone à esquerda da VM sob <em>fault tolerance</em> irá mudar, e em <em>Summary</em> é possível ver que o <em>fault tolerance</em> está habilitado (e não operacional ainda, já que a VM está desligada).</p>
<div id="img-vmw-2-133" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw133.png" alt="vmw133">
</div>
<div class="title">Figure 568. Fault tolerance configurado</div>
</div>
</li>
<li>
<p>Vamos ativar o <em>fault tolerance</em>. Ligue a VM em <em>Power</em> &gt; <em>Power On</em>.</p>
<div id="img-vmw-2-134" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw134.png" alt="vmw134">
</div>
<div class="title">Figure 569. Ligando VM em fault tolerance</div>
</div>
<div class="paragraph">
<p>Note, em <em>Recent Tasks</em>, que o processo de ativação da VM secundária de <em>fault tolerance</em> poderá levar um bom tempo&#8201;&#8212;&#8201;neste momento, o disco da VM primária está sendo copiado entre LUNs no FreeNAS.</p>
</div>
<div id="img-vmw-2-135" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw135.png" alt="vmw135">
</div>
<div class="title">Figure 570. Processo de ativação da VM secundária</div>
</div>
<div class="paragraph">
<p>Após a conclusão do processo, na aba <em>Summary</em> da VM você verá que a mesma encontra-se com <em>fault tolerance</em> ativo e operacional, como exemplificado na figura abaixo:</p>
</div>
<div id="img-vmw-2-136" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw136.png" alt="vmw136">
</div>
<div class="title">Figure 571. Fault tolerance operacional</div>
</div>
</li>
<li>
<p>Vamos testar? Primeiro, garanta que a VM <strong>não</strong> está rodando no hypervisor em que o <em>appliance</em> do vCenter está operando (haja vista que essa VM não está em <em>fault tolerance</em>).</p>
<div class="paragraph">
<p>Feito isso, inicie um ping infinito (<code>ping -t</code>) para o endereço IP da máquina virtual.</p>
</div>
<div id="img-vmw-2-137" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw137.png" alt="vmw137">
</div>
<div class="title">Figure 572. Ping iniciado para VM sob fault tolerance</div>
</div>
<div class="paragraph">
<p>Desligue abruptamente o hypervisor em que a VM primária em <em>fault tolerance</em> está rodando (cheque a linha <em>Host</em> na aba <em>Summary</em> da VM). Note que, imeditamente, o estado de tolerância a falha da VM é alterado na interface do vCenter:</p>
</div>
<div id="img-vmw-2-138" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw138.png" alt="vmw138">
</div>
<div class="title">Figure 573. Hypervisor primário desligado abruptamente</div>
</div>
<div class="paragraph">
<p>Volte à console em que o comando <code>ping</code> está sendo executado. Observe que, paradoxalmente, um número ínfimo de pacotes é perdido durante o processo de perda do host primário (no exemplo abaixo, apenas um pacote).</p>
</div>
<div id="img-vmw-2-139" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw139.png" alt="vmw139">
</div>
<div class="title">Figure 574. Pacotes perdidos durante fault tolerance</div>
</div>
<div class="paragraph">
<p>O host secundário sobe quase que imediatamente, portanto. Confira na aba <em>Summary</em> da VM que o estado do <em>fault tolerance</em> foi atualizado, e agora reporta que é necessário dispor de uma VM secundária para que a proteção fique ativa.</p>
</div>
<div id="img-vmw-2-140" class="imageblock text-center">
<div class="content">
<img src="./img/8_VSphere-s2/vmw140.png" alt="vmw140">
</div>
<div class="title">Figure 575. Fault tolerance inativo, apenas um hypervisor disponível</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_9_clouds_privadas_com_o_openstack">Sessão 9: Clouds privadas com o OpenStack</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_sessão_10">Sessão 10:</h2>
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-10 08:17:40 -0200
</div>
</div>
</body>
</html>