<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Sessão 8: Isolamento de processos e conteinerização</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_sessão_8_isolamento_de_processos_e_conteinerização">Sessão 8: Isolamento de processos e conteinerização</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nesta sessão, iremos configurar o sistema de conteinerização Docker, testando suas funcionalidades de criação rápida de containers, escalabilidade e orquestração via Docker Swarm. Compararemos a facilidade e rapidez de configuração com um sistema web mais "tradicional", como o que fizemos na sessão anterior.</p>
</div>
<div class="sect2">
<h3 id="_1_topologia_desta_sessão">1) Topologia desta sessão</h3>
<div class="paragraph">
<p>Criaremos duas novas máquinas nesta sessão, a saber:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>docker1</code>, nodo-mestre de configuração do Docker Compose/Swarm. Endereço IP 10.0.42.9/24.</p>
</li>
<li>
<p><code>docker2</code>, nodo-escravo (ou <em>worker</em>) do Docker Compose/Swarm. Endereço IP 10.0.42.10/24.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Como de costume, vamos à criação dos registros DNS. Acesse a máquina <code>ns1</code> como o usuário <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
ns1
root</pre>
</div>
</div>
<div class="paragraph">
<p>Edite o arquivo de zonas <code>/etc/nsd/zones/intnet.zone</code>, inserindo entradas A para a máquinas indicadas no começo desta atividade. <strong>Não se esqueça</strong> de incrementar o valor do serial no topo do arquivo!</p>
</div>
<div class="literalblock">
<div class="content">
<pre># nano /etc/nsd/zones/intnet.zone
(...)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># grep docker /etc/nsd/zones/intnet.zone
docker1 IN    A                 10.0.42.9
docker2 IN    A                 10.0.42.10</pre>
</div>
</div>
<div class="paragraph">
<p>Faça o mesmo para o arquivo de zona reversa:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># nano /etc/nsd/zones/10.0.42.zone</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># grep docker /etc/nsd/zones/10.0.42.zone
9       IN   PTR                docker1.intnet.
10      IN   PTR                docker2.intnet.</pre>
</div>
</div>
<div class="paragraph">
<p>Assine o arquivo de zonas usando o <em>script</em> criado anteriormente:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># bash /root/scripts/signzone-intnet.sh
reconfig start, read /etc/nsd/nsd.conf
ok
ok
ok
ok removed 6 rrsets, 2 messages and 0 key entries</pre>
</div>
</div>
<div class="paragraph">
<p>Verifique a criação das entradas usando o comando <code>dig</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># for host in docker1 docker2; do echo -n "$host: "; dig ${host}.intnet +short; done
docker1: 10.0.42.9
docker2: 10.0.42.10</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># for ip in 9 10; do echo -n "10.0.42.${ip}: "; dig -x 10.0.42.${ip} +short; done
10.0.42.9: docker1.intnet.
10.0.42.10: docker2.intnet.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_criação_da_vm_docker1_e_instalação">2) Criação da VM docker1 e instalação</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Primeiro, vamos criar a VM <code>docker1</code> e instalar o software Docker nela. Clone a máquina <code>debian-template</code> para uma de nome <code>docker1</code>, com uma única interface de rede conectada à DMZ. O IP da máquina será 10.0.42.9/24.</p>
<div class="paragraph">
<p>Concluída a clonagem, ligue a máquina e logue como <code>root</code>. Depois, use o script <code>/root/scripts/changehost.sh</code> para fazer a configuração automática, como de costume.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
debian-template
root</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># bash ~/scripts/changehost.sh -h docker1 -i 10.0.42.9 -g 10.0.42.1
Signing ssh_host_ecdsa_key.pub key...
Signing ssh_host_ed25519_key.pub key...
Signing ssh_host_rsa_key.pub key...
Configuring host key trust...
Configuring user key trust...
All done!</pre>
</div>
</div>
</li>
<li>
<p>Aplique o <em>baseline</em> de segurança à máquina <code>docker1</code>, repetindo o que fizemos no passo (2), atividade (2) da sessão 7:</p>
<div class="literalblock">
<div class="content">
<pre>$ hostname ; whoami
client
ansible</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sed -i '/\[srv\]/a docker1' ~/ansible/hosts</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible-playbook -i ~/ansible/hosts -l docker1 -Ke ansible_become_method=su ~/ansible/srv.yml ; ansible-playbook -i ~/ansible/hosts -l docker1 ~/ansible/srv.yml
SUDO password:

(...)

PLAY RECAP **********************************************************************************************************

docker1                       : ok=10   changed=8    unreachable=0    failed=0</pre>
</div>
</div>
</li>
<li>
<p>Agora, acesse a máquina <code>docker1</code> como o usuário <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
</li>
<li>
<p>Vamos proceder com os passos de instalação seguindo o manual oficial do Docker, disponível <a href="https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce" class="bare">https://docs.docker.com/install/linux/docker-ce/debian/#install-docker-ce</a> . Primeiramente, vamos habilitar a instalação de pacotes APT via HTTPS, instalando os pacotes a seguir:</p>
<div class="literalblock">
<div class="content">
<pre># apt-get install -y \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg2 \
    software-properties-common</pre>
</div>
</div>
</li>
<li>
<p>Agora, adicione a chave GPG do repositório do Docker com o comando:</p>
<div class="literalblock">
<div class="content">
<pre># curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
OK</pre>
</div>
</div>
<div class="paragraph">
<p>Verifique que a chave foi recebida corretamente:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># apt-key fingerprint 0EBFCD88
pub   rsa4096 2017-02-22 [SCEA]
      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid           [ unknown] Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   rsa4096 2017-02-22 [S]</pre>
</div>
</div>
</li>
<li>
<p>Adicione o repositório do Docker à lista de repositórios disponíveis para instalação de pacotes:</p>
<div class="literalblock">
<div class="content">
<pre># echo "deb [arch=amd64] https://download.docker.com/linux/debian \
    $(lsb_release -cs) \
    stable" &gt; \
    /etc/apt/sources.list.d/docker.list</pre>
</div>
</div>
<div class="paragraph">
<p>Atualize a lista de pacotes disponíveis, e instale o <code>docker-ce</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># apt-get update ; apt-get install -y docker-ce</pre>
</div>
</div>
</li>
<li>
<p>Cheque qual versão do Docker foi instalada:</p>
<div class="literalblock">
<div class="content">
<pre># docker --version
Docker version 18.09.0, build 4d60db4</pre>
</div>
</div>
<div class="paragraph">
<p>Verifique a correta instalação do Docker rodando a imagem <code>hello-world</code>, uma imagem de teste:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
d1725b59e92d: Pull complete
Digest: sha256:0add3ace90ecb4adbf7777e9aacf18357296e799f81cabc9fde470971e499788
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/</pre>
</div>
</div>
<div class="paragraph">
<p>O Docker detecta que a imagem <code>hello-world</code> não está disponível localmente, faz o download da mesma a partir do <em>registry</em> global do Docker Hub, e a executa. Falaremos mais sobre o <em>registry</em> global em atividades posteriores.</p>
</div>
</li>
<li>
<p>Agora, desligue a VM <code>docker1</code>. Para não ter que repetir os passos de instalação na VM <code>docker2</code>, vamos cloná-la a partir da <code>docker1</code> e aproveitar o trabalho que já realizamos até aqui.</p>
<div class="literalblock">
<div class="content">
<pre># halt -p</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_criação_da_vm_docker2">3) Criação da VM docker2</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Com a VM <code>docker1</code> desligada, clone-a para uma máquina de nome <code>docker2</code>. O IP dessa máquina será 10.0.42.10/24.</p>
<div class="paragraph">
<p>Concluída a clonagem, ligue <strong>apenas</strong> a máquina <code>docker2</code> e logue como <code>root</code>. Não ligue a máquina <code>docker1</code> ainda, ou haverá um conflito de IP na rede. Observe: como a máquina <code>docker1</code> já estava configurada para operar com o <code>sudo</code> distribuído via Ansible, será necessário escalar privilégio a partir de um usuário autorizado, como <code>aluno</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ hostname ; whoami
docker1
aluno</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo -i
[sudo] senha para aluno:
root@docker1:~#</pre>
</div>
</div>
<div class="paragraph">
<p>Depois, use o script <code>/root/scripts/changehost.sh</code> para fazer a configuração automática, como de costume.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># bash ~/scripts/changehost.sh -h docker2 -i 10.0.42.10 -g 10.0.42.1
Signing ssh_host_ecdsa_key.pub key...
Signing ssh_host_ed25519_key.pub key...
Signing ssh_host_rsa_key.pub key...
Configuring host key trust...
Configuring user key trust...
All done!</pre>
</div>
</div>
</li>
<li>
<p>Para manter a organização em nosso ambiente, adicione a máquina <code>docker2</code> ao inventário do Ansible. Como o usuário <code>ansible</code> na máquina <code>cliente</code>, execute:</p>
<div class="literalblock">
<div class="content">
<pre>$ hostname ; whoami
client
ansible</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sed -i '/\[srv\]/a docker2' ~/ansible/hosts</pre>
</div>
</div>
<div class="paragraph">
<p>Note que não é necessário re-executar o <em>playbook</em> para a máquina <code>docker2</code>, já que todos os controles de segurança foram aplicados anteriormente à máquina <code>docker1</code>, a partir da qual fizemos a clonagem.</p>
</div>
</li>
<li>
<p>Feito isso, ligue também a máquina <code>docker1</code>, e prossiga com as atividades desta sessão.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_4_trabalhando_com_containers">4) Trabalhando com containers</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Acesse a máquina <code>docker1</code> como o usuário <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
<div class="paragraph">
<p>Agora, crie um diretório vazio <code>/root/docker</code>, e entre nele.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mkdir ~/docker ; cd ~/docker</pre>
</div>
</div>
</li>
<li>
<p>Vamos criar um <em>Dockerfile</em>&#8201;&#8212;&#8201;um arquivo que define o que será instalado e configurado dentro do seu container. Nesse arquivo são mapeados acessos a recursos como interfaces de rede e volumes de disco virtualizados, em um ambiente isolado do restante do sistema operacional.</p>
<div class="paragraph">
<p>Crie o arquivo novo <code>/root/docker/Dockerfile</code> com o seguinte conteúdo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-docker" data-lang="docker"># Usar uma imagem oficial do runtime Python como imagem-pai
FROM python:2.7-slim

# Configurar o diretorio de trabalho como /app
WORKDIR /app

# Copiar o conteudo do diretorio corrent para dentro do container em /app
COPY . /app

# Instalar quaisquer dependencias do Python especificadas no arquivo requirements.txt
RUN pip install --trusted-host pypi.python.org -r requirements.txt

# Expor a porta 80 para o mundo externo, fora do container
EXPOSE 80

# Definir uma variavel de ambiente $World
ENV NAME World

# Rodar a aplicacao app.py ao lancar o container
CMD ["python", "app.py"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse <em>Dockerfile</em> faz referência a dois arquivos que ainda não criamos&#8201;&#8212;&#8201;<code>app.py</code> e <code>requirements.txt</code>. Vamos criá-los.</p>
</div>
</li>
<li>
<p>Primeiro, crie o arquivo novo <code>/root/docker/requirements.txt</code> com o seguinte conteúdo:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-conf" data-lang="conf">Flask
Redis</code></pre>
</div>
</div>
<div class="paragraph">
<p>O comando <code>pip install -r requirements.txt</code>, invocado no <em>Dockerfile</em>, irá portanto instalar as bibliotecas Flask e Redis para o ambiente Python do container.</p>
</div>
</li>
<li>
<p>Agora, vamos à aplicação em si. Crie o arquivo novo <code>/root/docker/app.py</code> com o seguinte conteúdo:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-py" data-lang="py">from flask import Flask
from redis import Redis, RedisError
import os
import socket

# Connect to Redis
redis = Redis(host="redis", db=0, socket_connect_timeout=2, socket_timeout=2)

app = Flask(__name__)

@app.route("/")
def hello():
    try:
        visits = redis.incr("counter")
    except RedisError:
        visits = "&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;"

    html = "&lt;h3&gt;Hello {name}!&lt;/h3&gt;" \
           "&lt;b&gt;Hostname:&lt;/b&gt; {hostname}&lt;br/&gt;" \
           "&lt;b&gt;Visits:&lt;/b&gt; {visits}"
    return html.format(name=os.getenv("NAME", "world"), hostname=socket.gethostname(), visits=visits)

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=80)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A aplicação acima, bastante simples, irá exibir a <em>string</em> <code>Hello World!</code>, uma página web que mostra o <em>hostname</em> da máquina local (no caso, o identificador do container) e um contador do número de visitas realizadas ao site. Esse contador é mantido em um volume uniforme, acessível por todos os containers da aplicação, com a biblioteca Redis.</p>
</div>
</li>
<li>
<p>Liste o conteúdo do diretório <code>/root/docker</code>. Você deve ter os arquivos abaixo:</p>
<div class="literalblock">
<div class="content">
<pre># ls -1 ~/docker/
app.py
Dockerfile
requirements.txt</pre>
</div>
</div>
<div class="paragraph">
<p>Para fazer o <em>build</em> do container, basta rodar o comando <code>docker build</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># cd ~/docker ; docker build -t pyhello .
Sending build context to Docker daemon   5.12kB
Step 1/7 : FROM python:2.7-slim
2.7-slim: Pulling from library/python
a5a6f2f73cd8: Pull complete
8da2a74f37b1: Pull complete
09b6f498cfd0: Pull complete
f0afb4f0a079: Pull complete
Digest: sha256:f82db224fbc9ff3309b7b62496e19d673738a568891604a12312e237e01ef147
Status: Downloaded newer image for python:2.7-slim
 ---&gt; 0dc3d8d47241
Step 2/7 : WORKDIR /app
(...)
Step 3/7 : COPY . /app
(...)
Step 4/7 : RUN pip install --trusted-host pypi.python.org -r requirements.txt
(...)
Step 5/7 : EXPOSE 80
(...)
Step 6/7 : ENV NAME World
(...)
Step 7/7 : CMD ["python", "app.py"]
(...)
Successfully built d2923f9142e3
Successfully tagged pyhello:latest</pre>
</div>
</div>
<div class="paragraph">
<p>O Docker irá executar os comandos do <em>Dockerfile</em>, em ordem:</p>
</div>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ao detectar que a imagem <code>python:2.7-slim</code> não existe na máquina local, ela será baixada do <em>registry</em> global do Docker Hub, como feito anteriormente com a imagem <code>hello-world.</code></p>
</li>
<li>
<p>Deriva-se uma nova imagem a partir de <code>python:2.7-slim</code>, e o diretório <code>/app</code> é criado na raiz do container.</p>
</li>
<li>
<p>Os arquivos da pasta local são copiadas para <code>/app</code>.</p>
</li>
<li>
<p>O comando <code>pip install -r requirements.txt</code> instala as bibliotecas necessárias ao funcionamento da aplicação, Flask e Redis, bem como suas dependências.</p>
</li>
<li>
<p>A porta 80/TCP do container é exposta para o mundo externo.</p>
</li>
<li>
<p>Cria-se uma nova variável de ambiente, <code>$World</code>.</p>
</li>
<li>
<p>Roda-se o comando <code>python app.py</code>, executando a aplicação. Como este comando objetiva apenas a criação da imagem do container, a aplicação é encerrada logo em seguida, e a imagem do container é finalizada sob a <em>tag</em> <code>pyhello</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Para listar a imagem recém-criada, use o comando <code>docker image ls</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
pyhello             latest              d2923f9142e3        6 minutes ago       131MB
python              2.7-slim            0dc3d8d47241        36 hours ago        120MB
hello-world         latest              4ab4c602aa5e        2 months ago        1.84kB</pre>
</div>
</div>
</li>
<li>
<p>Para rodar o container, basta executar <code>docker run</code>:</p>
<div class="literalblock">
<div class="content">
<pre># docker run -p 7080:80 pyhello
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</pre>
</div>
</div>
<div class="paragraph">
<p>O comando acima irá iniciar o container escutando na porta 80/TCP, e mapeando-a para a porta 7080/TCP da máquina virtual <code>docker1</code>.</p>
</div>
</li>
<li>
<p>Para conseguir acessar o container a partir do IP público do firewall (interface <code>enps0s3</code> da máquina <code>ns1</code>), precisamos adicionar algumas regras novas. Acesse a máquina <code>ns1</code> como <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
ns1
root</pre>
</div>
</div>
<div class="paragraph">
<p>Para que consigamos atingir a máquina <code>docker1</code> será necessário criar uma regra de DNAT na tabela <code>nat</code>, <em>chain</em> PREROUTING, além de uma regra na tabela <code>filter</code>, <em>chain</em> FORWARD, correspondente. Mapearemos a porta externa 7080/TCP para a porta interna 7080/TCP, sem alterações.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -t nat -A PREROUTING -i enp0s3 -p tcp -m tcp --dport 7080 -j DNAT --to-destination 10.0.42.9</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -A FORWARD -i enp0s3 -d 10.0.42.9/32 -p tcp -m tcp --dport 7080 -j ACCEPT</pre>
</div>
</div>
</li>
<li>
<p>Em sua máquina física, abra o navegador e aponte-o para o IP público do firewall (interface <code>enps0s3</code> da máquina <code>ns1</code>), na porta 7080/TCP:</p>
<div id="img-docker1" class="imageblock text-center">
<div class="content">
<img src="../img/docker1.png" alt="docker1">
</div>
<div class="title">Figure 1. Container operacional no Docker</div>
</div>
<div class="paragraph">
<p>Tudo certo!</p>
</div>
</li>
<li>
<p>De volta à máquina <code>docker1</code> como <code>root</code>, note que o acesso que fizemos foi registrado na console, com as seguintes mensagens:</p>
<div class="literalblock">
<div class="content">
<pre>192.168.29.106 - - [17/Nov/2018 20:10:53] "GET / HTTP/1.1" 200 -
192.168.29.106 - - [17/Nov/2018 20:10:53] "GET /favicon.ico HTTP/1.1" 404 -</pre>
</div>
</div>
<div class="paragraph">
<p>Para encerrar o container, digite <code>CTRL + C</code>. Vamos reexecutá-lo em <em>background</em> com a opção <code>-d</code> (<em>detached</em>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker run -d -p 7080:80 pyhello
2d93cc85f066dc6afa9a5c9ea5d0fd08112f52cec99aad8d1d862608d67ddc81</pre>
</div>
</div>
<div class="paragraph">
<p>O ID do container é mostrado, e retomamos controle do terminal. Para visualizar quais containers estão em operação neste momento, use o comando <code>docker container ls</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS
      NAMES
2d93cc85f066        pyhello             "python app.py"     42 seconds ago      Up 41 seconds       0.0.0.0:7080-&gt;80/tcp   modest_stallman</pre>
</div>
</div>
<div class="paragraph">
<p>Tente acessar novamente o container no navegador em sua máquina física&#8201;&#8212;&#8201;ele está funcionando normalmente.</p>
</div>
<div class="paragraph">
<p>Para parar um container rodando em <em>background</em>, use <code>docker container stop</code> e passe como parâmetro o ID do container, assim:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container stop 2d93cc85f066
2d93cc85f066</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_distribuindo_containers_para_um_registry_externo">5) Distribuindo containers para um <strong><em>registry</em></strong> externo</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vamos distribuir o container que criamos no passo anterior para o <em>registry</em> global do Docker Hub. Para isso, o primeiro passo é criar uma conta em <a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a> . Acesse essa página através do navegador em sua máquina física e preencha os campos em <em>New to Docker?</em>; <strong>importante</strong>: use um endereço de e-mail real em seu cadastro.</p>
<div id="img-docker2" class="imageblock text-center">
<div class="content">
<img src="../img/docker2.png" alt="docker2">
</div>
<div class="title">Figure 2. Cadastro no Docker Hub</div>
</div>
<div class="paragraph">
<p>Após seu cadastro, o Docker Hub irá enviar um e-mail de confirmação. Acesse a conta de e-mail informada e clique no botão para completar o cadastro. Finalmente, faça login no Docker Hub usando sua conta:</p>
</div>
<div id="img-docker3" class="imageblock text-center">
<div class="content">
<img src="../img/docker3.png" alt="docker3">
</div>
<div class="title">Figure 3. Interface do Docker Hub</div>
</div>
<div class="paragraph">
<p>Na tela acima, clique em <em>Create Repository</em>. Na nova tela, digite <code>seg10</code> como o nome do repositório; em <em>Description</em>, informe <code>Repositório-teste para o curso SEG10</code>; mantenha <em>Visibility</em> como <code>Public</code>.</p>
</div>
<div id="img-docker4" class="imageblock text-center">
<div class="content">
<img src="../img/docker4.png" alt="docker4">
</div>
<div class="title">Figure 4. Criação de novo repositório no Docker Hub</div>
</div>
<div class="paragraph">
<p>Clique em <em>Create</em>. Concluído o processo, você verá seu novo repositório como na tela a seguir:</p>
</div>
<div id="img-docker5" class="imageblock text-center">
<div class="content">
<img src="../img/docker5.png" alt="docker5">
</div>
<div class="title">Figure 5. Repositório seg10 no Docker Hub</div>
</div>
</li>
<li>
<p>Agora, volte à máquina <code>docker1</code> como o usuário <code>root</code>.</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
<div class="paragraph">
<p>Para fazer login no Docker Hub via linha de comando, use <code>docker login</code>. Use a mesma combinação de usuário e senha que você criou no passo (1) desta atividade.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: seg10docker
Password:
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded</pre>
</div>
</div>
</li>
<li>
<p>O próximo passo é criar uma <em>tag</em> para a imagem de container que criamos na atividade anterior. Uma <em>tag</em> é descrita por uma combinação <code>usuário/repositório:tag</code>, e serve para identificar e versionar imagens de containers no Docker.</p>
<div class="paragraph">
<p>Para criar a <em>tag</em>, use o comando <code>docker tag image</code>&#8201;&#8212;&#8201;substitua no comando abaixo o nome de usuário <code>seg10docker</code> pelo usuário que você criou no Docker Hub no passo (1) desta atividade:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker tag pyhello seg10docker/seg10:pyhello-v1</pre>
</div>
</div>
<div class="paragraph">
<p>Para ver a nova imagem criada com a <em>tag</em>, use <code>docker image ls</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
seg10docker/seg10   pyhello-v1          d2923f9142e3        37 minutes ago      131MB
pyhello             latest              d2923f9142e3        37 minutes ago      131MB
python              2.7-slim            0dc3d8d47241        37 hours ago        120MB
hello-world         latest              4ab4c602aa5e        2 months ago        1.84kB</pre>
</div>
</div>
</li>
<li>
<p>Para publicar a imagem à qual aplicamos a <em>tag</em> para o <em>registry</em> global do Docker Hub, use o comando <code>docker push</code>:</p>
<div class="literalblock">
<div class="content">
<pre># docker push seg10docker/seg10:pyhello-v1
The push refers to repository [docker.io/seg10docker/seg10]
1efa6f0c4ef3: Pushed
2134161361ab: Pushed
1acdc2a51c84: Pushed
6cffeea81e5d: Mounted from library/python
614a79865f6d: Mounted from library/python
612d27bb923f: Mounted from library/python
ef68f6734aa4: Mounted from library/python
pyhello-v1: digest: sha256:2879351d8aa37d80e5cebeb676f70af2a93de107d0b801bb51e47d937f99f3ff size: 1787</pre>
</div>
</div>
<div class="paragraph">
<p>Concluído este processo, a imagem estará publicada e disponível no Docker Hub. De volta ao navegador em sua máquina física, acesse a aba <em>Tags</em> em seu repositório para visualizar a imagem que foi enviada:</p>
</div>
<div id="img-docker6" class="imageblock text-center">
<div class="content">
<img src="../img/docker6.png" alt="docker6">
</div>
<div class="title">Figure 6. Imagem publicada no Docker Hub</div>
</div>
</li>
<li>
<p>A partir deste momento, é possível executar a imagem do container que publicamos para o Docker Hub a partir de qualquer máquina que possua o Docker instalado, diretamente. Por exemplo, acesse a máquina <code>docker2</code> como o usuário <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker2
root</pre>
</div>
</div>
<div class="paragraph">
<p>Agora, execute a imagem com o comando:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker run -p 7080:80 seg10docker/seg10:pyhello-v1
Unable to find image 'seg10docker/seg10:pyhello-v1' locally
pyhello-v1: Pulling from seg10docker/seg10
a5a6f2f73cd8: Pull complete
8da2a74f37b1: Pull complete
09b6f498cfd0: Pull complete
f0afb4f0a079: Pull complete
b0ce05758094: Pull complete
dde7e744bb50: Pull complete
0662477f0e17: Pull complete
Digest: sha256:2879351d8aa37d80e5cebeb676f70af2a93de107d0b801bb51e47d937f99f3ff
Status: Downloaded newer image for seg10docker/seg10:pyhello-v1
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: Do not use the development server in a production environment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</pre>
</div>
</div>
<div class="paragraph">
<p>Observe que o Docker detecta que a imagem não está disponível localmente, e então faz o download da mesma, instala as dependências do Python via <code>requirements.txt</code> e executa a aplicação. Tudo é gerenciado de forma transparente, de forma que apenas tivemos que invocar o container que preparamos e enviamos para o <em>registry</em> anteriormente.</p>
</div>
<div class="paragraph">
<p>Antes de prosseguir, encerre o container <code>CTRL + C</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_6_construindo_serviços_com_o_docker">6) Construindo serviços com o Docker</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Agora, vamos escalar a execução do nosso container para um ambiente simulado de produção. Acesse a máquina <code>docker1</code> como o usuário <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
</li>
<li>
<p>Crie o arquivo novo <code>/root/docker/docker-compose.yml</code> com o conteúdo abaixo:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">version: "3"
services:
  web:
    # substitua username/repo:tag com suas informacoes de nome de usuario, repositorio e imagem
    image: username/repo:tag
    deploy:
      replicas: 5
      resources:
        limits:
          cpus: "0.1"
          memory: 50M
      restart_policy:
        condition: on-failure
    ports:
      - "7080:80"
    networks:
      - webnet
networks:
  webnet:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como mencionado no comentário acima, não se esqueça de substituir a <em>string</em> <code>username/repo:tag</code>, que identifica a imagem a ser executada, pelas informações de usuário, repositório e imagem que foram criadas por você na atividade anterior. Por exemplo, no caso do usuário <code>seg10docker</code> que foi ilustrado até aqui, a linha ficaria assim:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># grep 'image:' ~/docker/docker-compose.yml
    image: seg10docker/seg10:pyhello-v1</pre>
</div>
</div>
<div class="paragraph">
<p>O arquivo acima irá:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Baixar a imagem que enviamos para o <em>registry</em> global do Docker Hub, se necessário.</p>
</li>
<li>
<p>Rodar 5 instâncias de um serviço denominado <code>web</code>, com cada instância ocupando no máximo 10% de CPU e 50 MB de memória RAM.</p>
</li>
<li>
<p>Reiniciar imediatamente quaisquer containers que venham a falhar.</p>
</li>
<li>
<p>Mapear a porta 7080 do <em>host</em> Docker para a porta 80 do container.</p>
</li>
<li>
<p>Instruir os containers do serviço <code>web</code> a compartilhar a porta 80 através de uma rede com balanceador de carga denominada <code>webnet</code>.</p>
</li>
<li>
<p>Definir a rede <code>webnet</code> com opções padrão (no caso, uma rede com balanceador de carga em <em>overlay</em>).</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Vamos testar? Primeiro, temos que iniciar o <em>swarm</em>, que consiste em um conjunto de máquinas rodando o Docker que operam em <em>cluster</em>. Como, neste momento, apenas a máquina <code>docker1</code> integrará esse <em>cluster</em>, ela atuará como o administrador do <em>swarm</em>.</p>
<div class="literalblock">
<div class="content">
<pre># docker swarm init
Swarm initialized: current node (1iys4vxt3k1pkcasdufb4m5vc) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-3jpdh6q1i5a9fay1y3nwavb18enoqhujwxk9bgin2k4as1p38z-6ft56u5yq0zxpc7wcsmvgzsux 10.0.42.9:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</pre>
</div>
</div>
<div class="paragraph">
<p>Agora sim, vamos iniciar a <em>stack</em> do serviço. Iremos nomeá-la <code>pyhello-stack</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># cd ~/docker ; docker stack deploy -c docker-compose.yml pyhello-stack
Creating network pyhello-stack_webnet
Creating service pyhello-stack_web</pre>
</div>
</div>
<div class="paragraph">
<p>A partir desse momento, a <em>stack</em> do serviço está rodando 5 instâncias de containers da imagem <code>pyhello-v1</code>.</p>
</div>
</li>
<li>
<p>Verifique se, de fato, todos esses containers estão rodando com <code>docker service ls</code>:</p>
<div class="literalblock">
<div class="content">
<pre># docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE                          PORTS
nrglkuxxdyer        pyhello-stack_web   replicated          5/5                 seg10docker/seg10:pyhello-v1   *:7080-&gt;80/tcp</pre>
</div>
</div>
<div class="paragraph">
<p>O serviço reporta que há 5 réplicas operando. Para visualizá-las individualmente, use <code>docker service ps</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker service ps pyhello-stack_web
ID                  NAME                  IMAGE                          NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS
x69lu01rscpt        pyhello-stack_web.1   seg10docker/seg10:pyhello-v1   docker1             Running             Running 2 minutes ago
i0id1ygbu7ba        pyhello-stack_web.2   seg10docker/seg10:pyhello-v1   docker1             Running             Running 2 minutes ago
uiu2pvojpzvw        pyhello-stack_web.3   seg10docker/seg10:pyhello-v1   docker1             Running             Running 2 minutes ago
9tpopx8y3prr        pyhello-stack_web.4   seg10docker/seg10:pyhello-v1   docker1             Running             Running 2 minutes ago
wp539pcus74u        pyhello-stack_web.5   seg10docker/seg10:pyhello-v1   docker1             Running             Running 2 minutes ago</pre>
</div>
</div>
<div class="paragraph">
<p>Também é possível listar todos os containers operando via <code>docker container ls</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container ls -q
f12b9b2db505
81c893056bfa
4b0c462de8f5
70b9a762aed2
0e4742201217</pre>
</div>
</div>
<div class="paragraph">
<p>No navegador em sua máquina física, acessando o IP da interface <code>enp0s3</code> da máquina <code>ns1</code>, porta 7080, solicite o recarregamento da página diversas vezes com o atalho <code>F5</code>. Note como, a cada <em>refresh</em>, o ID do container muda no campo <em>Hostname</em>.</p>
</div>
</li>
<li>
<p>Suponhamos que temos um pico de acessos, e é necessário aumentar de 5 para 8 o número de réplicas de container ativas. O Docker permite que façamos isso sem ter que reiniciar o serviço, veja: primeiro, edite o arquivo <code>/root/docker/docker-compose.yml</code>.</p>
<div class="literalblock">
<div class="content">
<pre># sed -i 's/^\([[:space:]]*replicas:\).*/\1 8/' ~/docker/docker-compose.yml</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># grep replicas ~/docker/docker-compose.yml
      replicas: 8</pre>
</div>
</div>
<div class="paragraph">
<p>Agora, faça o <em>redeploy</em> do serviço:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># cd ~/docker ; docker stack deploy -c docker-compose.yml pyhello-stack
Updating service pyhello-stack_web (id: nrglkuxxdyer9andac5feb51t)</pre>
</div>
</div>
<div class="paragraph">
<p>Note que o número de réplicas de containers aumenta imediatamente:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE                          PORTS
nrglkuxxdyer        pyhello-stack_web   replicated          8/8                 seg10docker/seg10:pyhello-v1   *:7080-&gt;80/tcp</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container ls -q
fc5d90deda22
afeb8dc18eea
bb599b864df5
f12b9b2db505
81c893056bfa
4b0c462de8f5
70b9a762aed2
0e4742201217</pre>
</div>
</div>
</li>
<li>
<p>Para interromper o serviço, remove a <em>stack</em> com o comando <code>docker stack rm</code>:</p>
<div class="literalblock">
<div class="content">
<pre># docker stack rm pyhello-stack
Removing service pyhello-stack_web
Removing network pyhello-stack_webnet</pre>
</div>
</div>
<div class="paragraph">
<p>Depois, abandone o <em>swarm</em> usando <code>docker swarm leave</code>. Como a máquina <code>docker1</code> é um administrador do <em>swarm</em>, temos que usar o parâmetro <code>--force</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker swarm leave --force
Node left the swarm.</pre>
</div>
</div>
<div class="paragraph">
<p>Observe que todos os containers foram encerrados, como esperado.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container ls -q | wc -l
0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_7_operando_com_múltiplos_membros_no_cluster">7) Operando com múltiplos membros no cluster</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Operar com múltiplas máquinas no <em>cluster</em> (ao invés de apenas uma, como fizemos com a máquina <code>docker1</code> na atividade anterior) é bastante fácil. Primeiro, acesse a máquina <code>docker1</code> como <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
</li>
<li>
<p>Inicie o <em>swarm</em> como fizemos anteriormente, com o comando <code>docker swarm init</code>:</p>
<div class="literalblock">
<div class="content">
<pre># docker swarm init
Swarm initialized: current node (k0nruds0qup7nscmf0j43jb30) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-3mw379ioa403z9kpu2rfbnjdzct1o4p33xh83zngsyey0rw9lp-afg4svcx1rjprgvug53vm21v4 10.0.42.9:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</pre>
</div>
</div>
<div class="paragraph">
<p>Observe o que fala a segunda linha do <em>output</em> acima: para adicionar novas máquinas ao <em>swarm</em>, execute o comando abaixo na máquina-alvo. Vamos fazer exatamente isso.</p>
</div>
</li>
<li>
<p>Acesse a máquina <code>docker2</code> como <code>root</code>.</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker2
root</pre>
</div>
</div>
<div class="paragraph">
<p>Copie o comando <code>docker swarm join</code> mostrado no <em>output</em> do passo (2), acima, e execute-o na máquina <code>docker2</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker swarm join --token SWMTKN-1-3mw379ioa403z9kpu2rfbnjdzct1o4p33xh83zngsyey0rw9lp-afg4svcx1rjprgvug53vm21v4 10.0.42.9:2377
This node joined a swarm as a worker.</pre>
</div>
</div>
<div class="paragraph">
<p>Pronto! As máquinas <code>docker1</code> e <code>docker2</code> estão agora juntas no <em>cluster</em>, sendo a máquina <code>docker1</code> o <em>manager</em> e a <code>docker2</code> o <em>worker</em> nesse cenário.</p>
</div>
</li>
<li>
<p>Volte à máquina <code>docker1</code>, como <code>root</code>, e faça o <em>deploy</em> do serviço <code>pyhello-stack</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># cd ~/docker ; docker stack deploy -c docker-compose.yml pyhello-stack
Creating network pyhello-stack_webnet
Creating service pyhello-stack_web</pre>
</div>
</div>
<div class="paragraph">
<p>Verifique quantos containers estão executando na máquina <code>docker1</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container ls -q | wc -l
4</pre>
</div>
</div>
<div class="paragraph">
<p>Ué, apenas 4 containers? Onde estão os outros 4? O comando <code>docker service ps</code> nos dá uma visão mais ampla da situação:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># docker service ps pyhello-stack_web
ID                  NAME                  IMAGE                          NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
pmshw6028oin        pyhello-stack_web.1   seg10docker/seg10:pyhello-v1   docker2             Running             Running 42 seconds ago
ilcy0qubdj7v        pyhello-stack_web.2   seg10docker/seg10:pyhello-v1   docker1             Running             Running 44 seconds ago
qm8frg324qjj        pyhello-stack_web.3   seg10docker/seg10:pyhello-v1   docker2             Running             Running 42 seconds ago
vdijie0369g8        pyhello-stack_web.4   seg10docker/seg10:pyhello-v1   docker1             Running             Running 43 seconds ago
nqt5l1sm678e        pyhello-stack_web.5   seg10docker/seg10:pyhello-v1   docker2             Running             Running 43 seconds ago
8czx47nhep2n        pyhello-stack_web.6   seg10docker/seg10:pyhello-v1   docker1             Running             Running 44 seconds ago
ryrf4ovcq7d6        pyhello-stack_web.7   seg10docker/seg10:pyhello-v1   docker2             Running             Running 42 seconds ago
4fr3zlwdgqjg        pyhello-stack_web.8   seg10docker/seg10:pyhello-v1   docker1             Running             Running 44 seconds ago</pre>
</div>
</div>
<div class="paragraph">
<p>Veja que temos 4 containers rodando na máquina <code>docker1</code>, e outros 4 rodando na máquina <code>docker2</code>.</p>
</div>
</li>
<li>
<p>Agora, pode surgir uma questão em sua mente: "Ora, se as configurações que fizemos no firewall instruem o repasse de pacotes na porta 7080/TCP diretamente para a máquina <code>docker1</code>, então é evidente que os 4 containers rodando na máquina <code>docker2</code> estão inacessíveis, pelo menos até que corrijamos as regras de firewall, certo?"</p>
<div class="paragraph">
<p>Será mesmo? Na máquina <code>docker2</code>, como <code>root</code>, liste os containers em operação:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker2
root</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># docker container ls
CONTAINER ID        IMAGE                          COMMAND             CREATED             STATUS              PORTS
              NAMES
37bbca732ec7        seg10docker/seg10:pyhello-v1   "python app.py"     6 minutes ago       Up 6 minutes        80/tcp
              pyhello-stack_web.7.ryrf4ovcq7d6cvrxyoyh372kk
ab9171ebcf69        seg10docker/seg10:pyhello-v1   "python app.py"     6 minutes ago       Up 6 minutes        80/tcp
              pyhello-stack_web.5.nqt5l1sm678e96ctsv2kwuk9f
f0d973c6c635        seg10docker/seg10:pyhello-v1   "python app.py"     6 minutes ago       Up 6 minutes        80/tcp
              pyhello-stack_web.1.pmshw6028oinz61bh509suza3
c420565a43f1        seg10docker/seg10:pyhello-v1   "python app.py"     6 minutes ago       Up 6 minutes        80/tcp
              pyhello-stack_web.3.qm8frg324qjj5roggzfwwznbn</pre>
</div>
</div>
<div class="paragraph">
<p>Agora, em seu navegador na máquina física, recarregue a página algumas vezes e observe os IDs de container que são mostrados:</p>
</div>
<div id="img-docker7" class="imageblock text-center">
<div class="content">
<img src="../img/docker7.png" alt="docker7">
</div>
<div class="title">Figure 7. Container da máquina docker2 sendo acessado</div>
</div>
<div class="paragraph">
<p>Note que o ID de container mostrado acima está executando na máquina <code>docker2</code>, mas claramente é impossível que tenhamos acessado essa máquina, já que as regras de firewall criadas anteriormente redirecionam pacotes <strong>apenas</strong> para a máquina <code>docker1</code>. Como isso está acontecendo?</p>
</div>
<div class="paragraph">
<p>A razão pela qual as duas máquinas estão acessíveis é porque um nodo do <em>swarm</em> Docker participa de um roteamento ingresso do tipo <em>mesh</em>, como ilustrado pela figura a seguir. Esse roteamento garante que um serviço alocado a uma porta em seu <em>swarm</em> sempre terá essa porta reservada para si, independente de qual nodo esteja rodando o container. Note, no exemplo, que é perfeitamente possível que uma requisição chegue à máquina <code>docker1</code> mas seja atendida por um container em <code>docker2</code>, ou vice-versa.</p>
</div>
<div id="img-docker-routing" class="imageblock text-center">
<div class="content">
<img src="../img/docker-routing.png" alt="docker routing">
</div>
<div class="title">Figure 8. Roteamento do tipo mesh no Docker</div>
</div>
</li>
<li>
<p>Mesmo com a funcionalidade acima, é interessante que o firewall envie requisições para ambas as máquinas <code>docker1</code> e <code>docker2</code>, indistintamente. Volte à máquina <code>ns1</code>, como <code>root</code>.</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
ns1
root</pre>
</div>
</div>
<div class="paragraph">
<p>Apague as regras que havíamos criado anteriormente.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -t nat -D PREROUTING -i enp0s3 -p tcp -m tcp --dport 7080 -j DNAT --to-destination 10.0.42.9</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -D FORWARD -i enp0s3 -d 10.0.42.9/32 -p tcp -m tcp --dport 7080 -j ACCEPT</pre>
</div>
</div>
<div class="paragraph">
<p>Em seu lugar, insira regras que redirecionem o tráfego para ambas as máquinas, em modalidade <em>round robin</em>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -t nat -A PREROUTING -i enp0s3 -p tcp -m tcp --dport 7080 -j DNAT --to-destination 10.0.42.9-10.0.42.10</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -A FORWARD -i enp0s3 -d 10.0.42.9/32,10.0.42.10/32 -p tcp -m tcp --dport 7080 -j ACCEPT</pre>
</div>
</div>
<div class="paragraph">
<p>Em seu navegador na máquina física, verifique que o serviço continua ativo, recarregando a página algumas vezes.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_8_adicionando_novos_serviços_ao_cluster">8) Adicionando novos serviços ao cluster</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>É bastante fácil adicionar novos serviços a um <em>cluster</em> Docker, mesmo quando em operação. Acesse a máquina <code>docker1</code> como <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
</li>
<li>
<p>Vamos adicionar um serviço <em>visualizer</em>, um container pré-pronto do Docker que permite que observemos como está a alocação de containers em nosso <em>cluster</em>. Edite o arquivo de configuração do <em>swarm</em>, <code>/root/docker/docker-compose.yml</code>, com o comando <code>sed</code> a seguir:</p>
<div class="literalblock">
<div class="content">
<pre># sed -i '/^networks:$/i\
  visualizer:\
    image: dockersamples/visualizer:stable\
    ports:\
      - "8080:8080"\
    volumes:\
      - "/var/run/docker.sock:/var/run/docker.sock"\
    deploy:\
      placement:\
        constraints: [node.role == manager]\
    networks:\
      - webnet' ~/docker/docker-compose.yml</pre>
</div>
</div>
<div class="paragraph">
<p>O comando acima irá:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Adicionar um novo serviço, <code>visualizer</code>, usando a imagem de container <code>dockersamples/visualizer:stable</code> baixada do <em>registry</em> global do Docker Hub.</p>
</li>
<li>
<p>Mapear a porta externa 8080 para a porta interna 8080, dentro do contexto do container.</p>
</li>
<li>
<p>Criar um mapeamento de volume do <em>socket</em> <code>/var/run/docker.sock</code> na máquina <em>host</em> para o mesmo caminho dentro do container. Vale observar que este <em>socket</em> está disponível exclusivamente no nodo <em>manager</em> do <em>cluster</em>.</p>
</li>
<li>
<p>Por esse motivo, cria-se uma restrição de alocação desse container, que deve rodar exclusivamente em nodos que possuam a <em>role</em> de <em>manager</em> no <em>cluster</em>.</p>
</li>
<li>
<p>Finalmente, conecta-se o serviço à mesma rede <code>webnet</code> que havíamos criado antes.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Para lançar o novo serviço, basta executar um <em>redeploy</em> da <em>stack</em>:</p>
<div class="literalblock">
<div class="content">
<pre># cd ~/docker ; docker stack deploy -c docker-compose.yml pyhello-stack
Creating service pyhello-stack_visualizer
Updating service pyhello-stack_web (id: fld46go1hn34kirew3xn3019v)</pre>
</div>
</div>
<div class="paragraph">
<p>O Docker detecta que a imagem <code>dockersamples/visualizer:stable</code> está indisponível localmente, e faz o download da mesma do <em>registry</em> global, lançando-a em seguida.</p>
</div>
</li>
<li>
<p>Presumindo que o serviço está ativo, note que estamos fazendo um novo mapeamento de portas: da 8080 (externa) para a 8080 (interna). Temos, naturalmente, que fazer ajustes em nosso firewall de rede. Acesse a máquina <code>ns1</code> como <code>root</code>:</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
ns1
root</pre>
</div>
</div>
<div class="paragraph">
<p>Apague as regras recém-criadas:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -t nat -D PREROUTING -i enp0s3 -p tcp -m tcp --dport 7080 -j DNAT --to-destination 10.0.42.9-10.0.42.10</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -D FORWARD -i enp0s3 -d 10.0.42.9/32,10.0.42.10/32 -p tcp -m tcp --dport 7080 -j ACCEPT</pre>
</div>
</div>
<div class="paragraph">
<p>Torne-as mais abrangentes, incluindo também a porta 8080:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -t nat -A PREROUTING -i enp0s3 -p tcp -m multiport --dports 7080,8080 -j DNAT --to-destination 10.0.42.9-10.0.42.10</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># iptables -A FORWARD -i enp0s3 -d 10.0.42.9/32,10.0.42.10/32 -p tcp -m multiport --dports 7080,8080 -j ACCEPT</pre>
</div>
</div>
<div class="paragraph">
<p>Agora sim, sendo estas regras definitivas, grave-as na configuração do firewall local:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># /etc/init.d/netfilter-persistent save
[....] Saving netfilter rules...run-parts: executing /usr/share/netfilter-persistent/plugins.d/15-ip4tables save
run-parts: executing /usr/share/netfilter-persistent/plugins.d/25-ip6tables save
done.</pre>
</div>
</div>
</li>
<li>
<p>Em sua máquina física, aponte agora o navegador para o IP público do <em>datacenter</em>, o endereço do interface <code>enp0s3</code> da máquina <code>ns1</code> na porta 8080:</p>
<div id="img-docker8" class="imageblock text-center">
<div class="content">
<img src="../img/docker8.png" alt="docker8">
</div>
<div class="title">Figure 9. Visualizando a operação do cluster Docker</div>
</div>
<div class="paragraph">
<p>O container <code>visualizer</code> nos mostra, de forma fácil, como está o estado do <em>cluster</em> Docker. Note como o container <code>visualizer</code> está operando apenas na máquina <code>docker1</code>, já que ela é o <em>manager</em> do <em>swarm</em>. Os containers <code>web</code>, por outro lado, podem operar em qualquer nodo, estando distribuídos 4 a cada lado.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_9_configurando_a_persistência_dos_dados">9) Configurando a persistência dos dados</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Você deve ter notado que o contador de visitantes do website, por algum motivo, não está funcionando. Isso se deve ao fato que o serviço do Redis, que fornece uma espécie de banco de dados em arquivo, não está operacional. Vamos corrigir isso: acesse a máquina <code>docker1</code> como <code>root</code>.</p>
<div class="literalblock">
<div class="content">
<pre># hostname ; whoami
docker1
root</pre>
</div>
</div>
</li>
<li>
<p>Para adicionar um serviço para o Redis, edite o arquivo de configuração <code>/root/docker/docker-compose.yml</code> com o comando <code>sed</code> a seguir:</p>
<div class="literalblock">
<div class="content">
<pre># sed -i '/^networks:$/i\
  redis:\
    image: redis\
    ports:\
      - "6379:6379"\
    volumes:\
      - "/root/data:/data"\
    deploy:\
      placement:\
        constraints: [node.role == manager]\
    command: redis-server --appendonly yes\
    networks:\
      - webnet' ~/docker/docker-compose.yml</pre>
</div>
</div>
<div class="paragraph">
<p>O comando acima irá:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Adicionar um novo serviço, <code>redis</code>, usando a imagem de container <code>redis</code> baixada do <em>registry</em> global do Docker Hub.</p>
</li>
<li>
<p>Mapear a porta externa 6379 para a porta interna 6379, dentro do contexto do container. Como esse serviço não será acessado externamente, não será necessário criar novas regras no firewall <code>ns1</code>.</p>
</li>
<li>
<p>Criar um mapeamento de volume do diretório <code>/root/data</code> na máquina <em>host</em> para o caminho <code>/data</code> dentro do container. A persistência de dados de vistantes do website será armazenada nesse diretório.</p>
</li>
<li>
<p>Cria-se uma restrição de alocação desse container, que deve rodar exclusivamente em nodos que possuam a <em>role</em> de <em>manager</em> no <em>cluster</em>. Assim, todos os containers do <em>cluster</em> terão a mesma visão dos dados em persistência.</p>
</li>
<li>
<p>Finalmente, conecta-se o serviço à mesma rede <code>webnet</code> que havíamos criado antes.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Naturalmente, temos que criar o diretório <code>/root/data</code>, que ainda não existe:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mkdir ~/data</pre>
</div>
</div>
</li>
<li>
<p>Faça o <em>redeploy</em> da <em>stack</em>:</p>
<div class="literalblock">
<div class="content">
<pre># cd ~/docker ; docker stack deploy -c docker-compose.yml pyhello-stack
Updating service pyhello-stack_visualizer (id: kzzk52hi201lz8jlsoif86p45)
Creating service pyhello-stack_redis
Updating service pyhello-stack_web (id: fld46go1hn34kirew3xn3019v)</pre>
</div>
</div>
</li>
<li>
<p>Em sua máquina física, aponte o navegador para o IP público do <em>datacenter</em>, o endereço do interface <code>enp0s3</code> da máquina <code>ns1</code> na porta 7080. Note que o contador de visitas está, agora sim, sendo contabilizado corretamente:</p>
<div id="img-docker9" class="imageblock text-center">
<div class="content">
<img src="../img/docker9.png" alt="docker9">
</div>
<div class="title">Figure 10. Contador de visitas operacional</div>
</div>
<div class="paragraph">
<p>Recarregue a página algumas vezes, e observe que o contador continua aumentando independentemente do fato de estarmos sendo atendidos por um container localizado na máquina <code>docker1</code> ou na máquina <code>docker2</code>. Como todos os containers tem a mesma visão da "verdade", isto é, a base de dados compartilhada no diretório <code>/root/data</code> da máquina <code>docker1</code>, conseguimos obter o valor correto e incrementá-lo sem importar de onde está partindo a requisição.</p>
</div>
<div class="paragraph">
<p>Observando o <code>visualizer</code>, que opera na porta 8080, note que o container do Redis executa exclusivamente na máquina <code>docker1</code>, como configurado:</p>
</div>
<div id="img-docker10" class="imageblock text-center">
<div class="content">
<img src="../img/docker10.png" alt="docker10">
</div>
<div class="title">Figure 11. Máquina docker1 executando visualizador e Redis</div>
</div>
</li>
<li>
<p>Encerradas as nossas atividades com containers, encerre o <em>stack</em> e <em>swarm</em> em ambas as máquinas <code>docker1</code> e <code>docker2</code>, e desligue-as. Para manter reduzido o uso de recursos durante o decorrer das próximas sessões, é interessante que tenhamos o mínimo de VMs operacionais.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-11-19 08:30:05 -0200
</div>
</div>
</body>
</html>